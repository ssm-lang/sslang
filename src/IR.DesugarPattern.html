<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DerivingVia #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">IR.DesugarPattern</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-7"></span><span>  </span><span class="annot"><a href="IR.DesugarPattern.html#desugarPattern"><span class="hs-identifier">desugarPattern</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Common.Compiler.html"><span class="hs-identifier">Common.Compiler</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Compiler</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-11"></span><span>  </span><span class="annot"><a href="Common.Compiler.html#Error"><span class="hs-identifier">Error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.Compiler.html#PatternError"><span class="hs-identifier">PatternError</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>  </span><span class="annot"><span class="hs-identifier">MonadError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">throwError</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>  </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier">Pass</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>  </span><span class="annot"><span class="hs-identifier">fromString</span></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="IR.IR.html"><span class="hs-identifier">IR.IR</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">I</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="IR.MangleNames.html"><span class="hs-identifier">IR.MangleNames</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">I</span></span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Common.Pretty.html"><span class="hs-identifier">Common.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Pretty</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">forM</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State.Lazy</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><span class="hs-identifier">MonadState</span></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>  </span><span class="annot"><span class="hs-identifier">StateT</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><span class="hs-identifier">gets</span></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><span class="hs-identifier">modify</span></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Bifunctor</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldrM</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-keyword">type</span><span> </span><span id="Equation"><span class="annot"><a href="IR.DesugarPattern.html#Equation"><span class="hs-identifier hs-var">Equation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="IR.IR.html#Alt"><span class="hs-identifier hs-type">I.Alt</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IR.IR.html#Expr"><span class="hs-identifier hs-type">I.Expr</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">data</span><span> </span><span id="CInfo"><span class="annot"><a href="IR.DesugarPattern.html#CInfo"><span class="hs-identifier hs-var">CInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CInfo"><span class="annot"><a href="IR.DesugarPattern.html#CInfo"><span class="hs-identifier hs-var">CInfo</span></a></span></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="cName"><span class="annot"><span class="annottext">CInfo -&gt; DConId
</span><a href="IR.DesugarPattern.html#cName"><span class="hs-identifier hs-var hs-var">cName</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Common.Identifiers.html#DConId"><span class="hs-identifier hs-type">I.DConId</span></a></span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="cType"><span class="annot"><span class="annottext">CInfo -&gt; TConId
</span><a href="IR.DesugarPattern.html#cType"><span class="hs-identifier hs-var hs-var">cType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Common.Identifiers.html#TConId"><span class="hs-identifier hs-type">I.TConId</span></a></span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="argsType"><span class="annot"><span class="annottext">CInfo -&gt; [Type]
</span><a href="IR.DesugarPattern.html#argsType"><span class="hs-identifier hs-var hs-var">argsType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679515775"><span id="local-6989586621679515777"><span class="annot"><span class="annottext">CInfo -&gt; CInfo -&gt; Bool
(CInfo -&gt; CInfo -&gt; Bool) -&gt; (CInfo -&gt; CInfo -&gt; Bool) -&gt; Eq CInfo
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: CInfo -&gt; CInfo -&gt; Bool
$c/= :: CInfo -&gt; CInfo -&gt; Bool
== :: CInfo -&gt; CInfo -&gt; Bool
$c== :: CInfo -&gt; CInfo -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679515768"><span id="local-6989586621679515770"><span id="local-6989586621679515772"><span class="annot"><span class="annottext">Int -&gt; CInfo -&gt; ShowS
[CInfo] -&gt; ShowS
CInfo -&gt; String
(Int -&gt; CInfo -&gt; ShowS)
-&gt; (CInfo -&gt; String) -&gt; ([CInfo] -&gt; ShowS) -&gt; Show CInfo
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [CInfo] -&gt; ShowS
$cshowList :: [CInfo] -&gt; ShowS
show :: CInfo -&gt; String
$cshow :: CInfo -&gt; String
showsPrec :: Int -&gt; CInfo -&gt; ShowS
$cshowsPrec :: Int -&gt; CInfo -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-keyword">data</span><span> </span><span id="TInfo"><span class="annot"><a href="IR.DesugarPattern.html#TInfo"><span class="hs-identifier hs-var">TInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TInfo"><span class="annot"><a href="IR.DesugarPattern.html#TInfo"><span class="hs-identifier hs-var">TInfo</span></a></span></span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="tName"><span class="annot"><span class="annottext">TInfo -&gt; TConId
</span><a href="IR.DesugarPattern.html#tName"><span class="hs-identifier hs-var hs-var">tName</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Common.Identifiers.html#TConId"><span class="hs-identifier hs-type">I.TConId</span></a></span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="tCSet"><span class="annot"><span class="annottext">TInfo -&gt; Set DConId
</span><a href="IR.DesugarPattern.html#tCSet"><span class="hs-identifier hs-var hs-var">tCSet</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><a href="Common.Identifiers.html#DConId"><span class="hs-identifier hs-type">I.DConId</span></a></span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679515760"><span id="local-6989586621679515762"><span class="annot"><span class="annottext">TInfo -&gt; TInfo -&gt; Bool
(TInfo -&gt; TInfo -&gt; Bool) -&gt; (TInfo -&gt; TInfo -&gt; Bool) -&gt; Eq TInfo
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: TInfo -&gt; TInfo -&gt; Bool
$c/= :: TInfo -&gt; TInfo -&gt; Bool
== :: TInfo -&gt; TInfo -&gt; Bool
$c== :: TInfo -&gt; TInfo -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679515754"><span id="local-6989586621679515756"><span id="local-6989586621679515758"><span class="annot"><span class="annottext">Int -&gt; TInfo -&gt; ShowS
[TInfo] -&gt; ShowS
TInfo -&gt; String
(Int -&gt; TInfo -&gt; ShowS)
-&gt; (TInfo -&gt; String) -&gt; ([TInfo] -&gt; ShowS) -&gt; Show TInfo
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [TInfo] -&gt; ShowS
$cshowList :: [TInfo] -&gt; ShowS
show :: TInfo -&gt; String
$cshow :: TInfo -&gt; String
showsPrec :: Int -&gt; TInfo -&gt; ShowS
$cshowsPrec :: Int -&gt; TInfo -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-keyword">data</span><span> </span><span id="DesugarCtx"><span class="annot"><a href="IR.DesugarPattern.html#DesugarCtx"><span class="hs-identifier hs-var">DesugarCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DesugarCtx"><span class="annot"><a href="IR.DesugarPattern.html#DesugarCtx"><span class="hs-identifier hs-var">DesugarCtx</span></a></span></span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="typeMap"><span class="annot"><span class="annottext">DesugarCtx -&gt; Map TConId TInfo
</span><a href="IR.DesugarPattern.html#typeMap"><span class="hs-identifier hs-var hs-var">typeMap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Common.Identifiers.html#TConId"><span class="hs-identifier hs-type">I.TConId</span></a></span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#TInfo"><span class="hs-identifier hs-type">TInfo</span></a></span><span>
</span><span id="line-53"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="consMap"><span class="annot"><span class="annottext">DesugarCtx -&gt; Map DConId CInfo
</span><a href="IR.DesugarPattern.html#consMap"><span class="hs-identifier hs-var hs-var">consMap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Common.Identifiers.html#DConId"><span class="hs-identifier hs-type">I.DConId</span></a></span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#CInfo"><span class="hs-identifier hs-type">CInfo</span></a></span><span>
</span><span id="line-54"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="symTable"><span class="annot"><span class="annottext">DesugarCtx -&gt; SymTable Type
</span><a href="IR.DesugarPattern.html#symTable"><span class="hs-identifier hs-var hs-var">symTable</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IR.IR.html#SymTable"><span class="hs-identifier hs-type">I.SymTable</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-keyword">newtype</span><span> </span><span id="DesugarFn"><span class="annot"><a href="IR.DesugarPattern.html#DesugarFn"><span class="hs-identifier hs-var">DesugarFn</span></a></span></span><span> </span><span id="local-6989586621679515749"><span class="annot"><a href="#local-6989586621679515749"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DesugarFn"><span class="annot"><a href="IR.DesugarPattern.html#DesugarFn"><span class="hs-identifier hs-var">DesugarFn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#DesugarCtx"><span class="hs-identifier hs-type">DesugarCtx</span></a></span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Compiler.Pass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679515749"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679515744"><span id="local-6989586621679515746"><span class="annot"><span class="annottext">a -&gt; DesugarFn b -&gt; DesugarFn a
(a -&gt; b) -&gt; DesugarFn a -&gt; DesugarFn b
(forall a b. (a -&gt; b) -&gt; DesugarFn a -&gt; DesugarFn b)
-&gt; (forall a b. a -&gt; DesugarFn b -&gt; DesugarFn a)
-&gt; Functor DesugarFn
forall a b. a -&gt; DesugarFn b -&gt; DesugarFn a
forall a b. (a -&gt; b) -&gt; DesugarFn a -&gt; DesugarFn b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: a -&gt; DesugarFn b -&gt; DesugarFn a
$c&lt;$ :: forall a b. a -&gt; DesugarFn b -&gt; DesugarFn a
fmap :: (a -&gt; b) -&gt; DesugarFn a -&gt; DesugarFn b
$cfmap :: forall a b. (a -&gt; b) -&gt; DesugarFn a -&gt; DesugarFn b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#DesugarCtx"><span class="hs-identifier hs-type">DesugarCtx</span></a></span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Compiler.Pass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679515732"><span id="local-6989586621679515734"><span id="local-6989586621679515736"><span id="local-6989586621679515738"><span id="local-6989586621679515740"><span class="annot"><span class="annottext">Functor DesugarFn
a -&gt; DesugarFn a
Functor DesugarFn
-&gt; (forall a. a -&gt; DesugarFn a)
-&gt; (forall a b. DesugarFn (a -&gt; b) -&gt; DesugarFn a -&gt; DesugarFn b)
-&gt; (forall a b c.
    (a -&gt; b -&gt; c) -&gt; DesugarFn a -&gt; DesugarFn b -&gt; DesugarFn c)
-&gt; (forall a b. DesugarFn a -&gt; DesugarFn b -&gt; DesugarFn b)
-&gt; (forall a b. DesugarFn a -&gt; DesugarFn b -&gt; DesugarFn a)
-&gt; Applicative DesugarFn
DesugarFn a -&gt; DesugarFn b -&gt; DesugarFn b
DesugarFn a -&gt; DesugarFn b -&gt; DesugarFn a
DesugarFn (a -&gt; b) -&gt; DesugarFn a -&gt; DesugarFn b
(a -&gt; b -&gt; c) -&gt; DesugarFn a -&gt; DesugarFn b -&gt; DesugarFn c
forall a. a -&gt; DesugarFn a
forall a b. DesugarFn a -&gt; DesugarFn b -&gt; DesugarFn a
forall a b. DesugarFn a -&gt; DesugarFn b -&gt; DesugarFn b
forall a b. DesugarFn (a -&gt; b) -&gt; DesugarFn a -&gt; DesugarFn b
forall a b c.
(a -&gt; b -&gt; c) -&gt; DesugarFn a -&gt; DesugarFn b -&gt; DesugarFn c
forall (f :: * -&gt; *).
Functor f
-&gt; (forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
&lt;* :: DesugarFn a -&gt; DesugarFn b -&gt; DesugarFn a
$c&lt;* :: forall a b. DesugarFn a -&gt; DesugarFn b -&gt; DesugarFn a
*&gt; :: DesugarFn a -&gt; DesugarFn b -&gt; DesugarFn b
$c*&gt; :: forall a b. DesugarFn a -&gt; DesugarFn b -&gt; DesugarFn b
liftA2 :: (a -&gt; b -&gt; c) -&gt; DesugarFn a -&gt; DesugarFn b -&gt; DesugarFn c
$cliftA2 :: forall a b c.
(a -&gt; b -&gt; c) -&gt; DesugarFn a -&gt; DesugarFn b -&gt; DesugarFn c
&lt;*&gt; :: DesugarFn (a -&gt; b) -&gt; DesugarFn a -&gt; DesugarFn b
$c&lt;*&gt; :: forall a b. DesugarFn (a -&gt; b) -&gt; DesugarFn a -&gt; DesugarFn b
pure :: a -&gt; DesugarFn a
$cpure :: forall a. a -&gt; DesugarFn a
$cp1Applicative :: Functor DesugarFn
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#DesugarCtx"><span class="hs-identifier hs-type">DesugarCtx</span></a></span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Compiler.Pass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679515724"><span id="local-6989586621679515726"><span id="local-6989586621679515728"><span class="annot"><span class="annottext">Applicative DesugarFn
a -&gt; DesugarFn a
Applicative DesugarFn
-&gt; (forall a b. DesugarFn a -&gt; (a -&gt; DesugarFn b) -&gt; DesugarFn b)
-&gt; (forall a b. DesugarFn a -&gt; DesugarFn b -&gt; DesugarFn b)
-&gt; (forall a. a -&gt; DesugarFn a)
-&gt; Monad DesugarFn
DesugarFn a -&gt; (a -&gt; DesugarFn b) -&gt; DesugarFn b
DesugarFn a -&gt; DesugarFn b -&gt; DesugarFn b
forall a. a -&gt; DesugarFn a
forall a b. DesugarFn a -&gt; DesugarFn b -&gt; DesugarFn b
forall a b. DesugarFn a -&gt; (a -&gt; DesugarFn b) -&gt; DesugarFn b
forall (m :: * -&gt; *).
Applicative m
-&gt; (forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
return :: a -&gt; DesugarFn a
$creturn :: forall a. a -&gt; DesugarFn a
&gt;&gt; :: DesugarFn a -&gt; DesugarFn b -&gt; DesugarFn b
$c&gt;&gt; :: forall a b. DesugarFn a -&gt; DesugarFn b -&gt; DesugarFn b
&gt;&gt;= :: DesugarFn a -&gt; (a -&gt; DesugarFn b) -&gt; DesugarFn b
$c&gt;&gt;= :: forall a b. DesugarFn a -&gt; (a -&gt; DesugarFn b) -&gt; DesugarFn b
$cp1Monad :: Applicative DesugarFn
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#DesugarCtx"><span class="hs-identifier hs-type">DesugarCtx</span></a></span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Compiler.Pass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679515720"><span class="annot"><span class="annottext">Monad DesugarFn
Monad DesugarFn
-&gt; (forall a. String -&gt; DesugarFn a) -&gt; MonadFail DesugarFn
String -&gt; DesugarFn a
forall a. String -&gt; DesugarFn a
forall (m :: * -&gt; *).
Monad m -&gt; (forall a. String -&gt; m a) -&gt; MonadFail m
fail :: String -&gt; DesugarFn a
$cfail :: forall a. String -&gt; DesugarFn a
$cp1MonadFail :: Monad DesugarFn
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadFail</span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#DesugarCtx"><span class="hs-identifier hs-type">DesugarCtx</span></a></span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Compiler.Pass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679515714"><span id="local-6989586621679515716"><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Common.Compiler.html#Error"><span class="hs-identifier hs-type">Error</span></a></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#DesugarCtx"><span class="hs-identifier hs-type">DesugarCtx</span></a></span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Compiler.Pass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679515706"><span id="local-6989586621679515708"><span id="local-6989586621679515710"><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#DesugarCtx"><span class="hs-identifier hs-type">DesugarCtx</span></a></span></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#DesugarCtx"><span class="hs-identifier hs-type">DesugarCtx</span></a></span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Compiler.Pass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span id="local-6989586621679515883"><span class="annot"><a href="IR.DesugarPattern.html#unDesugarFn"><span class="hs-identifier hs-type">unDesugarFn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#DesugarFn"><span class="hs-identifier hs-type">DesugarFn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679515883"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#DesugarCtx"><span class="hs-identifier hs-type">DesugarCtx</span></a></span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Compiler.Pass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679515883"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-68"></span><span id="unDesugarFn"><span class="annot"><span class="annottext">unDesugarFn :: DesugarFn a -&gt; StateT DesugarCtx Pass a
</span><a href="IR.DesugarPattern.html#unDesugarFn"><span class="hs-identifier hs-var hs-var">unDesugarFn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.DesugarPattern.html#DesugarFn"><span class="hs-identifier hs-type">DesugarFn</span></a></span><span> </span><span id="local-6989586621679515703"><span class="annot"><span class="annottext">StateT DesugarCtx Pass a
</span><a href="#local-6989586621679515703"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT DesugarCtx Pass a
</span><a href="#local-6989586621679515703"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="annot"><a href="IR.DesugarPattern.html#freshVar"><span class="hs-identifier hs-type">freshVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#DesugarFn"><span class="hs-identifier hs-type">DesugarFn</span></a></span><span> </span><span class="annot"><a href="Common.Identifiers.html#VarId"><span class="hs-identifier hs-type">I.VarId</span></a></span><span>
</span><span id="line-72"></span><span id="freshVar"><span class="annot"><span class="annottext">freshVar :: Type -&gt; DesugarFn VarId
</span><a href="IR.DesugarPattern.html#freshVar"><span class="hs-identifier hs-var hs-var">freshVar</span></a></span></span><span> </span><span id="local-6989586621679515701"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679515701"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-73"></span><span>  </span><span id="local-6989586621679515700"><span class="annot"><span class="annottext">SymTable Type
</span><a href="#local-6989586621679515700"><span class="hs-identifier hs-var">syms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(DesugarCtx -&gt; SymTable Type) -&gt; DesugarFn (SymTable Type)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">DesugarCtx -&gt; SymTable Type
</span><a href="IR.DesugarPattern.html#symTable"><span class="hs-identifier hs-var hs-var">symTable</span></a></span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679515699"><span class="annot"><span class="annottext">origin :: VarId
</span><a href="#local-6989586621679515699"><span class="hs-identifier hs-var hs-var">origin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarId
</span><span class="hs-string">&quot;__anonymous_pattern&quot;</span></span><span>
</span><span id="line-75"></span><span>      </span><span id="local-6989586621679515698"><span class="annot"><span class="annottext">name :: VarId
</span><a href="#local-6989586621679515698"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SymTable Type -&gt; VarId -&gt; VarId
forall t. Map VarId t -&gt; VarId -&gt; VarId
</span><a href="IR.MangleNames.html#pickId"><span class="hs-identifier hs-var">I.pickId</span></a></span><span> </span><span class="annot"><span class="annottext">SymTable Type
</span><a href="#local-6989586621679515700"><span class="hs-identifier hs-var">syms</span></a></span><span> </span><span class="annot"><span class="annottext">VarId
</span><a href="#local-6989586621679515699"><span class="hs-identifier hs-var">origin</span></a></span><span>
</span><span id="line-76"></span><span>      </span><span id="local-6989586621679515696"><span class="annot"><span class="annottext">syms' :: SymTable Type
</span><a href="#local-6989586621679515696"><span class="hs-identifier hs-var hs-var">syms'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarId -&gt; SymInfo Type -&gt; SymTable Type -&gt; SymTable Type
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">VarId
</span><a href="#local-6989586621679515698"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SymInfo :: forall t. VarId -&gt; t -&gt; SymInfo t
</span><a href="IR.IR.html#SymInfo"><span class="hs-identifier hs-type">I.SymInfo</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">symOrigin :: VarId
</span><a href="IR.IR.html#symOrigin"><span class="hs-identifier hs-var">I.symOrigin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarId
</span><a href="#local-6989586621679515699"><span class="hs-identifier hs-var">origin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">symType :: Type
</span><a href="IR.IR.html#symType"><span class="hs-identifier hs-var">I.symType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679515701"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">SymTable Type
</span><a href="#local-6989586621679515700"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-77"></span><span>  </span><span class="annot"><span class="annottext">(DesugarCtx -&gt; DesugarCtx) -&gt; DesugarFn ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((DesugarCtx -&gt; DesugarCtx) -&gt; DesugarFn ())
-&gt; (DesugarCtx -&gt; DesugarCtx) -&gt; DesugarFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679515691"><span class="annot"><span class="annottext">DesugarCtx
</span><a href="#local-6989586621679515691"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DesugarCtx
</span><a href="#local-6989586621679515691"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">symTable :: SymTable Type
</span><a href="IR.DesugarPattern.html#symTable"><span class="hs-identifier hs-var">symTable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SymTable Type
</span><a href="#local-6989586621679515696"><span class="hs-identifier hs-var">syms'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-78"></span><span>  </span><span class="annot"><span class="annottext">VarId -&gt; DesugarFn VarId
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">VarId
</span><a href="#local-6989586621679515698"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-comment">-- TODO: this should be a pattern synonym</span><span>
</span><span id="line-82"></span><span class="annot"><a href="IR.DesugarPattern.html#unreachableExpr"><span class="hs-identifier hs-type">unreachableExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.IR.html#Expr"><span class="hs-identifier hs-type">I.Expr</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span>
</span><span id="line-83"></span><span id="unreachableExpr"><span class="annot"><span class="annottext">unreachableExpr :: Type -&gt; Expr Type
</span><a href="IR.DesugarPattern.html#unreachableExpr"><span class="hs-identifier hs-var hs-var">unreachableExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExceptType -&gt; Type -&gt; Expr Type
forall t. ExceptType -&gt; t -&gt; Expr t
</span><a href="IR.IR.html#Exception"><span class="hs-identifier hs-var">I.Exception</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptType -&gt; Type -&gt; Expr Type)
-&gt; ExceptType -&gt; Type -&gt; Expr Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; ExceptType
</span><a href="IR.IR.html#ExceptDefault"><span class="hs-identifier hs-var">I.ExceptDefault</span></a></span><span> </span><span class="annot"><span class="annottext">(Literal -&gt; ExceptType) -&gt; Literal -&gt; ExceptType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Literal
</span><a href="IR.IR.html#LitIntegral"><span class="hs-identifier hs-var">I.LitIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="annot"><a href="IR.DesugarPattern.html#desugarPattern"><span class="hs-identifier hs-type">desugarPattern</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IR.IR.html#Program"><span class="hs-identifier hs-type">I.Program</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Compiler.Pass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#Program"><span class="hs-identifier hs-type">I.Program</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span id="desugarPattern"><span class="annot"><span class="annottext">desugarPattern :: Program Type -&gt; Pass (Program Type)
</span><a href="IR.DesugarPattern.html#desugarPattern"><span class="hs-identifier hs-var hs-var">desugarPattern</span></a></span></span><span> </span><span id="local-6989586621679515686"><span class="annot"><span class="annottext">p :: Program Type
</span><a href="#local-6989586621679515686"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="IR.IR.html#Program"><span class="hs-identifier hs-type">I.Program</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">programDefs :: forall t. Program t -&gt; [(Binder t, Expr t)]
</span><a href="IR.IR.html#programDefs"><span class="hs-identifier hs-var">I.programDefs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679515683"><span class="annot"><span class="annottext">[(Binder Type, Expr Type)]
</span><a href="#local-6989586621679515683"><span class="hs-identifier hs-var">defs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">typeDefs :: forall t. Program t -&gt; [(TConId, TypeDef)]
</span><a href="IR.IR.html#typeDefs"><span class="hs-identifier hs-var">I.typeDefs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679515681"><span class="annot"><span class="annottext">[(TConId, TypeDef)]
</span><a href="#local-6989586621679515681"><span class="hs-identifier hs-var">tds</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">symTable :: forall t. Program t -&gt; Map VarId (SymInfo t)
</span><a href="IR.IR.html#symTable"><span class="hs-identifier hs-var">I.symTable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679515679"><span class="annot"><span class="annottext">SymTable Type
</span><a href="#local-6989586621679515679"><span class="hs-identifier hs-var">syms</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679515678"><span class="annot"><span class="annottext">[(Binder Type, Expr Type)]
</span><a href="#local-6989586621679515678"><span class="hs-identifier hs-var">defs'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DesugarCtx -&gt; SymTable Type
</span><a href="IR.DesugarPattern.html#symTable"><span class="hs-identifier hs-var hs-var">symTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679515677"><span class="annot"><span class="annottext">SymTable Type
</span><a href="#local-6989586621679515677"><span class="hs-identifier hs-var">syms'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT DesugarCtx Pass [(Binder Type, Expr Type)]
-&gt; DesugarCtx -&gt; Pass ([(Binder Type, Expr Type)], DesugarCtx)
forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><span class="hs-identifier hs-var hs-var">runStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DesugarFn [(Binder Type, Expr Type)]
-&gt; StateT DesugarCtx Pass [(Binder Type, Expr Type)]
forall a. DesugarFn a -&gt; StateT DesugarCtx Pass a
</span><a href="IR.DesugarPattern.html#unDesugarFn"><span class="hs-identifier hs-var">unDesugarFn</span></a></span><span> </span><span class="annot"><span class="annottext">(DesugarFn [(Binder Type, Expr Type)]
 -&gt; StateT DesugarCtx Pass [(Binder Type, Expr Type)])
-&gt; DesugarFn [(Binder Type, Expr Type)]
-&gt; StateT DesugarCtx Pass [(Binder Type, Expr Type)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Binder Type, Expr Type) -&gt; DesugarFn (Binder Type, Expr Type))
-&gt; [(Binder Type, Expr Type)]
-&gt; DesugarFn [(Binder Type, Expr Type)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">(Binder Type, Expr Type) -&gt; DesugarFn (Binder Type, Expr Type)
forall t. (t, Expr Type) -&gt; DesugarFn (t, Expr Type)
</span><a href="#local-6989586621679515674"><span class="hs-identifier hs-var">desugarExprsDefs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Binder Type, Expr Type)]
</span><a href="#local-6989586621679515683"><span class="hs-identifier hs-var">defs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DesugarCtx
</span><a href="#local-6989586621679515673"><span class="hs-identifier hs-var">initCtx</span></a></span><span>
</span><span id="line-89"></span><span>  </span><span class="annot"><span class="annottext">Program Type -&gt; Pass (Program Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Program Type -&gt; Pass (Program Type))
-&gt; Program Type -&gt; Pass (Program Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Program Type
</span><a href="#local-6989586621679515686"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">programDefs :: [(Binder Type, Expr Type)]
</span><a href="IR.IR.html#programDefs"><span class="hs-identifier hs-var">I.programDefs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Binder Type, Expr Type)]
</span><a href="#local-6989586621679515678"><span class="hs-identifier hs-var">defs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">symTable :: SymTable Type
</span><a href="IR.IR.html#symTable"><span class="hs-identifier hs-var">I.symTable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SymTable Type
</span><a href="#local-6989586621679515677"><span class="hs-identifier hs-var">syms'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-90"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-91"></span><span>  </span><span id="local-6989586621679515674"><span class="annot"><span class="annottext">desugarExprsDefs :: (t, Expr Type) -&gt; DesugarFn (t, Expr Type)
</span><a href="#local-6989586621679515674"><span class="hs-identifier hs-var hs-var">desugarExprsDefs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679515672"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679515672"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679515671"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515671"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679515672"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Expr Type -&gt; (t, Expr Type))
-&gt; DesugarFn (Expr Type) -&gt; DesugarFn (t, Expr Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; DesugarFn (Expr Type)
</span><a href="IR.DesugarPattern.html#desugarExpr"><span class="hs-identifier hs-var">desugarExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515671"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-92"></span><span>  </span><span id="local-6989586621679515673"><span class="annot"><span class="annottext">initCtx :: DesugarCtx
</span><a href="#local-6989586621679515673"><span class="hs-identifier hs-var hs-var">initCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DesugarCtx :: Map TConId TInfo -&gt; Map DConId CInfo -&gt; SymTable Type -&gt; DesugarCtx
</span><a href="IR.DesugarPattern.html#DesugarCtx"><span class="hs-identifier hs-type">DesugarCtx</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">typeMap :: Map TConId TInfo
</span><a href="IR.DesugarPattern.html#typeMap"><span class="hs-identifier hs-var">typeMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(TConId, TypeDef)] -&gt; Map TConId TInfo
</span><a href="IR.DesugarPattern.html#buildTypeMap"><span class="hs-identifier hs-var">buildTypeMap</span></a></span><span> </span><span class="annot"><span class="annottext">[(TConId, TypeDef)]
</span><a href="#local-6989586621679515681"><span class="hs-identifier hs-var">tds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">consMap :: Map DConId CInfo
</span><a href="IR.DesugarPattern.html#consMap"><span class="hs-identifier hs-var">consMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(TConId, TypeDef)] -&gt; Map DConId CInfo
</span><a href="IR.DesugarPattern.html#buildConsMap"><span class="hs-identifier hs-var">buildConsMap</span></a></span><span> </span><span class="annot"><span class="annottext">[(TConId, TypeDef)]
</span><a href="#local-6989586621679515681"><span class="hs-identifier hs-var">tds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">symTable :: SymTable Type
</span><a href="IR.DesugarPattern.html#symTable"><span class="hs-identifier hs-var">symTable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SymTable Type
</span><a href="#local-6989586621679515679"><span class="hs-identifier hs-var">syms</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="annot"><a href="IR.DesugarPattern.html#desugarExpr"><span class="hs-identifier hs-type">desugarExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IR.IR.html#Expr"><span class="hs-identifier hs-type">I.Expr</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#DesugarFn"><span class="hs-identifier hs-type">DesugarFn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#Expr"><span class="hs-identifier hs-type">I.Expr</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span id="desugarExpr"><span class="annot"><span class="annottext">desugarExpr :: Expr Type -&gt; DesugarFn (Expr Type)
</span><a href="IR.DesugarPattern.html#desugarExpr"><span class="hs-identifier hs-var hs-var">desugarExpr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#App"><span class="hs-identifier hs-type">I.App</span></a></span><span> </span><span id="local-6989586621679515665"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515665"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621679515664"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515664"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621679515663"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679515663"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; Expr Type -&gt; Type -&gt; Expr Type
forall t. Expr t -&gt; Expr t -&gt; t -&gt; Expr t
</span><a href="IR.IR.html#App"><span class="hs-identifier hs-var">I.App</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr Type -&gt; Expr Type -&gt; Type -&gt; Expr Type)
-&gt; DesugarFn (Expr Type)
-&gt; DesugarFn (Expr Type -&gt; Type -&gt; Expr Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; DesugarFn (Expr Type)
</span><a href="IR.DesugarPattern.html#desugarExpr"><span class="hs-identifier hs-var">desugarExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515665"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">DesugarFn (Expr Type -&gt; Type -&gt; Expr Type)
-&gt; DesugarFn (Expr Type) -&gt; DesugarFn (Type -&gt; Expr Type)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; DesugarFn (Expr Type)
</span><a href="IR.DesugarPattern.html#desugarExpr"><span class="hs-identifier hs-var">desugarExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515664"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="annot"><span class="annottext">DesugarFn (Type -&gt; Expr Type)
-&gt; DesugarFn Type -&gt; DesugarFn (Expr Type)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; DesugarFn Type
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679515663"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-97"></span><span class="annot"><a href="IR.DesugarPattern.html#desugarExpr"><span class="hs-identifier hs-var">desugarExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#Let"><span class="hs-identifier hs-type">I.Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Binder Type, Expr Type)] -&gt; ([Binder Type], [Expr Type])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679515660"><span class="annot"><span class="annottext">[Binder Type]
</span><a href="#local-6989586621679515660"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679515659"><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679515659"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679515658"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515658"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679515657"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679515657"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-98"></span><span>  </span><span class="annot"><span class="annottext">[(Binder Type, Expr Type)] -&gt; Expr Type -&gt; Type -&gt; Expr Type
forall t. [(Binder t, Expr t)] -&gt; Expr t -&gt; t -&gt; Expr t
</span><a href="IR.IR.html#Let"><span class="hs-identifier hs-var">I.Let</span></a></span><span> </span><span class="annot"><span class="annottext">([(Binder Type, Expr Type)] -&gt; Expr Type -&gt; Type -&gt; Expr Type)
-&gt; DesugarFn [(Binder Type, Expr Type)]
-&gt; DesugarFn (Expr Type -&gt; Type -&gt; Expr Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Binder Type] -&gt; [Expr Type] -&gt; [(Binder Type, Expr Type)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Binder Type]
</span><a href="#local-6989586621679515660"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">([Expr Type] -&gt; [(Binder Type, Expr Type)])
-&gt; DesugarFn [Expr Type] -&gt; DesugarFn [(Binder Type, Expr Type)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Expr Type -&gt; DesugarFn (Expr Type))
-&gt; [Expr Type] -&gt; DesugarFn [Expr Type]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; DesugarFn (Expr Type)
</span><a href="IR.DesugarPattern.html#desugarExpr"><span class="hs-identifier hs-var">desugarExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679515659"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DesugarFn (Expr Type -&gt; Type -&gt; Expr Type)
-&gt; DesugarFn (Expr Type) -&gt; DesugarFn (Type -&gt; Expr Type)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; DesugarFn (Expr Type)
</span><a href="IR.DesugarPattern.html#desugarExpr"><span class="hs-identifier hs-var">desugarExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515658"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">DesugarFn (Type -&gt; Expr Type)
-&gt; DesugarFn Type -&gt; DesugarFn (Expr Type)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; DesugarFn Type
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679515657"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-99"></span><span class="annot"><a href="IR.DesugarPattern.html#desugarExpr"><span class="hs-identifier hs-var">desugarExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#Lambda"><span class="hs-identifier hs-type">I.Lambda</span></a></span><span> </span><span id="local-6989586621679515655"><span class="annot"><span class="annottext">Binder Type
</span><a href="#local-6989586621679515655"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679515654"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515654"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679515653"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679515653"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Binder Type -&gt; Expr Type -&gt; Type -&gt; Expr Type
forall t. Binder t -&gt; Expr t -&gt; t -&gt; Expr t
</span><a href="IR.IR.html#Lambda"><span class="hs-identifier hs-var">I.Lambda</span></a></span><span> </span><span class="annot"><span class="annottext">Binder Type
</span><a href="#local-6989586621679515655"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr Type -&gt; Type -&gt; Expr Type)
-&gt; DesugarFn (Expr Type) -&gt; DesugarFn (Type -&gt; Expr Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; DesugarFn (Expr Type)
</span><a href="IR.DesugarPattern.html#desugarExpr"><span class="hs-identifier hs-var">desugarExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515654"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">DesugarFn (Type -&gt; Expr Type)
-&gt; DesugarFn Type -&gt; DesugarFn (Expr Type)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; DesugarFn Type
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679515653"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-100"></span><span class="annot"><a href="IR.DesugarPattern.html#desugarExpr"><span class="hs-identifier hs-var">desugarExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#Prim"><span class="hs-identifier hs-type">I.Prim</span></a></span><span> </span><span id="local-6989586621679515651"><span class="annot"><span class="annottext">Primitive
</span><a href="#local-6989586621679515651"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679515650"><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679515650"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span id="local-6989586621679515649"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679515649"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Primitive -&gt; [Expr Type] -&gt; Type -&gt; Expr Type
forall t. Primitive -&gt; [Expr t] -&gt; t -&gt; Expr t
</span><a href="IR.IR.html#Prim"><span class="hs-identifier hs-var">I.Prim</span></a></span><span> </span><span class="annot"><span class="annottext">Primitive
</span><a href="#local-6989586621679515651"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">([Expr Type] -&gt; Type -&gt; Expr Type)
-&gt; DesugarFn [Expr Type] -&gt; DesugarFn (Type -&gt; Expr Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Expr Type -&gt; DesugarFn (Expr Type))
-&gt; [Expr Type] -&gt; DesugarFn [Expr Type]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; DesugarFn (Expr Type)
</span><a href="IR.DesugarPattern.html#desugarExpr"><span class="hs-identifier hs-var">desugarExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679515650"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">DesugarFn (Type -&gt; Expr Type)
-&gt; DesugarFn Type -&gt; DesugarFn (Expr Type)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; DesugarFn Type
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679515649"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-101"></span><span class="annot"><a href="IR.DesugarPattern.html#desugarExpr"><span class="hs-identifier hs-var">desugarExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#Match"><span class="hs-identifier hs-type">I.Match</span></a></span><span> </span><span id="local-6989586621679515647"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515647"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679515646"><span class="annot"><span class="annottext">[(Alt Type, Expr Type)]
</span><a href="#local-6989586621679515646"><span class="hs-identifier hs-var">arms</span></a></span></span><span> </span><span id="local-6989586621679515645"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679515645"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-102"></span><span>  </span><span id="local-6989586621679515644"><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515644"><span class="hs-identifier hs-var">eqns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Alt Type, Expr Type)]
-&gt; ((Alt Type, Expr Type) -&gt; DesugarFn ([Alt Type], Expr Type))
-&gt; DesugarFn [([Alt Type], Expr Type)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[(Alt Type, Expr Type)]
</span><a href="#local-6989586621679515646"><span class="hs-identifier hs-var">arms</span></a></span><span> </span><span class="annot"><span class="annottext">(((Alt Type, Expr Type) -&gt; DesugarFn ([Alt Type], Expr Type))
 -&gt; DesugarFn [([Alt Type], Expr Type)])
-&gt; ((Alt Type, Expr Type) -&gt; DesugarFn ([Alt Type], Expr Type))
-&gt; DesugarFn [([Alt Type], Expr Type)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679515643"><span class="annot"><span class="annottext">Alt Type
</span><a href="#local-6989586621679515643"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679515642"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515642"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-comment">-- Generate an 'Equation' for each arm</span><span>
</span><span id="line-104"></span><span>    </span><span id="local-6989586621679515641"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515641"><span class="hs-identifier hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; DesugarFn (Expr Type)
</span><a href="IR.DesugarPattern.html#desugarExpr"><span class="hs-identifier hs-var">desugarExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515642"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><span class="annottext">([Alt Type], Expr Type) -&gt; DesugarFn ([Alt Type], Expr Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Alt Type
</span><a href="#local-6989586621679515643"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515641"><span class="hs-identifier hs-var">body'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515647"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-107"></span><span>    </span><span class="annot"><a href="IR.IR.html#Var"><span class="hs-identifier hs-type">I.Var</span></a></span><span> </span><span class="annot"><span class="annottext">VarId
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Expr Type]
-&gt; [([Alt Type], Expr Type)] -&gt; Expr Type -&gt; DesugarFn (Expr Type)
</span><a href="IR.DesugarPattern.html#desugarMatch"><span class="hs-identifier hs-var">desugarMatch</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515647"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515644"><span class="hs-identifier hs-var">eqns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Expr Type
</span><a href="IR.DesugarPattern.html#unreachableExpr"><span class="hs-identifier hs-var">unreachableExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679515645"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TODO: add let alias</span><span>
</span><span id="line-108"></span><span>    </span><span class="annot"><span class="annottext">Expr Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-109"></span><span>      </span><span class="hs-comment">-- Bind scrutinee to a variable before threading it through desugarMatch</span><span>
</span><span id="line-110"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679515638"><span class="annot"><span class="annottext">et :: Type
</span><a href="#local-6989586621679515638"><span class="hs-identifier hs-var hs-var">et</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; Type
forall (c :: * -&gt; *) a. Carrier c =&gt; c a -&gt; a
</span><a href="IR.IR.html#extract"><span class="hs-identifier hs-var">I.extract</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515647"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-111"></span><span>      </span><span id="local-6989586621679515636"><span class="annot"><span class="annottext">VarId
</span><a href="#local-6989586621679515636"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; DesugarFn VarId
</span><a href="IR.DesugarPattern.html#freshVar"><span class="hs-identifier hs-var">freshVar</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679515638"><span class="hs-identifier hs-var">et</span></a></span><span>
</span><span id="line-112"></span><span>      </span><span class="annot"><span class="annottext">[(Binder Type, Expr Type)] -&gt; Expr Type -&gt; Type -&gt; Expr Type
forall t. [(Binder t, Expr t)] -&gt; Expr t -&gt; t -&gt; Expr t
</span><a href="IR.IR.html#Let"><span class="hs-identifier hs-var">I.Let</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarId -&gt; Type -&gt; Binder Type
forall t. VarId -&gt; t -&gt; Binder t
</span><a href="IR.IR.html#BindVar"><span class="hs-identifier hs-var">I.BindVar</span></a></span><span> </span><span class="annot"><span class="annottext">VarId
</span><a href="#local-6989586621679515636"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679515638"><span class="hs-identifier hs-var">et</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515647"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-113"></span><span>        </span><span class="annot"><span class="annottext">(Expr Type -&gt; Type -&gt; Expr Type)
-&gt; DesugarFn (Expr Type) -&gt; DesugarFn (Type -&gt; Expr Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Expr Type]
-&gt; [([Alt Type], Expr Type)] -&gt; Expr Type -&gt; DesugarFn (Expr Type)
</span><a href="IR.DesugarPattern.html#desugarMatch"><span class="hs-identifier hs-var">desugarMatch</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">VarId -&gt; Type -&gt; Expr Type
forall t. VarId -&gt; t -&gt; Expr t
</span><a href="IR.IR.html#Var"><span class="hs-identifier hs-var">I.Var</span></a></span><span> </span><span class="annot"><span class="annottext">VarId
</span><a href="#local-6989586621679515636"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679515638"><span class="hs-identifier hs-var">et</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515644"><span class="hs-identifier hs-var">eqns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Expr Type
</span><a href="IR.DesugarPattern.html#unreachableExpr"><span class="hs-identifier hs-var">unreachableExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679515645"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>        </span><span class="annot"><span class="annottext">DesugarFn (Type -&gt; Expr Type)
-&gt; DesugarFn Type -&gt; DesugarFn (Expr Type)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; DesugarFn Type
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679515638"><span class="hs-identifier hs-var">et</span></a></span><span>
</span><span id="line-115"></span><span class="annot"><a href="IR.DesugarPattern.html#desugarExpr"><span class="hs-identifier hs-var">desugarExpr</span></a></span><span> </span><span id="local-6989586621679515634"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515634"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; DesugarFn (Expr Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515634"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="annot"><a href="IR.DesugarPattern.html#desugarMatch"><span class="hs-identifier hs-type">desugarMatch</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="IR.IR.html#Expr"><span class="hs-identifier hs-type">I.Expr</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="IR.DesugarPattern.html#Equation"><span class="hs-identifier hs-type">Equation</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-121"></span><span>  </span><span class="annot"><a href="IR.IR.html#Expr"><span class="hs-identifier hs-type">I.Expr</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- Default expression the 'I.Match' should return</span><span>
</span><span id="line-122"></span><span>  </span><span class="annot"><a href="IR.DesugarPattern.html#DesugarFn"><span class="hs-identifier hs-type">DesugarFn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#Expr"><span class="hs-identifier hs-type">I.Expr</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span id="desugarMatch"><span class="annot"><span class="annottext">desugarMatch :: [Expr Type]
-&gt; [([Alt Type], Expr Type)] -&gt; Expr Type -&gt; DesugarFn (Expr Type)
</span><a href="IR.DesugarPattern.html#desugarMatch"><span class="hs-identifier hs-var hs-var">desugarMatch</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679515633"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515633"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; DesugarFn (Expr Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515633"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-124"></span><span class="annot"><a href="IR.DesugarPattern.html#desugarMatch"><span class="hs-identifier hs-var">desugarMatch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679515632"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515632"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; DesugarFn (Expr Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515632"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-125"></span><span class="annot"><a href="IR.DesugarPattern.html#desugarMatch"><span class="hs-identifier hs-var">desugarMatch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; DesugarFn (Expr Type)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;can't happen 1&quot;</span></span><span>
</span><span id="line-126"></span><span class="annot"><a href="IR.DesugarPattern.html#desugarMatch"><span class="hs-identifier hs-var">desugarMatch</span></a></span><span> </span><span id="local-6989586621679515630"><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679515630"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span id="local-6989586621679515629"><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515629"><span class="hs-identifier hs-var">eqs</span></a></span></span><span> </span><span id="local-6989586621679515628"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515628"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([([Alt Type], Expr Type)] -&gt; Expr Type -&gt; DesugarFn (Expr Type))
-&gt; Expr Type
-&gt; [[([Alt Type], Expr Type)]]
-&gt; DesugarFn (Expr Type)
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; b -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldrM</span></span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)] -&gt; Expr Type -&gt; DesugarFn (Expr Type)
</span><a href="#local-6989586621679515627"><span class="hs-identifier hs-var">desugarMatchGen</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515628"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">([[([Alt Type], Expr Type)]] -&gt; DesugarFn (Expr Type))
-&gt; [[([Alt Type], Expr Type)]] -&gt; DesugarFn (Expr Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)] -&gt; [[([Alt Type], Expr Type)]]
</span><a href="#local-6989586621679515626"><span class="hs-identifier hs-var">partitionEqs</span></a></span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515629"><span class="hs-identifier hs-var">eqs</span></a></span><span>
</span><span id="line-127"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-128"></span><span>  </span><span id="local-6989586621679515627"><span class="annot"><span class="annottext">desugarMatchGen :: [([Alt Type], Expr Type)] -&gt; Expr Type -&gt; DesugarFn (Expr Type)
</span><a href="#local-6989586621679515627"><span class="hs-identifier hs-var hs-var">desugarMatchGen</span></a></span></span><span> </span><span id="local-6989586621679515625"><span class="annot"><span class="annottext">qs :: [([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515625"><span class="hs-identifier hs-var">qs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679515624"><span class="annot"><span class="annottext">([Alt Type], Expr Type)
</span><a href="#local-6989586621679515624"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">([Alt Type], Expr Type) -&gt; Bool
forall t b. ([Alt t], b) -&gt; Bool
</span><a href="#local-6989586621679515623"><span class="hs-identifier hs-var">isVarEq</span></a></span><span> </span><span class="annot"><span class="annottext">([Alt Type], Expr Type)
</span><a href="#local-6989586621679515624"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Expr Type]
-&gt; [([Alt Type], Expr Type)] -&gt; Expr Type -&gt; DesugarFn (Expr Type)
</span><a href="IR.DesugarPattern.html#desugarMatchVar"><span class="hs-identifier hs-var">desugarMatchVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679515630"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515625"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">([Alt Type], Expr Type) -&gt; Bool
forall t b. ([Alt t], b) -&gt; Bool
</span><a href="#local-6989586621679515621"><span class="hs-identifier hs-var">isConsEq</span></a></span><span> </span><span class="annot"><span class="annottext">([Alt Type], Expr Type)
</span><a href="#local-6989586621679515624"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Expr Type]
-&gt; [([Alt Type], Expr Type)] -&gt; Expr Type -&gt; DesugarFn (Expr Type)
</span><a href="IR.DesugarPattern.html#desugarMatchCons"><span class="hs-identifier hs-var">desugarMatchCons</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679515630"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515625"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">([Alt Type], Expr Type) -&gt; Bool
forall t b. ([Alt t], b) -&gt; Bool
</span><a href="#local-6989586621679515619"><span class="hs-identifier hs-var">isLitEq</span></a></span><span> </span><span class="annot"><span class="annottext">([Alt Type], Expr Type)
</span><a href="#local-6989586621679515624"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Expr Type]
-&gt; [([Alt Type], Expr Type)] -&gt; Expr Type -&gt; DesugarFn (Expr Type)
</span><a href="IR.DesugarPattern.html#desugarMatchLit"><span class="hs-identifier hs-var">desugarMatchLit</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679515630"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515625"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">([Alt Type], Expr Type) -&gt; Bool
forall t b. ([Alt t], b) -&gt; Bool
</span><a href="#local-6989586621679515617"><span class="hs-identifier hs-var">isWildEq</span></a></span><span> </span><span class="annot"><span class="annottext">([Alt Type], Expr Type)
</span><a href="#local-6989586621679515624"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Expr Type]
-&gt; [([Alt Type], Expr Type)] -&gt; Expr Type -&gt; DesugarFn (Expr Type)
</span><a href="IR.DesugarPattern.html#desugarMatchWild"><span class="hs-identifier hs-var">desugarMatchWild</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679515630"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515625"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-133"></span><span>  </span><span class="annot"><a href="#local-6989586621679515627"><span class="hs-identifier hs-var">desugarMatchGen</span></a></span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Expr Type -&gt; DesugarFn (Expr Type)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;can't happen 2&quot;</span></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span>  </span><span class="annot"><a href="#local-6989586621679515626"><span class="hs-identifier hs-type">partitionEqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="IR.DesugarPattern.html#Equation"><span class="hs-identifier hs-type">Equation</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="IR.DesugarPattern.html#Equation"><span class="hs-identifier hs-type">Equation</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-136"></span><span>  </span><span id="local-6989586621679515626"><span class="annot"><span class="annottext">partitionEqs :: [([Alt Type], Expr Type)] -&gt; [[([Alt Type], Expr Type)]]
</span><a href="#local-6989586621679515626"><span class="hs-identifier hs-var hs-var">partitionEqs</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-137"></span><span>  </span><span class="annot"><a href="#local-6989586621679515626"><span class="hs-identifier hs-var">partitionEqs</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679515615"><span class="annot"><span class="annottext">([Alt Type], Expr Type)
</span><a href="#local-6989586621679515615"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><span class="annottext">([Alt Type], Expr Type)
</span><a href="#local-6989586621679515615"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-138"></span><span>  </span><span class="annot"><a href="#local-6989586621679515626"><span class="hs-identifier hs-var">partitionEqs</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679515614"><span class="annot"><span class="annottext">([Alt Type], Expr Type)
</span><a href="#local-6989586621679515614"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679515613"><span class="annot"><span class="annottext">([Alt Type], Expr Type)
</span><a href="#local-6989586621679515613"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679515612"><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515612"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">([Alt Type], Expr Type) -&gt; ([Alt Type], Expr Type) -&gt; Bool
forall t b t b. ([Alt t], b) -&gt; ([Alt t], b) -&gt; Bool
</span><a href="#local-6989586621679515611"><span class="hs-identifier hs-var">sameGroup</span></a></span><span> </span><span class="annot"><span class="annottext">([Alt Type], Expr Type)
</span><a href="#local-6989586621679515614"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">([Alt Type], Expr Type)
</span><a href="#local-6989586621679515613"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Alt Type], Expr Type)
-&gt; [[([Alt Type], Expr Type)]] -&gt; [[([Alt Type], Expr Type)]]
forall a. a -&gt; [[a]] -&gt; [[a]]
</span><a href="#local-6989586621679515610"><span class="hs-identifier hs-var">tack</span></a></span><span> </span><span class="annot"><span class="annottext">([Alt Type], Expr Type)
</span><a href="#local-6989586621679515614"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)] -&gt; [[([Alt Type], Expr Type)]]
</span><a href="#local-6989586621679515626"><span class="hs-identifier hs-var">partitionEqs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Alt Type], Expr Type)
</span><a href="#local-6989586621679515613"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">([Alt Type], Expr Type)
-&gt; [([Alt Type], Expr Type)] -&gt; [([Alt Type], Expr Type)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515612"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">([Alt Type], Expr Type)
</span><a href="#local-6989586621679515614"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
-&gt; [[([Alt Type], Expr Type)]] -&gt; [[([Alt Type], Expr Type)]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)] -&gt; [[([Alt Type], Expr Type)]]
</span><a href="#local-6989586621679515626"><span class="hs-identifier hs-var">partitionEqs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Alt Type], Expr Type)
</span><a href="#local-6989586621679515613"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">([Alt Type], Expr Type)
-&gt; [([Alt Type], Expr Type)] -&gt; [([Alt Type], Expr Type)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515612"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span>  </span><span id="local-6989586621679515610"><span class="annot"><span class="annottext">tack :: a -&gt; [[a]] -&gt; [[a]]
</span><a href="#local-6989586621679515610"><span class="hs-identifier hs-var hs-var">tack</span></a></span></span><span> </span><span id="local-6989586621679515609"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679515609"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621679515608"><span class="annot"><span class="annottext">[[a]]
</span><a href="#local-6989586621679515608"><span class="hs-identifier hs-var">yss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679515609"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[[a]] -&gt; [a]
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[[a]]
</span><a href="#local-6989586621679515608"><span class="hs-identifier hs-var">yss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [[a]] -&gt; [[a]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[[a]] -&gt; [[a]]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="annot"><span class="annottext">[[a]]
</span><a href="#local-6989586621679515608"><span class="hs-identifier hs-var">yss</span></a></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span>  </span><span id="local-6989586621679515611"><span class="annot"><span class="annottext">sameGroup :: ([Alt t], b) -&gt; ([Alt t], b) -&gt; Bool
</span><a href="#local-6989586621679515611"><span class="hs-identifier hs-var hs-var">sameGroup</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#AltLit"><span class="hs-identifier hs-type">I.AltLit</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Alt t]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#AltLit"><span class="hs-identifier hs-type">I.AltLit</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Alt t]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-145"></span><span>  </span><span class="annot"><a href="#local-6989586621679515611"><span class="hs-identifier hs-var">sameGroup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#AltBinder"><span class="hs-identifier hs-type">I.AltBinder</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Alt t]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#AltBinder"><span class="hs-identifier hs-type">I.AltBinder</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Alt t]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-146"></span><span>  </span><span class="annot"><a href="#local-6989586621679515611"><span class="hs-identifier hs-var">sameGroup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#AltData"><span class="hs-identifier hs-type">I.AltData</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Alt t]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#AltData"><span class="hs-identifier hs-type">I.AltData</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Alt t]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-147"></span><span>  </span><span class="annot"><a href="#local-6989586621679515611"><span class="hs-identifier hs-var">sameGroup</span></a></span><span> </span><span class="annot"><span class="annottext">([Alt t], b)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">([Alt t], b)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span>  </span><span id="local-6989586621679515617"><span class="annot"><span class="annottext">isWildEq :: ([Alt t], b) -&gt; Bool
</span><a href="#local-6989586621679515617"><span class="hs-identifier hs-var hs-var">isWildEq</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#AltBinder"><span class="hs-identifier hs-type">I.AltBinder</span></a></span><span> </span><span class="annot"><a href="IR.IR.html#BindAnon"><span class="hs-identifier hs-type">I.BindAnon</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Alt t]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-150"></span><span>  </span><span class="annot"><a href="#local-6989586621679515617"><span class="hs-identifier hs-var">isWildEq</span></a></span><span> </span><span class="annot"><span class="annottext">([Alt t], b)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-151"></span><span>  </span><span id="local-6989586621679515623"><span class="annot"><span class="annottext">isVarEq :: ([Alt t], b) -&gt; Bool
</span><a href="#local-6989586621679515623"><span class="hs-identifier hs-var hs-var">isVarEq</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#AltBinder"><span class="hs-identifier hs-type">I.AltBinder</span></a></span><span> </span><span class="annot"><a href="IR.IR.html#BindVar"><span class="hs-identifier hs-type">I.BindVar</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Alt t]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-152"></span><span>  </span><span class="annot"><a href="#local-6989586621679515623"><span class="hs-identifier hs-var">isVarEq</span></a></span><span> </span><span class="annot"><span class="annottext">([Alt t], b)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-153"></span><span>  </span><span id="local-6989586621679515621"><span class="annot"><span class="annottext">isConsEq :: ([Alt t], b) -&gt; Bool
</span><a href="#local-6989586621679515621"><span class="hs-identifier hs-var hs-var">isConsEq</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#AltData"><span class="hs-identifier hs-type">I.AltData</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Alt t]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-154"></span><span>  </span><span class="annot"><a href="#local-6989586621679515621"><span class="hs-identifier hs-var">isConsEq</span></a></span><span> </span><span class="annot"><span class="annottext">([Alt t], b)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-155"></span><span>  </span><span id="local-6989586621679515619"><span class="annot"><span class="annottext">isLitEq :: ([Alt t], b) -&gt; Bool
</span><a href="#local-6989586621679515619"><span class="hs-identifier hs-var hs-var">isLitEq</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#AltLit"><span class="hs-identifier hs-type">I.AltLit</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Alt t]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-156"></span><span>  </span><span class="annot"><a href="#local-6989586621679515619"><span class="hs-identifier hs-var">isLitEq</span></a></span><span> </span><span class="annot"><span class="annottext">([Alt t], b)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="annot"><a href="IR.DesugarPattern.html#desugarMatchVar"><span class="hs-identifier hs-type">desugarMatchVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="IR.IR.html#Expr"><span class="hs-identifier hs-type">I.Expr</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="IR.DesugarPattern.html#Equation"><span class="hs-identifier hs-type">Equation</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.IR.html#Expr"><span class="hs-identifier hs-type">I.Expr</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#DesugarFn"><span class="hs-identifier hs-type">DesugarFn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#Expr"><span class="hs-identifier hs-type">I.Expr</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span id="desugarMatchVar"><span class="annot"><span class="annottext">desugarMatchVar :: [Expr Type]
-&gt; [([Alt Type], Expr Type)] -&gt; Expr Type -&gt; DesugarFn (Expr Type)
</span><a href="IR.DesugarPattern.html#desugarMatchVar"><span class="hs-identifier hs-var hs-var">desugarMatchVar</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679515601"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515601"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679515600"><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679515600"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679515599"><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515599"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span id="local-6989586621679515598"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515598"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-comment">-- Create a let-bound alias for 'u' named 'v' in each equation</span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679515597"><span class="annot"><span class="annottext">qs' :: [([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515597"><span class="hs-identifier hs-var hs-var">qs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Alt Type]
</span><a href="#local-6989586621679515596"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Binder Type, Expr Type)] -&gt; Expr Type -&gt; Type -&gt; Expr Type
forall t. [(Binder t, Expr t)] -&gt; Expr t -&gt; t -&gt; Expr t
</span><a href="IR.IR.html#Let"><span class="hs-identifier hs-var">I.Let</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Binder Type
</span><a href="#local-6989586621679515595"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515601"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515594"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Expr Type) -&gt; Type -&gt; Expr Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; Type
forall (c :: * -&gt; *) a. Carrier c =&gt; c a -&gt; a
</span><a href="IR.IR.html#extract"><span class="hs-identifier hs-var">I.extract</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515594"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#AltBinder"><span class="hs-identifier hs-type">I.AltBinder</span></a></span><span> </span><span id="local-6989586621679515595"><span class="annot"><span class="annottext">Binder Type
</span><a href="#local-6989586621679515595"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679515596"><span class="annot"><span class="annottext">[Alt Type]
</span><a href="#local-6989586621679515596"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679515594"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515594"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515599"><span class="hs-identifier hs-var">qs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-163"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Expr Type]
-&gt; [([Alt Type], Expr Type)] -&gt; Expr Type -&gt; DesugarFn (Expr Type)
</span><a href="IR.DesugarPattern.html#desugarMatch"><span class="hs-identifier hs-var">desugarMatch</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679515600"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515597"><span class="hs-identifier hs-var">qs'</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515598"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-164"></span><span class="annot"><a href="IR.DesugarPattern.html#desugarMatchVar"><span class="hs-identifier hs-var">desugarMatchVar</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; DesugarFn (Expr Type)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;can't happen 3&quot;</span></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="annot"><a href="IR.DesugarPattern.html#desugarMatchWild"><span class="hs-identifier hs-type">desugarMatchWild</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="IR.IR.html#Expr"><span class="hs-identifier hs-type">I.Expr</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="IR.DesugarPattern.html#Equation"><span class="hs-identifier hs-type">Equation</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.IR.html#Expr"><span class="hs-identifier hs-type">I.Expr</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#DesugarFn"><span class="hs-identifier hs-type">DesugarFn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#Expr"><span class="hs-identifier hs-type">I.Expr</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span id="desugarMatchWild"><span class="annot"><span class="annottext">desugarMatchWild :: [Expr Type]
-&gt; [([Alt Type], Expr Type)] -&gt; Expr Type -&gt; DesugarFn (Expr Type)
</span><a href="IR.DesugarPattern.html#desugarMatchWild"><span class="hs-identifier hs-var hs-var">desugarMatchWild</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679515593"><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679515593"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679515592"><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515592"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span id="local-6989586621679515591"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515591"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-comment">-- Discard first 'I.Alt' from each equation</span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679515590"><span class="annot"><span class="annottext">qs' :: [([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515590"><span class="hs-identifier hs-var hs-var">qs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Alt Type]
</span><a href="#local-6989586621679515589"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515588"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Alt Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679515589"><span class="annot"><span class="annottext">[Alt Type]
</span><a href="#local-6989586621679515589"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679515588"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515588"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515592"><span class="hs-identifier hs-var">qs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-171"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Expr Type]
-&gt; [([Alt Type], Expr Type)] -&gt; Expr Type -&gt; DesugarFn (Expr Type)
</span><a href="IR.DesugarPattern.html#desugarMatch"><span class="hs-identifier hs-var">desugarMatch</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679515593"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515590"><span class="hs-identifier hs-var">qs'</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515591"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-172"></span><span class="annot"><a href="IR.DesugarPattern.html#desugarMatchWild"><span class="hs-identifier hs-var">desugarMatchWild</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; DesugarFn (Expr Type)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;can't happen 4&quot;</span></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="annot"><a href="IR.DesugarPattern.html#desugarMatchCons"><span class="hs-identifier hs-type">desugarMatchCons</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="IR.IR.html#Expr"><span class="hs-identifier hs-type">I.Expr</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="IR.DesugarPattern.html#Equation"><span class="hs-identifier hs-type">Equation</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.IR.html#Expr"><span class="hs-identifier hs-type">I.Expr</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#DesugarFn"><span class="hs-identifier hs-type">DesugarFn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#Expr"><span class="hs-identifier hs-type">I.Expr</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span id="desugarMatchCons"><span class="annot"><span class="annottext">desugarMatchCons :: [Expr Type]
-&gt; [([Alt Type], Expr Type)] -&gt; Expr Type -&gt; DesugarFn (Expr Type)
</span><a href="IR.DesugarPattern.html#desugarMatchCons"><span class="hs-identifier hs-var hs-var">desugarMatchCons</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679515587"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515587"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679515586"><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679515586"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679515585"><span class="annot"><span class="annottext">qs :: [([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515585"><span class="hs-identifier hs-var">qs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679515584"><span class="annot"><span class="annottext">([Alt Type], Expr Type)
</span><a href="#local-6989586621679515584"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679515583"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515583"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-177"></span><span>  </span><span id="local-6989586621679515582"><span class="annot"><span class="annottext">Set DConId
</span><a href="#local-6989586621679515582"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DConId -&gt; DesugarFn (Set DConId)
</span><a href="IR.DesugarPattern.html#getConstructors"><span class="hs-identifier hs-var">getConstructors</span></a></span><span> </span><span class="annot"><span class="annottext">(DConId -&gt; DesugarFn (Set DConId))
-&gt; DConId -&gt; DesugarFn (Set DConId)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([Alt Type], Expr Type) -&gt; DConId
forall t b. ([Alt t], b) -&gt; DConId
</span><a href="#local-6989586621679515580"><span class="hs-identifier hs-var">getCon</span></a></span><span> </span><span class="annot"><span class="annottext">([Alt Type], Expr Type)
</span><a href="#local-6989586621679515584"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-178"></span><span>  </span><span id="local-6989586621679515579"><span class="annot"><span class="annottext">[(Alt Type, Expr Type)]
</span><a href="#local-6989586621679515579"><span class="hs-identifier hs-var">arms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[DesugarFn (Alt Type, Expr Type)]
-&gt; DesugarFn [(Alt Type, Expr Type)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
</span><span class="hs-identifier hs-var">sequence</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DConId
-&gt; Type
-&gt; [([Alt Type], Expr Type)]
-&gt; DesugarFn (Alt Type, Expr Type)
</span><a href="#local-6989586621679515577"><span class="hs-identifier hs-var">desugarArm</span></a></span><span> </span><span class="annot"><span class="annottext">DConId
</span><a href="#local-6989586621679515576"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Alt Type], Expr Type) -&gt; Type
forall p b. ([Alt p], b) -&gt; p
</span><a href="#local-6989586621679515575"><span class="hs-identifier hs-var">getTyp</span></a></span><span> </span><span class="annot"><span class="annottext">([Alt Type], Expr Type)
</span><a href="#local-6989586621679515584"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DConId -&gt; [([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515574"><span class="hs-identifier hs-var">sameConsAs</span></a></span><span> </span><span class="annot"><span class="annottext">DConId
</span><a href="#local-6989586621679515576"><span class="hs-identifier hs-var">dcon</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679515576"><span class="annot"><span class="annottext">DConId
</span><a href="#local-6989586621679515576"><span class="hs-identifier hs-var">dcon</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set DConId -&gt; [DConId]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">Set DConId
</span><a href="#local-6989586621679515582"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-179"></span><span>  </span><span class="annot"><span class="annottext">Expr Type -&gt; DesugarFn (Expr Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Expr Type -&gt; DesugarFn (Expr Type))
-&gt; Expr Type -&gt; DesugarFn (Expr Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; [(Alt Type, Expr Type)] -&gt; Type -&gt; Expr Type
forall t. Expr t -&gt; [(Alt t, Expr t)] -&gt; t -&gt; Expr t
</span><a href="IR.IR.html#Match"><span class="hs-identifier hs-var">I.Match</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515587"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">[(Alt Type, Expr Type)]
</span><a href="#local-6989586621679515579"><span class="hs-identifier hs-var">arms</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr Type -&gt; Type
forall (c :: * -&gt; *) a. Carrier c =&gt; c a -&gt; a
</span><a href="IR.IR.html#extract"><span class="hs-identifier hs-var">I.extract</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515583"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-181"></span><span>  </span><span id="local-6989586621679515580"><span class="annot"><span class="annottext">getCon :: ([Alt t], b) -&gt; DConId
</span><a href="#local-6989586621679515580"><span class="hs-identifier hs-var hs-var">getCon</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#AltData"><span class="hs-identifier hs-type">I.AltData</span></a></span><span> </span><span id="local-6989586621679515572"><span class="annot"><span class="annottext">DConId
</span><a href="#local-6989586621679515572"><span class="hs-identifier hs-var">dcon</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Alt t]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Alt t]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DConId
</span><a href="#local-6989586621679515572"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-182"></span><span>  </span><span class="annot"><a href="#local-6989586621679515580"><span class="hs-identifier hs-var">getCon</span></a></span><span> </span><span class="annot"><span class="annottext">([Alt t], b)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; DConId
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;can't happen 5&quot;</span></span><span>
</span><span id="line-183"></span><span>  </span><span id="local-6989586621679515575"><span class="annot"><span class="annottext">getTyp :: ([Alt p], b) -&gt; p
</span><a href="#local-6989586621679515575"><span class="hs-identifier hs-var hs-var">getTyp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#AltData"><span class="hs-identifier hs-type">I.AltData</span></a></span><span> </span><span class="annot"><span class="annottext">DConId
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Alt p]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679515571"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679515571"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Alt p]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679515571"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-184"></span><span>  </span><span class="annot"><a href="#local-6989586621679515575"><span class="hs-identifier hs-var">getTyp</span></a></span><span> </span><span class="annot"><span class="annottext">([Alt p], b)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; p
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;no no no 555&quot;</span></span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span>  </span><span id="local-6989586621679515574"><span class="annot"><span class="annottext">sameConsAs :: DConId -&gt; [([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515574"><span class="hs-identifier hs-var hs-var">sameConsAs</span></a></span></span><span> </span><span id="local-6989586621679515570"><span class="annot"><span class="annottext">DConId
</span><a href="#local-6989586621679515570"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(([Alt Type], Expr Type) -&gt; Bool)
-&gt; [([Alt Type], Expr Type)] -&gt; [([Alt Type], Expr Type)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">DConId -&gt; DConId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DConId
</span><a href="#local-6989586621679515570"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DConId -&gt; Bool)
-&gt; (([Alt Type], Expr Type) -&gt; DConId)
-&gt; ([Alt Type], Expr Type)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([Alt Type], Expr Type) -&gt; DConId
forall t b. ([Alt t], b) -&gt; DConId
</span><a href="#local-6989586621679515580"><span class="hs-identifier hs-var">getCon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515585"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span>  </span><span class="annot"><a href="#local-6989586621679515577"><span class="hs-identifier hs-type">desugarArm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Common.Identifiers.html#DConId"><span class="hs-identifier hs-type">I.DConId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="IR.DesugarPattern.html#Equation"><span class="hs-identifier hs-type">Equation</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#DesugarFn"><span class="hs-identifier hs-type">DesugarFn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#Alt"><span class="hs-identifier hs-type">I.Alt</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IR.IR.html#Expr"><span class="hs-identifier hs-type">I.Expr</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>  </span><span id="local-6989586621679515577"><span class="annot"><span class="annottext">desugarArm :: DConId
-&gt; Type
-&gt; [([Alt Type], Expr Type)]
-&gt; DesugarFn (Alt Type, Expr Type)
</span><a href="#local-6989586621679515577"><span class="hs-identifier hs-var hs-var">desugarArm</span></a></span></span><span> </span><span id="local-6989586621679515568"><span class="annot"><span class="annottext">DConId
</span><a href="#local-6989586621679515568"><span class="hs-identifier hs-var">dcon</span></a></span></span><span> </span><span id="local-6989586621679515567"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679515567"><span class="hs-identifier hs-var">dconTyp</span></a></span></span><span> </span><span id="local-6989586621679515566"><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515566"><span class="hs-identifier hs-var">qs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-190"></span><span>    </span><span id="local-6989586621679515565"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679515565"><span class="hs-identifier hs-var">argsTyps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CInfo -&gt; [Type]
</span><a href="IR.DesugarPattern.html#argsType"><span class="hs-identifier hs-var hs-var">argsType</span></a></span><span> </span><span class="annot"><span class="annottext">(CInfo -&gt; [Type]) -&gt; DesugarFn CInfo -&gt; DesugarFn [Type]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">DConId -&gt; DesugarFn CInfo
</span><a href="IR.DesugarPattern.html#getCInfo"><span class="hs-identifier hs-var">getCInfo</span></a></span><span> </span><span class="annot"><span class="annottext">DConId
</span><a href="#local-6989586621679515568"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Alt Type, Expr Type)] -&gt; ([Alt Type], [Expr Type])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679515563"><span class="annot"><span class="annottext">[Alt Type]
</span><a href="#local-6989586621679515563"><span class="hs-identifier hs-var">bs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679515562"><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679515562"><span class="hs-identifier hs-var">us'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type]
-&gt; (Type -&gt; DesugarFn (Alt Type, Expr Type))
-&gt; DesugarFn [(Alt Type, Expr Type)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679515565"><span class="hs-identifier hs-var">argsTyps</span></a></span><span> </span><span class="annot"><span class="annottext">((Type -&gt; DesugarFn (Alt Type, Expr Type))
 -&gt; DesugarFn [(Alt Type, Expr Type)])
-&gt; (Type -&gt; DesugarFn (Alt Type, Expr Type))
-&gt; DesugarFn [(Alt Type, Expr Type)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679515561"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679515561"><span class="hs-identifier hs-var">argTyp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-193"></span><span>      </span><span id="local-6989586621679515560"><span class="annot"><span class="annottext">VarId
</span><a href="#local-6989586621679515560"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; DesugarFn VarId
</span><a href="IR.DesugarPattern.html#freshVar"><span class="hs-identifier hs-var">freshVar</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679515561"><span class="hs-identifier hs-var">argTyp</span></a></span><span>
</span><span id="line-194"></span><span>      </span><span class="annot"><span class="annottext">(Alt Type, Expr Type) -&gt; DesugarFn (Alt Type, Expr Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Binder Type -&gt; Alt Type
forall t. Binder t -&gt; Alt t
</span><a href="IR.IR.html#AltBinder"><span class="hs-identifier hs-var">I.AltBinder</span></a></span><span> </span><span class="annot"><span class="annottext">(Binder Type -&gt; Alt Type) -&gt; Binder Type -&gt; Alt Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarId -&gt; Type -&gt; Binder Type
forall t. VarId -&gt; t -&gt; Binder t
</span><a href="IR.IR.html#BindVar"><span class="hs-identifier hs-var">I.BindVar</span></a></span><span> </span><span class="annot"><span class="annottext">VarId
</span><a href="#local-6989586621679515560"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679515561"><span class="hs-identifier hs-var">argTyp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VarId -&gt; Type -&gt; Expr Type
forall t. VarId -&gt; t -&gt; Expr t
</span><a href="IR.IR.html#Var"><span class="hs-identifier hs-var">I.Var</span></a></span><span> </span><span class="annot"><span class="annottext">VarId
</span><a href="#local-6989586621679515560"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679515561"><span class="hs-identifier hs-var">argTyp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span>    </span><span id="local-6989586621679515559"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515559"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-197"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515566"><span class="hs-identifier hs-var">qs'</span></a></span><span>
</span><span id="line-198"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-199"></span><span>          </span><span class="hs-comment">-- We're done desugaring this equation, just use default body</span><span>
</span><span id="line-200"></span><span>          </span><span class="annot"><span class="annottext">Expr Type -&gt; DesugarFn (Expr Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515583"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-201"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-202"></span><span>          </span><span class="hs-comment">-- Recursively generate body from remaining equations</span><span>
</span><span id="line-203"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679515557"><span class="annot"><span class="annottext">qs'' :: [([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515557"><span class="hs-identifier hs-var hs-var">qs''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Alt Type]
</span><a href="#local-6989586621679515556"><span class="hs-identifier hs-var">as'</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt Type] -&gt; [Alt Type] -&gt; [Alt Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Alt Type]
</span><a href="#local-6989586621679515555"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515554"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#AltData"><span class="hs-identifier hs-type">I.AltData</span></a></span><span> </span><span class="annot"><span class="annottext">DConId
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679515556"><span class="annot"><span class="annottext">[Alt Type]
</span><a href="#local-6989586621679515556"><span class="hs-identifier hs-var">as'</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679515555"><span class="annot"><span class="annottext">[Alt Type]
</span><a href="#local-6989586621679515555"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679515554"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515554"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515566"><span class="hs-identifier hs-var">qs'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-204"></span><span>          </span><span class="annot"><span class="annottext">[Expr Type]
-&gt; [([Alt Type], Expr Type)] -&gt; Expr Type -&gt; DesugarFn (Expr Type)
</span><a href="IR.DesugarPattern.html#desugarMatch"><span class="hs-identifier hs-var">desugarMatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679515562"><span class="hs-identifier hs-var">us'</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr Type] -&gt; [Expr Type] -&gt; [Expr Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679515586"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515557"><span class="hs-identifier hs-var">qs''</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515583"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span>    </span><span class="annot"><span class="annottext">(Alt Type, Expr Type) -&gt; DesugarFn (Alt Type, Expr Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DConId -&gt; [Alt Type] -&gt; Type -&gt; Alt Type
forall t. DConId -&gt; [Alt t] -&gt; t -&gt; Alt t
</span><a href="IR.IR.html#AltData"><span class="hs-identifier hs-var">I.AltData</span></a></span><span> </span><span class="annot"><span class="annottext">DConId
</span><a href="#local-6989586621679515568"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt Type]
</span><a href="#local-6989586621679515563"><span class="hs-identifier hs-var">bs'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679515567"><span class="hs-identifier hs-var">dconTyp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515559"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span class="annot"><a href="IR.DesugarPattern.html#desugarMatchCons"><span class="hs-identifier hs-var">desugarMatchCons</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr Type]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; DesugarFn (Expr Type)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;can't happen 7&quot;</span></span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="annot"><a href="IR.DesugarPattern.html#desugarMatchLit"><span class="hs-identifier hs-type">desugarMatchLit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="IR.IR.html#Expr"><span class="hs-identifier hs-type">I.Expr</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="IR.DesugarPattern.html#Equation"><span class="hs-identifier hs-type">Equation</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.IR.html#Expr"><span class="hs-identifier hs-type">I.Expr</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#DesugarFn"><span class="hs-identifier hs-type">DesugarFn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#Expr"><span class="hs-identifier hs-type">I.Expr</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span id="desugarMatchLit"><span class="annot"><span class="annottext">desugarMatchLit :: [Expr Type]
-&gt; [([Alt Type], Expr Type)] -&gt; Expr Type -&gt; DesugarFn (Expr Type)
</span><a href="IR.DesugarPattern.html#desugarMatchLit"><span class="hs-identifier hs-var hs-var">desugarMatchLit</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679515553"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515553"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679515552"><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679515552"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679515551"><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515551"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span id="local-6989586621679515550"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515550"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-212"></span><span>  </span><span id="local-6989586621679515549"><span class="annot"><span class="annottext">[(Alt Type, Expr Type)]
</span><a href="#local-6989586621679515549"><span class="hs-identifier hs-var">arms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[DesugarFn (Alt Type, Expr Type)]
-&gt; DesugarFn [(Alt Type, Expr Type)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
</span><span class="hs-identifier hs-var">sequence</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Alt Type
</span><a href="#local-6989586621679515548"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Expr Type -&gt; (Alt Type, Expr Type))
-&gt; DesugarFn (Expr Type) -&gt; DesugarFn (Alt Type, Expr Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Expr Type]
-&gt; [([Alt Type], Expr Type)] -&gt; Expr Type -&gt; DesugarFn (Expr Type)
</span><a href="IR.DesugarPattern.html#desugarMatch"><span class="hs-identifier hs-var">desugarMatch</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679515552"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Alt Type]
</span><a href="#local-6989586621679515547"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515546"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515550"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679515548"><span class="annot"><span class="annottext">Alt Type
</span><a href="#local-6989586621679515548"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679515547"><span class="annot"><span class="annottext">[Alt Type]
</span><a href="#local-6989586621679515547"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679515546"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515546"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><a href="#local-6989586621679515551"><span class="hs-identifier hs-var">qs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679515545"><span class="annot"><span class="annottext">defAlt :: Alt Type
</span><a href="#local-6989586621679515545"><span class="hs-identifier hs-var hs-var">defAlt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Binder Type -&gt; Alt Type
forall t. Binder t -&gt; Alt t
</span><a href="IR.IR.html#AltBinder"><span class="hs-identifier hs-var">I.AltBinder</span></a></span><span> </span><span class="annot"><span class="annottext">(Binder Type -&gt; Alt Type) -&gt; Binder Type -&gt; Alt Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Binder Type
forall t. t -&gt; Binder t
</span><a href="IR.IR.html#BindAnon"><span class="hs-identifier hs-var">I.BindAnon</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Binder Type) -&gt; Type -&gt; Binder Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; Type
forall (c :: * -&gt; *) a. Carrier c =&gt; c a -&gt; a
</span><a href="IR.IR.html#extract"><span class="hs-identifier hs-var">I.extract</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515553"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-214"></span><span>  </span><span class="annot"><span class="annottext">Expr Type -&gt; DesugarFn (Expr Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Expr Type -&gt; DesugarFn (Expr Type))
-&gt; Expr Type -&gt; DesugarFn (Expr Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; [(Alt Type, Expr Type)] -&gt; Type -&gt; Expr Type
forall t. Expr t -&gt; [(Alt t, Expr t)] -&gt; t -&gt; Expr t
</span><a href="IR.IR.html#Match"><span class="hs-identifier hs-var">I.Match</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515553"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Alt Type, Expr Type)]
</span><a href="#local-6989586621679515549"><span class="hs-identifier hs-var">arms</span></a></span><span> </span><span class="annot"><span class="annottext">[(Alt Type, Expr Type)]
-&gt; [(Alt Type, Expr Type)] -&gt; [(Alt Type, Expr Type)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Alt Type
</span><a href="#local-6989586621679515545"><span class="hs-identifier hs-var">defAlt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515550"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr Type -&gt; Type
forall (c :: * -&gt; *) a. Carrier c =&gt; c a -&gt; a
</span><a href="IR.IR.html#extract"><span class="hs-identifier hs-var">I.extract</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679515550"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span class="hs-comment">--                            ^^^^^^^^^^^</span><span>
</span><span id="line-216"></span><span class="hs-comment">-- WARN: we assume that PatLit is never exhaustive, so we add a default case</span><span>
</span><span id="line-217"></span><span class="annot"><a href="IR.DesugarPattern.html#desugarMatchLit"><span class="hs-identifier hs-var">desugarMatchLit</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr Type]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[([Alt Type], Expr Type)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; DesugarFn (Expr Type)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;can't happen 8&quot;</span></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="annot"><a href="IR.DesugarPattern.html#getConstructors"><span class="hs-identifier hs-type">getConstructors</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Common.Identifiers.html#DConId"><span class="hs-identifier hs-type">I.DConId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#DesugarFn"><span class="hs-identifier hs-type">DesugarFn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><a href="Common.Identifiers.html#DConId"><span class="hs-identifier hs-type">I.DConId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span id="getConstructors"><span class="annot"><span class="annottext">getConstructors :: DConId -&gt; DesugarFn (Set DConId)
</span><a href="IR.DesugarPattern.html#getConstructors"><span class="hs-identifier hs-var hs-var">getConstructors</span></a></span></span><span> </span><span id="local-6989586621679515544"><span class="annot"><span class="annottext">DConId
</span><a href="#local-6989586621679515544"><span class="hs-identifier hs-var">dcon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-222"></span><span>  </span><span id="local-6989586621679515543"><span class="annot"><span class="annottext">CInfo
</span><a href="#local-6989586621679515543"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DConId -&gt; DesugarFn CInfo
</span><a href="IR.DesugarPattern.html#getCInfo"><span class="hs-identifier hs-var">getCInfo</span></a></span><span> </span><span class="annot"><span class="annottext">DConId
</span><a href="#local-6989586621679515544"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-223"></span><span>  </span><span id="local-6989586621679515542"><span class="annot"><span class="annottext">TInfo
</span><a href="#local-6989586621679515542"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TConId -&gt; DesugarFn TInfo
</span><a href="IR.DesugarPattern.html#getTInfo"><span class="hs-identifier hs-var">getTInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInfo -&gt; TConId
</span><a href="IR.DesugarPattern.html#cType"><span class="hs-identifier hs-var hs-var">cType</span></a></span><span> </span><span class="annot"><span class="annottext">CInfo
</span><a href="#local-6989586621679515543"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>  </span><span class="annot"><span class="annottext">Set DConId -&gt; DesugarFn (Set DConId)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Set DConId -&gt; DesugarFn (Set DConId))
-&gt; Set DConId -&gt; DesugarFn (Set DConId)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TInfo -&gt; Set DConId
</span><a href="IR.DesugarPattern.html#tCSet"><span class="hs-identifier hs-var hs-var">tCSet</span></a></span><span> </span><span class="annot"><span class="annottext">TInfo
</span><a href="#local-6989586621679515542"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span class="annot"><a href="IR.DesugarPattern.html#getCInfo"><span class="hs-identifier hs-type">getCInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Common.Identifiers.html#DConId"><span class="hs-identifier hs-type">I.DConId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#DesugarFn"><span class="hs-identifier hs-type">DesugarFn</span></a></span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#CInfo"><span class="hs-identifier hs-type">CInfo</span></a></span><span>
</span><span id="line-228"></span><span id="getCInfo"><span class="annot"><span class="annottext">getCInfo :: DConId -&gt; DesugarFn CInfo
</span><a href="IR.DesugarPattern.html#getCInfo"><span class="hs-identifier hs-var hs-var">getCInfo</span></a></span></span><span> </span><span id="local-6989586621679515540"><span class="annot"><span class="annottext">DConId
</span><a href="#local-6989586621679515540"><span class="hs-identifier hs-var">dcon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DesugarCtx -&gt; Maybe CInfo) -&gt; DesugarFn (Maybe CInfo)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DConId -&gt; Map DConId CInfo -&gt; Maybe CInfo
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">DConId
</span><a href="#local-6989586621679515540"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="annot"><span class="annottext">(Map DConId CInfo -&gt; Maybe CInfo)
-&gt; (DesugarCtx -&gt; Map DConId CInfo) -&gt; DesugarCtx -&gt; Maybe CInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DesugarCtx -&gt; Map DConId CInfo
</span><a href="IR.DesugarPattern.html#consMap"><span class="hs-identifier hs-var hs-var">consMap</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DesugarFn (Maybe CInfo)
-&gt; (Maybe CInfo -&gt; DesugarFn CInfo) -&gt; DesugarFn CInfo
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">DesugarFn CInfo
-&gt; (CInfo -&gt; DesugarFn CInfo) -&gt; Maybe CInfo -&gt; DesugarFn CInfo
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DConId -&gt; DesugarFn CInfo
forall i a. Pretty i =&gt; i -&gt; DesugarFn a
</span><a href="IR.DesugarPattern.html#desugarError"><span class="hs-identifier hs-var">desugarError</span></a></span><span> </span><span class="annot"><span class="annottext">DConId
</span><a href="#local-6989586621679515540"><span class="hs-identifier hs-var">dcon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CInfo -&gt; DesugarFn CInfo
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span class="annot"><a href="IR.DesugarPattern.html#getTInfo"><span class="hs-identifier hs-type">getTInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Common.Identifiers.html#TConId"><span class="hs-identifier hs-type">I.TConId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#DesugarFn"><span class="hs-identifier hs-type">DesugarFn</span></a></span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#TInfo"><span class="hs-identifier hs-type">TInfo</span></a></span><span>
</span><span id="line-232"></span><span id="getTInfo"><span class="annot"><span class="annottext">getTInfo :: TConId -&gt; DesugarFn TInfo
</span><a href="IR.DesugarPattern.html#getTInfo"><span class="hs-identifier hs-var hs-var">getTInfo</span></a></span></span><span> </span><span id="local-6989586621679515536"><span class="annot"><span class="annottext">TConId
</span><a href="#local-6989586621679515536"><span class="hs-identifier hs-var">tcon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DesugarCtx -&gt; Maybe TInfo) -&gt; DesugarFn (Maybe TInfo)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TConId -&gt; Map TConId TInfo -&gt; Maybe TInfo
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">TConId
</span><a href="#local-6989586621679515536"><span class="hs-identifier hs-var">tcon</span></a></span><span> </span><span class="annot"><span class="annottext">(Map TConId TInfo -&gt; Maybe TInfo)
-&gt; (DesugarCtx -&gt; Map TConId TInfo) -&gt; DesugarCtx -&gt; Maybe TInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DesugarCtx -&gt; Map TConId TInfo
</span><a href="IR.DesugarPattern.html#typeMap"><span class="hs-identifier hs-var hs-var">typeMap</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DesugarFn (Maybe TInfo)
-&gt; (Maybe TInfo -&gt; DesugarFn TInfo) -&gt; DesugarFn TInfo
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">DesugarFn TInfo
-&gt; (TInfo -&gt; DesugarFn TInfo) -&gt; Maybe TInfo -&gt; DesugarFn TInfo
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TConId -&gt; DesugarFn TInfo
forall i a. Pretty i =&gt; i -&gt; DesugarFn a
</span><a href="IR.DesugarPattern.html#desugarError"><span class="hs-identifier hs-var">desugarError</span></a></span><span> </span><span class="annot"><span class="annottext">TConId
</span><a href="#local-6989586621679515536"><span class="hs-identifier hs-var">tcon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TInfo -&gt; DesugarFn TInfo
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span id="local-6989586621679515815"><span id="local-6989586621679515817"><span class="annot"><a href="IR.DesugarPattern.html#desugarError"><span class="hs-identifier hs-type">desugarError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><a href="#local-6989586621679515817"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679515817"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#DesugarFn"><span class="hs-identifier hs-type">DesugarFn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679515815"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-236"></span><span id="desugarError"><span class="annot"><span class="annottext">desugarError :: i -&gt; DesugarFn a
</span><a href="IR.DesugarPattern.html#desugarError"><span class="hs-identifier hs-var hs-var">desugarError</span></a></span></span><span> </span><span id="local-6989586621679515535"><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679515535"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Error -&gt; DesugarFn a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(Error -&gt; DesugarFn a) -&gt; Error -&gt; DesugarFn a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; Error
</span><a href="Common.Compiler.html#PatternError"><span class="hs-identifier hs-var">PatternError</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorMsg -&gt; Error) -&gt; ErrorMsg -&gt; Error
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg
</span><span class="hs-string">&quot;Unknown identifier: &quot;</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; ErrorMsg -&gt; ErrorMsg
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ErrorMsg
forall a. IsString a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc Any -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(Doc Any -&gt; String) -&gt; Doc Any -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">i -&gt; Doc Any
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679515535"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span class="annot"><a href="IR.DesugarPattern.html#buildTypeMap"><span class="hs-identifier hs-type">buildTypeMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Common.Identifiers.html#TConId"><span class="hs-identifier hs-type">I.TConId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IR.IR.html#TypeDef"><span class="hs-identifier hs-type">I.TypeDef</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Common.Identifiers.html#TConId"><span class="hs-identifier hs-type">I.TConId</span></a></span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#TInfo"><span class="hs-identifier hs-type">TInfo</span></a></span><span>
</span><span id="line-240"></span><span id="buildTypeMap"><span class="annot"><span class="annottext">buildTypeMap :: [(TConId, TypeDef)] -&gt; Map TConId TInfo
</span><a href="IR.DesugarPattern.html#buildTypeMap"><span class="hs-identifier hs-var hs-var">buildTypeMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((TConId, TypeDef) -&gt; Map TConId TInfo -&gt; Map TConId TInfo)
-&gt; Map TConId TInfo -&gt; [(TConId, TypeDef)] -&gt; Map TConId TInfo
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">(TConId, TypeDef) -&gt; Map TConId TInfo -&gt; Map TConId TInfo
</span><a href="#local-6989586621679515531"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">Map TConId TInfo
forall k a. Map k a
</span><span class="hs-identifier hs-var">M.empty</span></span><span>
</span><span id="line-241"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-242"></span><span>  </span><span id="local-6989586621679515531"><span class="annot"><span class="annottext">build :: (TConId, TypeDef) -&gt; Map TConId TInfo -&gt; Map TConId TInfo
</span><a href="#local-6989586621679515531"><span class="hs-identifier hs-var hs-var">build</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679515529"><span class="annot"><span class="annottext">TConId
</span><a href="#local-6989586621679515529"><span class="hs-identifier hs-var">tcon</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">((DConId, TypeVariant) -&gt; DConId)
-&gt; [(DConId, TypeVariant)] -&gt; [DConId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(DConId, TypeVariant) -&gt; DConId
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">([(DConId, TypeVariant)] -&gt; [DConId])
-&gt; (TypeDef -&gt; [(DConId, TypeVariant)]) -&gt; TypeDef -&gt; [DConId]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TypeDef -&gt; [(DConId, TypeVariant)]
</span><a href="IR.IR.html#variants"><span class="hs-identifier hs-var hs-var">I.variants</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679515527"><span class="annot"><span class="annottext">[DConId]
</span><a href="#local-6989586621679515527"><span class="hs-identifier hs-var">dcons</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-243"></span><span>    </span><span class="annot"><span class="annottext">TConId -&gt; TInfo -&gt; Map TConId TInfo -&gt; Map TConId TInfo
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">TConId
</span><a href="#local-6989586621679515529"><span class="hs-identifier hs-var">tcon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TInfo :: TConId -&gt; Set DConId -&gt; TInfo
</span><a href="IR.DesugarPattern.html#TInfo"><span class="hs-identifier hs-type">TInfo</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">tName :: TConId
</span><a href="IR.DesugarPattern.html#tName"><span class="hs-identifier hs-var">tName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TConId
</span><a href="#local-6989586621679515529"><span class="hs-identifier hs-var">tcon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tCSet :: Set DConId
</span><a href="IR.DesugarPattern.html#tCSet"><span class="hs-identifier hs-var">tCSet</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DConId] -&gt; Set DConId
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">[DConId]
</span><a href="#local-6989586621679515527"><span class="hs-identifier hs-var">dcons</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span class="annot"><a href="IR.DesugarPattern.html#buildConsMap"><span class="hs-identifier hs-type">buildConsMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Common.Identifiers.html#TConId"><span class="hs-identifier hs-type">I.TConId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IR.IR.html#TypeDef"><span class="hs-identifier hs-type">I.TypeDef</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Common.Identifiers.html#DConId"><span class="hs-identifier hs-type">I.DConId</span></a></span><span> </span><span class="annot"><a href="IR.DesugarPattern.html#CInfo"><span class="hs-identifier hs-type">CInfo</span></a></span><span>
</span><span id="line-247"></span><span id="buildConsMap"><span class="annot"><span class="annottext">buildConsMap :: [(TConId, TypeDef)] -&gt; Map DConId CInfo
</span><a href="IR.DesugarPattern.html#buildConsMap"><span class="hs-identifier hs-var hs-var">buildConsMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((TConId, TypeDef) -&gt; Map DConId CInfo -&gt; Map DConId CInfo)
-&gt; Map DConId CInfo -&gt; [(TConId, TypeDef)] -&gt; Map DConId CInfo
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TConId, [(DConId, TypeVariant)])
-&gt; Map DConId CInfo -&gt; Map DConId CInfo
forall (t :: * -&gt; *).
Foldable t =&gt;
(TConId, t (DConId, TypeVariant))
-&gt; Map DConId CInfo -&gt; Map DConId CInfo
</span><a href="#local-6989586621679515525"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">((TConId, [(DConId, TypeVariant)])
 -&gt; Map DConId CInfo -&gt; Map DConId CInfo)
-&gt; ((TConId, TypeDef) -&gt; (TConId, [(DConId, TypeVariant)]))
-&gt; (TConId, TypeDef)
-&gt; Map DConId CInfo
-&gt; Map DConId CInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(TypeDef -&gt; [(DConId, TypeVariant)])
-&gt; (TConId, TypeDef) -&gt; (TConId, [(DConId, TypeVariant)])
forall (p :: * -&gt; * -&gt; *) b c a.
Bifunctor p =&gt;
(b -&gt; c) -&gt; p a b -&gt; p a c
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="annot"><span class="annottext">TypeDef -&gt; [(DConId, TypeVariant)]
</span><a href="IR.IR.html#variants"><span class="hs-identifier hs-var hs-var">I.variants</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map DConId CInfo
forall k a. Map k a
</span><span class="hs-identifier hs-var">M.empty</span></span><span>
</span><span id="line-248"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-249"></span><span>  </span><span id="local-6989586621679515523"><span class="annot"><span class="annottext">variantTypes :: TypeVariant -&gt; [Type]
</span><a href="#local-6989586621679515523"><span class="hs-identifier hs-var hs-var">variantTypes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#VariantUnnamed"><span class="hs-identifier hs-type">I.VariantUnnamed</span></a></span><span> </span><span id="local-6989586621679515521"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679515521"><span class="hs-identifier hs-var">typs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679515521"><span class="hs-identifier hs-var">typs</span></a></span><span>
</span><span id="line-250"></span><span>  </span><span class="annot"><a href="#local-6989586621679515523"><span class="hs-identifier hs-var">variantTypes</span></a></span><span> </span><span class="annot"><span class="annottext">TypeVariant
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [Type]
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;VariantNamed aren't supported (yet?)&quot;</span></span><span>
</span><span id="line-251"></span><span>  </span><span id="local-6989586621679515525"><span class="annot"><span class="annottext">build :: (TConId, t (DConId, TypeVariant))
-&gt; Map DConId CInfo -&gt; Map DConId CInfo
</span><a href="#local-6989586621679515525"><span class="hs-identifier hs-var hs-var">build</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679515520"><span class="annot"><span class="annottext">TConId
</span><a href="#local-6989586621679515520"><span class="hs-identifier hs-var">tcon</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679515519"><span class="annot"><span class="annottext">t (DConId, TypeVariant)
</span><a href="#local-6989586621679515519"><span class="hs-identifier hs-var">variants</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679515518"><span class="annot"><span class="annottext">Map DConId CInfo
</span><a href="#local-6989586621679515518"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((DConId, TypeVariant) -&gt; Map DConId CInfo -&gt; Map DConId CInfo)
-&gt; Map DConId CInfo -&gt; t (DConId, TypeVariant) -&gt; Map DConId CInfo
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TConId
-&gt; (DConId, TypeVariant) -&gt; Map DConId CInfo -&gt; Map DConId CInfo
</span><a href="#local-6989586621679515517"><span class="hs-identifier hs-var">build'</span></a></span><span> </span><span class="annot"><span class="annottext">TConId
</span><a href="#local-6989586621679515520"><span class="hs-identifier hs-var">tcon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map DConId CInfo
</span><a href="#local-6989586621679515518"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">t (DConId, TypeVariant)
</span><a href="#local-6989586621679515519"><span class="hs-identifier hs-var">variants</span></a></span><span>
</span><span id="line-252"></span><span>  </span><span id="local-6989586621679515517"><span class="annot"><span class="annottext">build' :: TConId
-&gt; (DConId, TypeVariant) -&gt; Map DConId CInfo -&gt; Map DConId CInfo
</span><a href="#local-6989586621679515517"><span class="hs-identifier hs-var hs-var">build'</span></a></span></span><span> </span><span id="local-6989586621679515516"><span class="annot"><span class="annottext">TConId
</span><a href="#local-6989586621679515516"><span class="hs-identifier hs-var">tcon</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679515515"><span class="annot"><span class="annottext">DConId
</span><a href="#local-6989586621679515515"><span class="hs-identifier hs-var">dcon</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679515514"><span class="annot"><span class="annottext">TypeVariant
</span><a href="#local-6989586621679515514"><span class="hs-identifier hs-var">typs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-253"></span><span>    </span><span class="annot"><span class="annottext">DConId -&gt; CInfo -&gt; Map DConId CInfo -&gt; Map DConId CInfo
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">DConId
</span><a href="#local-6989586621679515515"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="annot"><span class="annottext">(CInfo -&gt; Map DConId CInfo -&gt; Map DConId CInfo)
-&gt; CInfo -&gt; Map DConId CInfo -&gt; Map DConId CInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-254"></span><span>      </span><span class="annot"><span class="annottext">CInfo :: DConId -&gt; TConId -&gt; [Type] -&gt; CInfo
</span><a href="IR.DesugarPattern.html#CInfo"><span class="hs-identifier hs-type">CInfo</span></a></span><span>
</span><span id="line-255"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cName :: DConId
</span><a href="IR.DesugarPattern.html#cName"><span class="hs-identifier hs-var">cName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DConId
</span><a href="#local-6989586621679515515"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-256"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cType :: TConId
</span><a href="IR.DesugarPattern.html#cType"><span class="hs-identifier hs-var">cType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TConId
</span><a href="#local-6989586621679515516"><span class="hs-identifier hs-var">tcon</span></a></span><span>
</span><span id="line-257"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">argsType :: [Type]
</span><a href="IR.DesugarPattern.html#argsType"><span class="hs-identifier hs-var">argsType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeVariant -&gt; [Type]
</span><a href="#local-6989586621679515523"><span class="hs-identifier hs-var">variantTypes</span></a></span><span> </span><span class="annot"><span class="annottext">TypeVariant
</span><a href="#local-6989586621679515514"><span class="hs-identifier hs-var">typs</span></a></span><span>
</span><span id="line-258"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-259"></span></pre></body></html>