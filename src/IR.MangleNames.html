<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DerivingVia #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-comment">{- | Mangle all variable names in a program to ensure global uniqueness.

Also populate symbol table with information about those (now unique) names.

This module also exports 'pickId', which other passes can use to create fresh
variable names given some symbol table.
-}</span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">IR.MangleNames</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.MangleNames.html#mangleProgram"><span class="hs-identifier">mangleProgram</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IR.MangleNames.html#normalizeId"><span class="hs-identifier">normalizeId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IR.MangleNames.html#pickId"><span class="hs-identifier">pickId</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Common.Compiler.html"><span class="hs-identifier">Common.Compiler</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Compiler</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Common.Identifiers.html"><span class="hs-identifier">Common.Identifiers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.Identifiers.html#Identifiable"><span class="hs-identifier">Identifiable</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">IsString</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="IR.IR.html"><span class="hs-identifier">IR.IR</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">I</span></span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">forM</span></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadError</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadState</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">StateT</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">evalStateT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">gets</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">modify</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">type</span><span> </span><span id="OriginId"><span class="annot"><a href="IR.MangleNames.html#OriginId"><span class="hs-identifier hs-var">OriginId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Common.Identifiers.html#VarId"><span class="hs-identifier hs-type">I.VarId</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">type</span><span> </span><span id="MangledId"><span class="annot"><a href="IR.MangleNames.html#MangledId"><span class="hs-identifier hs-var">MangledId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Common.Identifiers.html#VarId"><span class="hs-identifier hs-type">I.VarId</span></a></span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-comment">-- | Normalize an identifier (remove things like backticks etc.)</span><span>
</span><span id="line-30"></span><span id="local-6989586621679511931"><span class="annot"><a href="IR.MangleNames.html#normalizeId"><span class="hs-identifier hs-type">normalizeId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Common.Identifiers.html#Identifiable"><span class="hs-identifier hs-type">Identifiable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679511931"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679511931"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679511931"><span class="hs-identifier hs-type">i</span></a></span></span><span>
</span><span id="line-31"></span><span id="normalizeId"><span class="annot"><span class="annottext">normalizeId :: i -&gt; i
</span><a href="IR.MangleNames.html#normalizeId"><span class="hs-identifier hs-var hs-var">normalizeId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; i
forall a. IsString a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; i) -&gt; (i -&gt; String) -&gt; i -&gt; i
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Char) -&gt; String -&gt; String
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char
</span><a href="#local-6989586621679511780"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; (i -&gt; String) -&gt; i -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">i -&gt; String
forall i. Identifiable i =&gt; i -&gt; String
</span><a href="Common.Identifiers.html#ident"><span class="hs-identifier hs-var">ident</span></a></span><span>
</span><span id="line-32"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-33"></span><span>  </span><span id="local-6989586621679511780"><span class="annot"><span class="annottext">tr :: Char -&gt; Char
</span><a href="#local-6989586621679511780"><span class="hs-identifier hs-var hs-var">tr</span></a></span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\''</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'_'</span></span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><a href="#local-6989586621679511780"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span id="local-6989586621679511778"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679511778"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679511778"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-comment">-- | Given a symbol table and a name, pick a new name that is globally unique.</span><span>
</span><span id="line-38"></span><span id="local-6989586621679511829"><span class="annot"><a href="IR.MangleNames.html#pickId"><span class="hs-identifier hs-type">pickId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="IR.MangleNames.html#MangledId"><span class="hs-identifier hs-type">MangledId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679511829"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.MangleNames.html#OriginId"><span class="hs-identifier hs-type">OriginId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.MangleNames.html#MangledId"><span class="hs-identifier hs-type">MangledId</span></a></span></span><span>
</span><span id="line-39"></span><span id="pickId"><span class="annot"><span class="annottext">pickId :: Map MangledId t -&gt; MangledId -&gt; MangledId
</span><a href="IR.MangleNames.html#pickId"><span class="hs-identifier hs-var hs-var">pickId</span></a></span></span><span> </span><span id="local-6989586621679511777"><span class="annot"><span class="annottext">Map MangledId t
</span><a href="#local-6989586621679511777"><span class="hs-identifier hs-var">globals</span></a></span></span><span> </span><span id="local-6989586621679511776"><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511776"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">MangledId -&gt; Bool
</span><a href="#local-6989586621679511775"><span class="hs-identifier hs-var">alreadyInUse</span></a></span><span> </span><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511774"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; MangledId
</span><a href="#local-6989586621679511773"><span class="hs-identifier hs-var">pick</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511774"><span class="hs-identifier hs-var">v'</span></a></span><span>
</span><span id="line-40"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-41"></span><span>  </span><span class="annot"><a href="#local-6989586621679511774"><span class="hs-identifier hs-type">v'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IR.MangleNames.html#MangledId"><span class="hs-identifier hs-type">MangledId</span></a></span><span>
</span><span id="line-42"></span><span>  </span><span id="local-6989586621679511774"><span class="annot"><span class="annottext">v' :: MangledId
</span><a href="#local-6989586621679511774"><span class="hs-identifier hs-var hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MangledId -&gt; MangledId
forall i. Identifiable i =&gt; i -&gt; i
</span><a href="IR.MangleNames.html#normalizeId"><span class="hs-identifier hs-var">normalizeId</span></a></span><span> </span><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511776"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><a href="#local-6989586621679511773"><span class="hs-identifier hs-type">pick</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.MangleNames.html#MangledId"><span class="hs-identifier hs-type">MangledId</span></a></span><span>
</span><span id="line-45"></span><span>  </span><span id="local-6989586621679511773"><span class="annot"><span class="annottext">pick :: Int -&gt; MangledId
</span><a href="#local-6989586621679511773"><span class="hs-identifier hs-var hs-var">pick</span></a></span></span><span> </span><span id="local-6989586621679511772"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679511772"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679511771"><span class="annot"><span class="annottext">v'' :: MangledId
</span><a href="#local-6989586621679511771"><span class="hs-identifier hs-var hs-var">v''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MangledId -&gt; MangledId
forall i. Identifiable i =&gt; i -&gt; i
</span><a href="IR.MangleNames.html#normalizeId"><span class="hs-identifier hs-var">normalizeId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511776"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">MangledId -&gt; MangledId -&gt; MangledId
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">MangledId
</span><span class="hs-string">&quot;__&quot;</span></span><span> </span><span class="annot"><span class="annottext">MangledId -&gt; MangledId -&gt; MangledId
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; MangledId
forall a. IsString a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679511772"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">MangledId -&gt; Bool
</span><a href="#local-6989586621679511775"><span class="hs-identifier hs-var">alreadyInUse</span></a></span><span> </span><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511771"><span class="hs-identifier hs-var">v''</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; MangledId
</span><a href="#local-6989586621679511773"><span class="hs-identifier hs-var">pick</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; MangledId) -&gt; Int -&gt; MangledId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679511772"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511771"><span class="hs-identifier hs-var">v''</span></a></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><a href="#local-6989586621679511775"><span class="hs-identifier hs-type">alreadyInUse</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Common.Identifiers.html#VarId"><span class="hs-identifier hs-type">I.VarId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-50"></span><span>  </span><span id="local-6989586621679511775"><span class="annot"><span class="annottext">alreadyInUse :: MangledId -&gt; Bool
</span><a href="#local-6989586621679511775"><span class="hs-identifier hs-var hs-var">alreadyInUse</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MangledId -&gt; Map MangledId t -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><span class="hs-operator hs-var">`M.member`</span></span><span> </span><span class="annot"><span class="annottext">Map MangledId t
</span><a href="#local-6989586621679511777"><span class="hs-identifier hs-var">globals</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-keyword">data</span><span> </span><span id="MangleCtx"><span class="annot"><a href="IR.MangleNames.html#MangleCtx"><span class="hs-identifier hs-var">MangleCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MangleCtx"><span class="annot"><a href="IR.MangleNames.html#MangleCtx"><span class="hs-identifier hs-var">MangleCtx</span></a></span></span><span>
</span><span id="line-54"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="localScope"><span class="annot"><span class="annottext">MangleCtx -&gt; Map MangledId MangledId
</span><a href="IR.MangleNames.html#localScope"><span class="hs-identifier hs-var hs-var">localScope</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="IR.MangleNames.html#OriginId"><span class="hs-identifier hs-type">OriginId</span></a></span><span> </span><span class="annot"><a href="IR.MangleNames.html#MangledId"><span class="hs-identifier hs-type">MangledId</span></a></span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="globalScope"><span class="annot"><span class="annottext">MangleCtx -&gt; SymTable Type
</span><a href="IR.MangleNames.html#globalScope"><span class="hs-identifier hs-var hs-var">globalScope</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IR.IR.html#SymTable"><span class="hs-identifier hs-type">I.SymTable</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-comment">-- | Mangling monad</span><span>
</span><span id="line-60"></span><span class="hs-keyword">newtype</span><span> </span><span id="Mangle"><span class="annot"><a href="IR.MangleNames.html#Mangle"><span class="hs-identifier hs-var">Mangle</span></a></span></span><span> </span><span id="local-6989586621679511764"><span class="annot"><a href="#local-6989586621679511764"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Mangle"><span class="annot"><a href="IR.MangleNames.html#Mangle"><span class="hs-identifier hs-var">Mangle</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="IR.MangleNames.html#MangleCtx"><span class="hs-identifier hs-type">MangleCtx</span></a></span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Compiler.Pass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679511764"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679511759"><span id="local-6989586621679511761"><span class="annot"><span class="annottext">a -&gt; Mangle b -&gt; Mangle a
(a -&gt; b) -&gt; Mangle a -&gt; Mangle b
(forall a b. (a -&gt; b) -&gt; Mangle a -&gt; Mangle b)
-&gt; (forall a b. a -&gt; Mangle b -&gt; Mangle a) -&gt; Functor Mangle
forall a b. a -&gt; Mangle b -&gt; Mangle a
forall a b. (a -&gt; b) -&gt; Mangle a -&gt; Mangle b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: a -&gt; Mangle b -&gt; Mangle a
$c&lt;$ :: forall a b. a -&gt; Mangle b -&gt; Mangle a
fmap :: (a -&gt; b) -&gt; Mangle a -&gt; Mangle b
$cfmap :: forall a b. (a -&gt; b) -&gt; Mangle a -&gt; Mangle b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="IR.MangleNames.html#MangleCtx"><span class="hs-identifier hs-type">MangleCtx</span></a></span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Compiler.Pass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679511747"><span id="local-6989586621679511749"><span id="local-6989586621679511751"><span id="local-6989586621679511753"><span id="local-6989586621679511755"><span class="annot"><span class="annottext">Functor Mangle
a -&gt; Mangle a
Functor Mangle
-&gt; (forall a. a -&gt; Mangle a)
-&gt; (forall a b. Mangle (a -&gt; b) -&gt; Mangle a -&gt; Mangle b)
-&gt; (forall a b c.
    (a -&gt; b -&gt; c) -&gt; Mangle a -&gt; Mangle b -&gt; Mangle c)
-&gt; (forall a b. Mangle a -&gt; Mangle b -&gt; Mangle b)
-&gt; (forall a b. Mangle a -&gt; Mangle b -&gt; Mangle a)
-&gt; Applicative Mangle
Mangle a -&gt; Mangle b -&gt; Mangle b
Mangle a -&gt; Mangle b -&gt; Mangle a
Mangle (a -&gt; b) -&gt; Mangle a -&gt; Mangle b
(a -&gt; b -&gt; c) -&gt; Mangle a -&gt; Mangle b -&gt; Mangle c
forall a. a -&gt; Mangle a
forall a b. Mangle a -&gt; Mangle b -&gt; Mangle a
forall a b. Mangle a -&gt; Mangle b -&gt; Mangle b
forall a b. Mangle (a -&gt; b) -&gt; Mangle a -&gt; Mangle b
forall a b c. (a -&gt; b -&gt; c) -&gt; Mangle a -&gt; Mangle b -&gt; Mangle c
forall (f :: * -&gt; *).
Functor f
-&gt; (forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
&lt;* :: Mangle a -&gt; Mangle b -&gt; Mangle a
$c&lt;* :: forall a b. Mangle a -&gt; Mangle b -&gt; Mangle a
*&gt; :: Mangle a -&gt; Mangle b -&gt; Mangle b
$c*&gt; :: forall a b. Mangle a -&gt; Mangle b -&gt; Mangle b
liftA2 :: (a -&gt; b -&gt; c) -&gt; Mangle a -&gt; Mangle b -&gt; Mangle c
$cliftA2 :: forall a b c. (a -&gt; b -&gt; c) -&gt; Mangle a -&gt; Mangle b -&gt; Mangle c
&lt;*&gt; :: Mangle (a -&gt; b) -&gt; Mangle a -&gt; Mangle b
$c&lt;*&gt; :: forall a b. Mangle (a -&gt; b) -&gt; Mangle a -&gt; Mangle b
pure :: a -&gt; Mangle a
$cpure :: forall a. a -&gt; Mangle a
$cp1Applicative :: Functor Mangle
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="IR.MangleNames.html#MangleCtx"><span class="hs-identifier hs-type">MangleCtx</span></a></span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Compiler.Pass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679511739"><span id="local-6989586621679511741"><span id="local-6989586621679511743"><span class="annot"><span class="annottext">Applicative Mangle
a -&gt; Mangle a
Applicative Mangle
-&gt; (forall a b. Mangle a -&gt; (a -&gt; Mangle b) -&gt; Mangle b)
-&gt; (forall a b. Mangle a -&gt; Mangle b -&gt; Mangle b)
-&gt; (forall a. a -&gt; Mangle a)
-&gt; Monad Mangle
Mangle a -&gt; (a -&gt; Mangle b) -&gt; Mangle b
Mangle a -&gt; Mangle b -&gt; Mangle b
forall a. a -&gt; Mangle a
forall a b. Mangle a -&gt; Mangle b -&gt; Mangle b
forall a b. Mangle a -&gt; (a -&gt; Mangle b) -&gt; Mangle b
forall (m :: * -&gt; *).
Applicative m
-&gt; (forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
return :: a -&gt; Mangle a
$creturn :: forall a. a -&gt; Mangle a
&gt;&gt; :: Mangle a -&gt; Mangle b -&gt; Mangle b
$c&gt;&gt; :: forall a b. Mangle a -&gt; Mangle b -&gt; Mangle b
&gt;&gt;= :: Mangle a -&gt; (a -&gt; Mangle b) -&gt; Mangle b
$c&gt;&gt;= :: forall a b. Mangle a -&gt; (a -&gt; Mangle b) -&gt; Mangle b
$cp1Monad :: Applicative Mangle
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="IR.MangleNames.html#MangleCtx"><span class="hs-identifier hs-type">MangleCtx</span></a></span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Compiler.Pass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679511735"><span class="annot"><span class="annottext">Monad Mangle
Monad Mangle -&gt; (forall a. String -&gt; Mangle a) -&gt; MonadFail Mangle
String -&gt; Mangle a
forall a. String -&gt; Mangle a
forall (m :: * -&gt; *).
Monad m -&gt; (forall a. String -&gt; m a) -&gt; MonadFail m
fail :: String -&gt; Mangle a
$cfail :: forall a. String -&gt; Mangle a
$cp1MonadFail :: Monad Mangle
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadFail</span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="IR.MangleNames.html#MangleCtx"><span class="hs-identifier hs-type">MangleCtx</span></a></span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Compiler.Pass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679511729"><span id="local-6989586621679511731"><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Common.Compiler.html#Error"><span class="hs-identifier hs-type">Compiler.Error</span></a></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="IR.MangleNames.html#MangleCtx"><span class="hs-identifier hs-type">MangleCtx</span></a></span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Compiler.Pass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679511721"><span id="local-6989586621679511723"><span id="local-6989586621679511725"><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="IR.MangleNames.html#MangleCtx"><span class="hs-identifier hs-type">MangleCtx</span></a></span></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="IR.MangleNames.html#MangleCtx"><span class="hs-identifier hs-type">MangleCtx</span></a></span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Compiler.Pass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span id="local-6989586621679511824"><span class="annot"><a href="IR.MangleNames.html#runMangle"><span class="hs-identifier hs-type">runMangle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IR.MangleNames.html#Mangle"><span class="hs-identifier hs-type">Mangle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679511824"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Compiler.Pass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679511824"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-70"></span><span id="runMangle"><span class="annot"><span class="annottext">runMangle :: Mangle a -&gt; Pass a
</span><a href="IR.MangleNames.html#runMangle"><span class="hs-identifier hs-var hs-var">runMangle</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.MangleNames.html#Mangle"><span class="hs-identifier hs-type">Mangle</span></a></span><span> </span><span id="local-6989586621679511718"><span class="annot"><span class="annottext">StateT MangleCtx Pass a
</span><a href="#local-6989586621679511718"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-71"></span><span>  </span><span class="annot"><span class="annottext">StateT MangleCtx Pass a -&gt; MangleCtx -&gt; Pass a
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m a
</span><span class="hs-identifier hs-var">evalStateT</span></span><span> </span><span class="annot"><span class="annottext">StateT MangleCtx Pass a
</span><a href="#local-6989586621679511718"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">MangleCtx :: Map MangledId MangledId -&gt; SymTable Type -&gt; MangleCtx
</span><a href="IR.MangleNames.html#MangleCtx"><span class="hs-identifier hs-type">MangleCtx</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">localScope :: Map MangledId MangledId
</span><a href="IR.MangleNames.html#localScope"><span class="hs-identifier hs-var">localScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map MangledId MangledId
forall k a. Map k a
</span><span class="hs-identifier hs-var">M.empty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">globalScope :: SymTable Type
</span><a href="IR.MangleNames.html#globalScope"><span class="hs-identifier hs-var">globalScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SymTable Type
forall k a. Map k a
</span><span class="hs-identifier hs-var">M.empty</span></span><span class="hs-special">}</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span id="local-6989586621679511834"><span class="annot"><a href="IR.MangleNames.html#withLocals"><span class="hs-identifier hs-type">withLocals</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="IR.MangleNames.html#OriginId"><span class="hs-identifier hs-type">OriginId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IR.MangleNames.html#MangledId"><span class="hs-identifier hs-type">MangledId</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.MangleNames.html#Mangle"><span class="hs-identifier hs-type">Mangle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679511834"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.MangleNames.html#Mangle"><span class="hs-identifier hs-type">Mangle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679511834"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-75"></span><span id="withLocals"><span class="annot"><span class="annottext">withLocals :: [(MangledId, MangledId)] -&gt; Mangle a -&gt; Mangle a
</span><a href="IR.MangleNames.html#withLocals"><span class="hs-identifier hs-var hs-var">withLocals</span></a></span></span><span> </span><span id="local-6989586621679511715"><span class="annot"><span class="annottext">[(MangledId, MangledId)]
</span><a href="#local-6989586621679511715"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621679511714"><span class="annot"><span class="annottext">Mangle a
</span><a href="#local-6989586621679511714"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-76"></span><span>  </span><span id="local-6989586621679511713"><span class="annot"><span class="annottext">Map MangledId MangledId
</span><a href="#local-6989586621679511713"><span class="hs-identifier hs-var">locals</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(MangleCtx -&gt; Map MangledId MangledId)
-&gt; Mangle (Map MangledId MangledId)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">MangleCtx -&gt; Map MangledId MangledId
</span><a href="IR.MangleNames.html#localScope"><span class="hs-identifier hs-var hs-var">localScope</span></a></span><span>
</span><span id="line-77"></span><span>  </span><span class="annot"><span class="annottext">(MangleCtx -&gt; MangleCtx) -&gt; Mangle ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((MangleCtx -&gt; MangleCtx) -&gt; Mangle ())
-&gt; (MangleCtx -&gt; MangleCtx) -&gt; Mangle ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679511712"><span class="annot"><span class="annottext">MangleCtx
</span><a href="#local-6989586621679511712"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MangleCtx
</span><a href="#local-6989586621679511712"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">localScope :: Map MangledId MangledId
</span><a href="IR.MangleNames.html#localScope"><span class="hs-identifier hs-var">localScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(MangledId, MangledId)] -&gt; Map MangledId MangledId
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">[(MangledId, MangledId)]
</span><a href="#local-6989586621679511715"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">Map MangledId MangledId
-&gt; Map MangledId MangledId -&gt; Map MangledId MangledId
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-operator hs-var">`M.union`</span></span><span> </span><span class="annot"><span class="annottext">Map MangledId MangledId
</span><a href="#local-6989586621679511713"><span class="hs-identifier hs-var">locals</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-78"></span><span>  </span><span id="local-6989586621679511709"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679511709"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Mangle a
</span><a href="#local-6989586621679511714"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-79"></span><span>  </span><span class="annot"><span class="annottext">(MangleCtx -&gt; MangleCtx) -&gt; Mangle ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((MangleCtx -&gt; MangleCtx) -&gt; Mangle ())
-&gt; (MangleCtx -&gt; MangleCtx) -&gt; Mangle ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679511708"><span class="annot"><span class="annottext">MangleCtx
</span><a href="#local-6989586621679511708"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MangleCtx
</span><a href="#local-6989586621679511708"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">localScope :: Map MangledId MangledId
</span><a href="IR.MangleNames.html#localScope"><span class="hs-identifier hs-var">localScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map MangledId MangledId
</span><a href="#local-6989586621679511713"><span class="hs-identifier hs-var">locals</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><span class="annottext">a -&gt; Mangle a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679511709"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="annot"><a href="IR.MangleNames.html#tellGlobal"><span class="hs-identifier hs-type">tellGlobal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Common.Identifiers.html#VarId"><span class="hs-identifier hs-type">I.VarId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.IR.html#SymInfo"><span class="hs-identifier hs-type">I.SymInfo</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.MangleNames.html#Mangle"><span class="hs-identifier hs-type">Mangle</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span id="tellGlobal"><span class="annot"><span class="annottext">tellGlobal :: MangledId -&gt; SymInfo Type -&gt; Mangle ()
</span><a href="IR.MangleNames.html#tellGlobal"><span class="hs-identifier hs-var hs-var">tellGlobal</span></a></span></span><span> </span><span id="local-6989586621679511706"><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511706"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679511705"><span class="annot"><span class="annottext">SymInfo Type
</span><a href="#local-6989586621679511705"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-85"></span><span>  </span><span class="annot"><span class="annottext">(MangleCtx -&gt; MangleCtx) -&gt; Mangle ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((MangleCtx -&gt; MangleCtx) -&gt; Mangle ())
-&gt; (MangleCtx -&gt; MangleCtx) -&gt; Mangle ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679511704"><span class="annot"><span class="annottext">MangleCtx
</span><a href="#local-6989586621679511704"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MangleCtx
</span><a href="#local-6989586621679511704"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">globalScope :: SymTable Type
</span><a href="IR.MangleNames.html#globalScope"><span class="hs-identifier hs-var">globalScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MangledId -&gt; SymInfo Type -&gt; SymTable Type -&gt; SymTable Type
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511706"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">SymInfo Type
</span><a href="#local-6989586621679511705"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(SymTable Type -&gt; SymTable Type) -&gt; SymTable Type -&gt; SymTable Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MangleCtx -&gt; SymTable Type
</span><a href="IR.MangleNames.html#globalScope"><span class="hs-identifier hs-var hs-var">globalScope</span></a></span><span> </span><span class="annot"><span class="annottext">MangleCtx
</span><a href="#local-6989586621679511704"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span id="local-6989586621679511815"><span class="annot"><a href="IR.MangleNames.html#withMangled"><span class="hs-identifier hs-type">withMangled</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="IR.IR.html#Binder"><span class="hs-identifier hs-type">I.Binder</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.MangleNames.html#Mangle"><span class="hs-identifier hs-type">Mangle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679511815"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.MangleNames.html#Mangle"><span class="hs-identifier hs-type">Mangle</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="IR.IR.html#Binder"><span class="hs-identifier hs-type">I.Binder</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679511815"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-89"></span><span id="withMangled"><span class="annot"><span class="annottext">withMangled :: [Binder Type] -&gt; Mangle a -&gt; Mangle ([Binder Type], a)
</span><a href="IR.MangleNames.html#withMangled"><span class="hs-identifier hs-var hs-var">withMangled</span></a></span></span><span> </span><span id="local-6989586621679511701"><span class="annot"><span class="annottext">[Binder Type]
</span><a href="#local-6989586621679511701"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621679511700"><span class="annot"><span class="annottext">Mangle a
</span><a href="#local-6989586621679511700"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-90"></span><span>  </span><span id="local-6989586621679511699"><span class="annot"><span class="annottext">[(Binder Type, Maybe (SymInfo Type))]
</span><a href="#local-6989586621679511699"><span class="hs-identifier hs-var">vs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Binder Type -&gt; Mangle (Binder Type, Maybe (SymInfo Type)))
-&gt; [Binder Type] -&gt; Mangle [(Binder Type, Maybe (SymInfo Type))]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Binder Type -&gt; Mangle (Binder Type, Maybe (SymInfo Type))
</span><a href="#local-6989586621679511697"><span class="hs-identifier hs-var">pickBinder</span></a></span><span> </span><span class="annot"><span class="annottext">[Binder Type]
</span><a href="#local-6989586621679511701"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-91"></span><span>  </span><span class="annot"><span class="annottext">[(MangledId, MangledId)]
-&gt; Mangle ([Binder Type], a) -&gt; Mangle ([Binder Type], a)
forall a. [(MangledId, MangledId)] -&gt; Mangle a -&gt; Mangle a
</span><a href="IR.MangleNames.html#withLocals"><span class="hs-identifier hs-var">withLocals</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Binder Type, Maybe (SymInfo Type))
 -&gt; Maybe (MangledId, MangledId))
-&gt; [(Binder Type, Maybe (SymInfo Type))]
-&gt; [(MangledId, MangledId)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">(Binder Type, Maybe (SymInfo Type)) -&gt; Maybe (MangledId, MangledId)
</span><a href="#local-6989586621679511696"><span class="hs-identifier hs-var">toLocal</span></a></span><span> </span><span class="annot"><span class="annottext">[(Binder Type, Maybe (SymInfo Type))]
</span><a href="#local-6989586621679511699"><span class="hs-identifier hs-var">vs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Mangle ([Binder Type], a) -&gt; Mangle ([Binder Type], a))
-&gt; Mangle ([Binder Type], a) -&gt; Mangle ([Binder Type], a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-92"></span><span>    </span><span id="local-6989586621679511695"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679511695"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Mangle a
</span><a href="#local-6989586621679511700"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><span class="annottext">([Binder Type], a) -&gt; Mangle ([Binder Type], a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Binder Type, Maybe (SymInfo Type)) -&gt; Binder Type)
-&gt; [(Binder Type, Maybe (SymInfo Type))] -&gt; [Binder Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Binder Type, Maybe (SymInfo Type)) -&gt; Binder Type
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Binder Type, Maybe (SymInfo Type))]
</span><a href="#local-6989586621679511699"><span class="hs-identifier hs-var">vs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679511695"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><a href="#local-6989586621679511697"><span class="hs-identifier hs-type">pickBinder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IR.IR.html#Binder"><span class="hs-identifier hs-type">I.Binder</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.MangleNames.html#Mangle"><span class="hs-identifier hs-type">Mangle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#Binder"><span class="hs-identifier hs-type">I.Binder</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#SymInfo"><span class="hs-identifier hs-type">I.SymInfo</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>  </span><span id="local-6989586621679511697"><span class="annot"><span class="annottext">pickBinder :: Binder Type -&gt; Mangle (Binder Type, Maybe (SymInfo Type))
</span><a href="#local-6989586621679511697"><span class="hs-identifier hs-var hs-var">pickBinder</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#BindVar"><span class="hs-identifier hs-type">I.BindVar</span></a></span><span> </span><span id="local-6989586621679511693"><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511693"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679511692"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679511692"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-97"></span><span>    </span><span id="local-6989586621679511691"><span class="annot"><span class="annottext">SymTable Type
</span><a href="#local-6989586621679511691"><span class="hs-identifier hs-var">globals</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(MangleCtx -&gt; SymTable Type) -&gt; Mangle (SymTable Type)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">MangleCtx -&gt; SymTable Type
</span><a href="IR.MangleNames.html#globalScope"><span class="hs-identifier hs-var hs-var">globalScope</span></a></span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679511690"><span class="annot"><span class="annottext">v' :: MangledId
</span><a href="#local-6989586621679511690"><span class="hs-identifier hs-var hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SymTable Type -&gt; MangledId -&gt; MangledId
forall t. Map MangledId t -&gt; MangledId -&gt; MangledId
</span><a href="IR.MangleNames.html#pickId"><span class="hs-identifier hs-var">pickId</span></a></span><span> </span><span class="annot"><span class="annottext">SymTable Type
</span><a href="#local-6989586621679511691"><span class="hs-identifier hs-var">globals</span></a></span><span> </span><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511693"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-99"></span><span>        </span><span id="local-6989586621679511689"><span class="annot"><span class="annottext">info :: SymInfo Type
</span><a href="#local-6989586621679511689"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SymInfo :: forall t. MangledId -&gt; t -&gt; SymInfo t
</span><a href="IR.IR.html#SymInfo"><span class="hs-identifier hs-type">I.SymInfo</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">symOrigin :: MangledId
</span><a href="IR.IR.html#symOrigin"><span class="hs-identifier hs-var">I.symOrigin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511693"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">symType :: Type
</span><a href="IR.IR.html#symType"><span class="hs-identifier hs-var">I.symType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679511692"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-100"></span><span>    </span><span class="annot"><span class="annottext">MangledId -&gt; SymInfo Type -&gt; Mangle ()
</span><a href="IR.MangleNames.html#tellGlobal"><span class="hs-identifier hs-var">tellGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511690"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="annot"><span class="annottext">SymInfo Type
</span><a href="#local-6989586621679511689"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-101"></span><span>    </span><span class="annot"><span class="annottext">(Binder Type, Maybe (SymInfo Type))
-&gt; Mangle (Binder Type, Maybe (SymInfo Type))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MangledId -&gt; Type -&gt; Binder Type
forall t. MangledId -&gt; t -&gt; Binder t
</span><a href="IR.IR.html#BindVar"><span class="hs-identifier hs-var">I.BindVar</span></a></span><span> </span><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511690"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679511692"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SymInfo Type -&gt; Maybe (SymInfo Type)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">SymInfo Type
</span><a href="#local-6989586621679511689"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><a href="#local-6989586621679511697"><span class="hs-identifier hs-var">pickBinder</span></a></span><span> </span><span id="local-6989586621679511685"><span class="annot"><span class="annottext">Binder Type
</span><a href="#local-6989586621679511685"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Binder Type, Maybe (SymInfo Type))
-&gt; Mangle (Binder Type, Maybe (SymInfo Type))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Binder Type
</span><a href="#local-6989586621679511685"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (SymInfo Type)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span>  </span><span class="annot"><a href="#local-6989586621679511696"><span class="hs-identifier hs-type">toLocal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#Binder"><span class="hs-identifier hs-type">I.Binder</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#SymInfo"><span class="hs-identifier hs-type">I.SymInfo</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.MangleNames.html#OriginId"><span class="hs-identifier hs-type">OriginId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IR.MangleNames.html#MangledId"><span class="hs-identifier hs-type">MangledId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>  </span><span id="local-6989586621679511696"><span class="annot"><span class="annottext">toLocal :: (Binder Type, Maybe (SymInfo Type)) -&gt; Maybe (MangledId, MangledId)
</span><a href="#local-6989586621679511696"><span class="hs-identifier hs-var hs-var">toLocal</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#BindVar"><span class="hs-identifier hs-type">I.BindVar</span></a></span><span> </span><span id="local-6989586621679511684"><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511684"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679511683"><span class="annot"><span class="annottext">SymInfo Type
</span><a href="#local-6989586621679511683"><span class="hs-identifier hs-var">info</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MangledId, MangledId) -&gt; Maybe (MangledId, MangledId)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SymInfo Type -&gt; MangledId
forall t. SymInfo t -&gt; MangledId
</span><a href="IR.IR.html#symOrigin"><span class="hs-identifier hs-var hs-var">I.symOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">SymInfo Type
</span><a href="#local-6989586621679511683"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511684"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>  </span><span class="annot"><a href="#local-6989586621679511696"><span class="hs-identifier hs-var">toLocal</span></a></span><span> </span><span class="annot"><span class="annottext">(Binder Type, Maybe (SymInfo Type))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (MangledId, MangledId)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="annot"><a href="IR.MangleNames.html#mangleProgram"><span class="hs-identifier hs-type">mangleProgram</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IR.IR.html#Program"><span class="hs-identifier hs-type">I.Program</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Compiler.Pass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#Program"><span class="hs-identifier hs-type">I.Program</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span id="mangleProgram"><span class="annot"><span class="annottext">mangleProgram :: Program Type -&gt; Pass (Program Type)
</span><a href="IR.MangleNames.html#mangleProgram"><span class="hs-identifier hs-var hs-var">mangleProgram</span></a></span></span><span> </span><span id="local-6989586621679511682"><span class="annot"><span class="annottext">Program Type
</span><a href="#local-6989586621679511682"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mangle (Program Type) -&gt; Pass (Program Type)
forall a. Mangle a -&gt; Pass a
</span><a href="IR.MangleNames.html#runMangle"><span class="hs-identifier hs-var">runMangle</span></a></span><span> </span><span class="annot"><span class="annottext">(Mangle (Program Type) -&gt; Pass (Program Type))
-&gt; Mangle (Program Type) -&gt; Pass (Program Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-111"></span><span>  </span><span id="local-6989586621679511681"><span class="annot"><span class="annottext">[(MangledId, MangledId)]
</span><a href="#local-6989586621679511681"><span class="hs-identifier hs-var">eds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(MangledId, Type)]
-&gt; ((MangledId, Type) -&gt; Mangle (MangledId, MangledId))
-&gt; Mangle [(MangledId, MangledId)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Program Type -&gt; [(MangledId, Type)]
forall t. Program t -&gt; [(MangledId, Type)]
</span><a href="IR.IR.html#externDecls"><span class="hs-identifier hs-var hs-var">I.externDecls</span></a></span><span> </span><span class="annot"><span class="annottext">Program Type
</span><a href="#local-6989586621679511682"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((MangledId, Type) -&gt; Mangle (MangledId, MangledId))
 -&gt; Mangle [(MangledId, MangledId)])
-&gt; ((MangledId, Type) -&gt; Mangle (MangledId, MangledId))
-&gt; Mangle [(MangledId, MangledId)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679511679"><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511679"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679511678"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679511678"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679511677"><span class="annot"><span class="annottext">info :: SymInfo Type
</span><a href="#local-6989586621679511677"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SymInfo :: forall t. MangledId -&gt; t -&gt; SymInfo t
</span><a href="IR.IR.html#SymInfo"><span class="hs-identifier hs-type">I.SymInfo</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">symOrigin :: MangledId
</span><a href="IR.IR.html#symOrigin"><span class="hs-identifier hs-var">I.symOrigin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511679"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">symType :: Type
</span><a href="IR.IR.html#symType"><span class="hs-identifier hs-var">I.symType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679511678"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-113"></span><span>    </span><span class="annot"><span class="annottext">MangledId -&gt; SymInfo Type -&gt; Mangle ()
</span><a href="IR.MangleNames.html#tellGlobal"><span class="hs-identifier hs-var">tellGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511679"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">SymInfo Type
</span><a href="#local-6989586621679511677"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-114"></span><span>    </span><span class="annot"><span class="annottext">(MangledId, MangledId) -&gt; Mangle (MangledId, MangledId)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511679"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511679"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>  </span><span class="annot"><span class="annottext">[(MangledId, MangledId)]
-&gt; Mangle (Program Type) -&gt; Mangle (Program Type)
forall a. [(MangledId, MangledId)] -&gt; Mangle a -&gt; Mangle a
</span><a href="IR.MangleNames.html#withLocals"><span class="hs-identifier hs-var">withLocals</span></a></span><span> </span><span class="annot"><span class="annottext">[(MangledId, MangledId)]
</span><a href="#local-6989586621679511681"><span class="hs-identifier hs-var">eds</span></a></span><span> </span><span class="annot"><span class="annottext">(Mangle (Program Type) -&gt; Mangle (Program Type))
-&gt; Mangle (Program Type) -&gt; Mangle (Program Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679511676"><span class="annot"><span class="annottext">[Binder Type]
</span><a href="#local-6989586621679511676"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679511675"><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679511675"><span class="hs-identifier hs-var">tes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Binder Type, Expr Type)] -&gt; ([Binder Type], [Expr Type])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">([(Binder Type, Expr Type)] -&gt; ([Binder Type], [Expr Type]))
-&gt; [(Binder Type, Expr Type)] -&gt; ([Binder Type], [Expr Type])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Program Type -&gt; [(Binder Type, Expr Type)]
forall t. Program t -&gt; [(Binder t, Expr t)]
</span><a href="IR.IR.html#programDefs"><span class="hs-identifier hs-var hs-var">I.programDefs</span></a></span><span> </span><span class="annot"><span class="annottext">Program Type
</span><a href="#local-6989586621679511682"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679511672"><span class="annot"><span class="annottext">[Binder Type]
</span><a href="#local-6989586621679511672"><span class="hs-identifier hs-var">tvs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679511671"><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679511671"><span class="hs-identifier hs-var">tes'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Binder Type]
-&gt; Mangle [Expr Type] -&gt; Mangle ([Binder Type], [Expr Type])
forall a. [Binder Type] -&gt; Mangle a -&gt; Mangle ([Binder Type], a)
</span><a href="IR.MangleNames.html#withMangled"><span class="hs-identifier hs-var">withMangled</span></a></span><span> </span><span class="annot"><span class="annottext">[Binder Type]
</span><a href="#local-6989586621679511676"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">(Mangle [Expr Type] -&gt; Mangle ([Binder Type], [Expr Type]))
-&gt; Mangle [Expr Type] -&gt; Mangle ([Binder Type], [Expr Type])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Expr Type -&gt; Mangle (Expr Type))
-&gt; [Expr Type] -&gt; Mangle [Expr Type]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; Mangle (Expr Type)
</span><a href="IR.MangleNames.html#mangleExpr"><span class="hs-identifier hs-var">mangleExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679511675"><span class="hs-identifier hs-var">tes</span></a></span><span>
</span><span id="line-118"></span><span>    </span><span id="local-6989586621679511669"><span class="annot"><span class="annottext">SymTable Type
</span><a href="#local-6989586621679511669"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(MangleCtx -&gt; SymTable Type) -&gt; Mangle (SymTable Type)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">MangleCtx -&gt; SymTable Type
</span><a href="IR.MangleNames.html#globalScope"><span class="hs-identifier hs-var hs-var">globalScope</span></a></span><span>
</span><span id="line-119"></span><span>    </span><span class="annot"><span class="annottext">Program Type -&gt; Mangle (Program Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Program Type
</span><a href="#local-6989586621679511682"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">programDefs :: [(Binder Type, Expr Type)]
</span><a href="IR.IR.html#programDefs"><span class="hs-identifier hs-var">I.programDefs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Binder Type] -&gt; [Expr Type] -&gt; [(Binder Type, Expr Type)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Binder Type]
</span><a href="#local-6989586621679511672"><span class="hs-identifier hs-var">tvs'</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679511671"><span class="hs-identifier hs-var">tes'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">symTable :: SymTable Type
</span><a href="IR.IR.html#symTable"><span class="hs-identifier hs-var">I.symTable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SymTable Type
</span><a href="#local-6989586621679511669"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="annot"><a href="IR.MangleNames.html#mangleExpr"><span class="hs-identifier hs-type">mangleExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IR.IR.html#Expr"><span class="hs-identifier hs-type">I.Expr</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.MangleNames.html#Mangle"><span class="hs-identifier hs-type">Mangle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#Expr"><span class="hs-identifier hs-type">I.Expr</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span id="mangleExpr"><span class="annot"><span class="annottext">mangleExpr :: Expr Type -&gt; Mangle (Expr Type)
</span><a href="IR.MangleNames.html#mangleExpr"><span class="hs-identifier hs-var hs-var">mangleExpr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#Var"><span class="hs-identifier hs-type">I.Var</span></a></span><span> </span><span id="local-6989586621679511666"><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511666"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679511665"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679511665"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-124"></span><span>  </span><span id="local-6989586621679511664"><span class="annot"><span class="annottext">Maybe MangledId
</span><a href="#local-6989586621679511664"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(MangleCtx -&gt; Maybe MangledId) -&gt; Mangle (Maybe MangledId)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MangledId -&gt; Map MangledId MangledId -&gt; Maybe MangledId
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511666"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(Map MangledId MangledId -&gt; Maybe MangledId)
-&gt; (MangleCtx -&gt; Map MangledId MangledId)
-&gt; MangleCtx
-&gt; Maybe MangledId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MangleCtx -&gt; Map MangledId MangledId
</span><a href="IR.MangleNames.html#localScope"><span class="hs-identifier hs-var hs-var">localScope</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>  </span><span class="annot"><span class="annottext">MangledId -&gt; Type -&gt; Expr Type
forall t. MangledId -&gt; t -&gt; Expr t
</span><a href="IR.IR.html#Var"><span class="hs-identifier hs-var">I.Var</span></a></span><span> </span><span class="annot"><span class="annottext">(MangledId -&gt; Type -&gt; Expr Type)
-&gt; Mangle MangledId -&gt; Mangle (Type -&gt; Expr Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Mangle MangledId
-&gt; (MangledId -&gt; Mangle MangledId)
-&gt; Maybe MangledId
-&gt; Mangle MangledId
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Mangle MangledId
forall a. Mangle a
</span><a href="#local-6989586621679511660"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">MangledId -&gt; Mangle MangledId
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe MangledId
</span><a href="#local-6989586621679511664"><span class="hs-identifier hs-var">mv</span></a></span><span> </span><span class="annot"><span class="annottext">Mangle (Type -&gt; Expr Type) -&gt; Mangle Type -&gt; Mangle (Expr Type)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Mangle Type
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679511665"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-126"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-127"></span><span>  </span><span id="local-6989586621679511660"><span class="annot"><span class="annottext">err :: Mangle a
</span><a href="#local-6989586621679511660"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Mangle a
forall (m :: * -&gt; *) a. MonadError Error m =&gt; String -&gt; m a
</span><a href="Common.Compiler.html#unexpected"><span class="hs-identifier hs-var">Compiler.unexpected</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Mangle a) -&gt; String -&gt; Mangle a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;MangleNames: Could not find I.Var &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">MangledId -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511666"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-128"></span><span class="annot"><a href="IR.MangleNames.html#mangleExpr"><span class="hs-identifier hs-var">mangleExpr</span></a></span><span> </span><span id="local-6989586621679511658"><span class="annot"><span class="annottext">e :: Expr Type
</span><a href="#local-6989586621679511658"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#Data"><span class="hs-identifier hs-type">I.Data</span></a></span><span> </span><span class="annot"><span class="annottext">DConId
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; Mangle (Expr Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679511658"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-129"></span><span class="annot"><a href="IR.MangleNames.html#mangleExpr"><span class="hs-identifier hs-var">mangleExpr</span></a></span><span> </span><span id="local-6989586621679511656"><span class="annot"><span class="annottext">e :: Expr Type
</span><a href="#local-6989586621679511656"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#Lit"><span class="hs-identifier hs-type">I.Lit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; Mangle (Expr Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679511656"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-130"></span><span class="annot"><a href="IR.MangleNames.html#mangleExpr"><span class="hs-identifier hs-var">mangleExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#App"><span class="hs-identifier hs-type">I.App</span></a></span><span> </span><span id="local-6989586621679511653"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679511653"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679511652"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679511652"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679511651"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679511651"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; Expr Type -&gt; Type -&gt; Expr Type
forall t. Expr t -&gt; Expr t -&gt; t -&gt; Expr t
</span><a href="IR.IR.html#App"><span class="hs-identifier hs-var">I.App</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr Type -&gt; Expr Type -&gt; Type -&gt; Expr Type)
-&gt; Mangle (Expr Type) -&gt; Mangle (Expr Type -&gt; Type -&gt; Expr Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; Mangle (Expr Type)
</span><a href="IR.MangleNames.html#mangleExpr"><span class="hs-identifier hs-var">mangleExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679511653"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Mangle (Expr Type -&gt; Type -&gt; Expr Type)
-&gt; Mangle (Expr Type) -&gt; Mangle (Type -&gt; Expr Type)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; Mangle (Expr Type)
</span><a href="IR.MangleNames.html#mangleExpr"><span class="hs-identifier hs-var">mangleExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679511652"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Mangle (Type -&gt; Expr Type) -&gt; Mangle Type -&gt; Mangle (Expr Type)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Mangle Type
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679511651"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-131"></span><span class="annot"><a href="IR.MangleNames.html#mangleExpr"><span class="hs-identifier hs-var">mangleExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#Let"><span class="hs-identifier hs-type">I.Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Binder Type, Expr Type)] -&gt; ([Binder Type], [Expr Type])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679511649"><span class="annot"><span class="annottext">[Binder Type]
</span><a href="#local-6989586621679511649"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679511648"><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679511648"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679511647"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679511647"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679511646"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679511646"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679511645"><span class="annot"><span class="annottext">[Binder Type]
</span><a href="#local-6989586621679511645"><span class="hs-identifier hs-var">vs'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679511644"><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679511644"><span class="hs-identifier hs-var">ds'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679511643"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679511643"><span class="hs-identifier hs-var">b'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-133"></span><span>    </span><span class="annot"><span class="annottext">[Binder Type]
-&gt; Mangle ([Expr Type], Expr Type)
-&gt; Mangle ([Binder Type], ([Expr Type], Expr Type))
forall a. [Binder Type] -&gt; Mangle a -&gt; Mangle ([Binder Type], a)
</span><a href="IR.MangleNames.html#withMangled"><span class="hs-identifier hs-var">withMangled</span></a></span><span> </span><span class="annot"><span class="annottext">[Binder Type]
</span><a href="#local-6989586621679511649"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">(Mangle ([Expr Type], Expr Type)
 -&gt; Mangle ([Binder Type], ([Expr Type], Expr Type)))
-&gt; Mangle ([Expr Type], Expr Type)
-&gt; Mangle ([Binder Type], ([Expr Type], Expr Type))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Expr Type] -&gt; Expr Type -&gt; ([Expr Type], Expr Type))
-&gt; Mangle [Expr Type]
-&gt; Mangle (Expr Type -&gt; ([Expr Type], Expr Type))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Expr Type -&gt; Mangle (Expr Type))
-&gt; [Expr Type] -&gt; Mangle [Expr Type]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; Mangle (Expr Type)
</span><a href="IR.MangleNames.html#mangleExpr"><span class="hs-identifier hs-var">mangleExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679511648"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">Mangle (Expr Type -&gt; ([Expr Type], Expr Type))
-&gt; Mangle (Expr Type) -&gt; Mangle ([Expr Type], Expr Type)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; Mangle (Expr Type)
</span><a href="IR.MangleNames.html#mangleExpr"><span class="hs-identifier hs-var">mangleExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679511647"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-134"></span><span>  </span><span class="annot"><span class="annottext">Expr Type -&gt; Mangle (Expr Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Expr Type -&gt; Mangle (Expr Type))
-&gt; Expr Type -&gt; Mangle (Expr Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Binder Type, Expr Type)] -&gt; Expr Type -&gt; Type -&gt; Expr Type
forall t. [(Binder t, Expr t)] -&gt; Expr t -&gt; t -&gt; Expr t
</span><a href="IR.IR.html#Let"><span class="hs-identifier hs-var">I.Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Binder Type] -&gt; [Expr Type] -&gt; [(Binder Type, Expr Type)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Binder Type]
</span><a href="#local-6989586621679511645"><span class="hs-identifier hs-var">vs'</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679511644"><span class="hs-identifier hs-var">ds'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679511643"><span class="hs-identifier hs-var">b'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679511646"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-135"></span><span class="annot"><a href="IR.MangleNames.html#mangleExpr"><span class="hs-identifier hs-var">mangleExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#Lambda"><span class="hs-identifier hs-type">I.Lambda</span></a></span><span> </span><span id="local-6989586621679511641"><span class="annot"><span class="annottext">Binder Type
</span><a href="#local-6989586621679511641"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679511640"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679511640"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679511639"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679511639"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">[</span><span id="local-6989586621679511638"><span class="annot"><span class="annottext">Binder Type
</span><a href="#local-6989586621679511638"><span class="hs-identifier hs-var">i'</span></a></span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679511637"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679511637"><span class="hs-identifier hs-var">b'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Binder Type]
-&gt; Mangle (Expr Type) -&gt; Mangle ([Binder Type], Expr Type)
forall a. [Binder Type] -&gt; Mangle a -&gt; Mangle ([Binder Type], a)
</span><a href="IR.MangleNames.html#withMangled"><span class="hs-identifier hs-var">withMangled</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Binder Type
</span><a href="#local-6989586621679511641"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Mangle (Expr Type) -&gt; Mangle ([Binder Type], Expr Type))
-&gt; Mangle (Expr Type) -&gt; Mangle ([Binder Type], Expr Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; Mangle (Expr Type)
</span><a href="IR.MangleNames.html#mangleExpr"><span class="hs-identifier hs-var">mangleExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679511640"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-137"></span><span>  </span><span class="annot"><span class="annottext">Expr Type -&gt; Mangle (Expr Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Expr Type -&gt; Mangle (Expr Type))
-&gt; Expr Type -&gt; Mangle (Expr Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Binder Type -&gt; Expr Type -&gt; Type -&gt; Expr Type
forall t. Binder t -&gt; Expr t -&gt; t -&gt; Expr t
</span><a href="IR.IR.html#Lambda"><span class="hs-identifier hs-var">I.Lambda</span></a></span><span> </span><span class="annot"><span class="annottext">Binder Type
</span><a href="#local-6989586621679511638"><span class="hs-identifier hs-var">i'</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679511637"><span class="hs-identifier hs-var">b'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679511639"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-138"></span><span class="annot"><a href="IR.MangleNames.html#mangleExpr"><span class="hs-identifier hs-var">mangleExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#Match"><span class="hs-identifier hs-type">I.Match</span></a></span><span> </span><span id="local-6989586621679511635"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679511635"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679511634"><span class="annot"><span class="annottext">[(Alt Type, Expr Type)]
</span><a href="#local-6989586621679511634"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span id="local-6989586621679511633"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679511633"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-139"></span><span>  </span><span id="local-6989586621679511632"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679511632"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; Mangle (Expr Type)
</span><a href="IR.MangleNames.html#mangleExpr"><span class="hs-identifier hs-var">mangleExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679511635"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-140"></span><span>  </span><span id="local-6989586621679511631"><span class="annot"><span class="annottext">[(Alt Type, Expr Type)]
</span><a href="#local-6989586621679511631"><span class="hs-identifier hs-var">as'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Alt Type, Expr Type) -&gt; Mangle (Alt Type, Expr Type))
-&gt; [(Alt Type, Expr Type)] -&gt; Mangle [(Alt Type, Expr Type)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">(Alt Type, Expr Type) -&gt; Mangle (Alt Type, Expr Type)
</span><a href="IR.MangleNames.html#mangleArm"><span class="hs-identifier hs-var">mangleArm</span></a></span><span> </span><span class="annot"><span class="annottext">[(Alt Type, Expr Type)]
</span><a href="#local-6989586621679511634"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-141"></span><span>  </span><span class="annot"><span class="annottext">Expr Type -&gt; Mangle (Expr Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Expr Type -&gt; Mangle (Expr Type))
-&gt; Expr Type -&gt; Mangle (Expr Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; [(Alt Type, Expr Type)] -&gt; Type -&gt; Expr Type
forall t. Expr t -&gt; [(Alt t, Expr t)] -&gt; t -&gt; Expr t
</span><a href="IR.IR.html#Match"><span class="hs-identifier hs-var">I.Match</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679511632"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">[(Alt Type, Expr Type)]
</span><a href="#local-6989586621679511631"><span class="hs-identifier hs-var">as'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679511633"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-142"></span><span class="annot"><a href="IR.MangleNames.html#mangleExpr"><span class="hs-identifier hs-var">mangleExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#Prim"><span class="hs-identifier hs-type">I.Prim</span></a></span><span> </span><span id="local-6989586621679511628"><span class="annot"><span class="annottext">Primitive
</span><a href="#local-6989586621679511628"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679511627"><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679511627"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span id="local-6989586621679511626"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679511626"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Primitive -&gt; [Expr Type] -&gt; Type -&gt; Expr Type
forall t. Primitive -&gt; [Expr t] -&gt; t -&gt; Expr t
</span><a href="IR.IR.html#Prim"><span class="hs-identifier hs-var">I.Prim</span></a></span><span> </span><span class="annot"><span class="annottext">Primitive
</span><a href="#local-6989586621679511628"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">([Expr Type] -&gt; Type -&gt; Expr Type)
-&gt; Mangle [Expr Type] -&gt; Mangle (Type -&gt; Expr Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Expr Type -&gt; Mangle (Expr Type))
-&gt; [Expr Type] -&gt; Mangle [Expr Type]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; Mangle (Expr Type)
</span><a href="IR.MangleNames.html#mangleExpr"><span class="hs-identifier hs-var">mangleExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr Type]
</span><a href="#local-6989586621679511627"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">Mangle (Type -&gt; Expr Type) -&gt; Mangle Type -&gt; Mangle (Expr Type)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Mangle Type
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679511626"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-143"></span><span class="annot"><a href="IR.MangleNames.html#mangleExpr"><span class="hs-identifier hs-var">mangleExpr</span></a></span><span> </span><span id="local-6989586621679511625"><span class="annot"><span class="annottext">e :: Expr Type
</span><a href="#local-6989586621679511625"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="IR.IR.html#Exception"><span class="hs-identifier hs-type">I.Exception</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; Mangle (Expr Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679511625"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="annot"><a href="IR.MangleNames.html#mangleArm"><span class="hs-identifier hs-type">mangleArm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#Alt"><span class="hs-identifier hs-type">I.Alt</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IR.IR.html#Expr"><span class="hs-identifier hs-type">I.Expr</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.MangleNames.html#Mangle"><span class="hs-identifier hs-type">Mangle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#Alt"><span class="hs-identifier hs-type">I.Alt</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IR.IR.html#Expr"><span class="hs-identifier hs-type">I.Expr</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span id="mangleArm"><span class="annot"><span class="annottext">mangleArm :: (Alt Type, Expr Type) -&gt; Mangle (Alt Type, Expr Type)
</span><a href="IR.MangleNames.html#mangleArm"><span class="hs-identifier hs-var hs-var">mangleArm</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679511623"><span class="annot"><span class="annottext">Alt Type
</span><a href="#local-6989586621679511623"><span class="hs-identifier hs-var">alt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679511622"><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679511622"><span class="hs-identifier hs-var">ex</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-148"></span><span>  </span><span class="annot"><span class="annottext">([Binder Type], (Alt Type, Expr Type)) -&gt; (Alt Type, Expr Type)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span>
</span><span id="line-149"></span><span>    </span><span class="annot"><span class="annottext">(([Binder Type], (Alt Type, Expr Type)) -&gt; (Alt Type, Expr Type))
-&gt; Mangle ([Binder Type], (Alt Type, Expr Type))
-&gt; Mangle (Alt Type, Expr Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Binder Type]
-&gt; Mangle (Alt Type, Expr Type)
-&gt; Mangle ([Binder Type], (Alt Type, Expr Type))
forall a. [Binder Type] -&gt; Mangle a -&gt; Mangle ([Binder Type], a)
</span><a href="IR.MangleNames.html#withMangled"><span class="hs-identifier hs-var">withMangled</span></a></span><span>
</span><span id="line-150"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Alt Type -&gt; [Binder Type]
forall t. Alt t -&gt; [Binder t]
</span><a href="IR.IR.html#altBinders"><span class="hs-identifier hs-var">I.altBinders</span></a></span><span> </span><span class="annot"><span class="annottext">Alt Type
</span><a href="#local-6989586621679511623"><span class="hs-identifier hs-var">alt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Alt Type -&gt; Expr Type -&gt; (Alt Type, Expr Type))
-&gt; Mangle (Alt Type) -&gt; Mangle (Expr Type -&gt; (Alt Type, Expr Type))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Alt Type -&gt; Mangle (Alt Type)
</span><a href="#local-6989586621679511620"><span class="hs-identifier hs-var">mangleAlt</span></a></span><span> </span><span class="annot"><span class="annottext">Alt Type
</span><a href="#local-6989586621679511623"><span class="hs-identifier hs-var">alt</span></a></span><span> </span><span class="annot"><span class="annottext">Mangle (Expr Type -&gt; (Alt Type, Expr Type))
-&gt; Mangle (Expr Type) -&gt; Mangle (Alt Type, Expr Type)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr Type -&gt; Mangle (Expr Type)
</span><a href="IR.MangleNames.html#mangleExpr"><span class="hs-identifier hs-var">mangleExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Type
</span><a href="#local-6989586621679511622"><span class="hs-identifier hs-var">ex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-153"></span><span>  </span><span id="local-6989586621679511620"><span class="annot"><span class="annottext">mangleAlt :: Alt Type -&gt; Mangle (Alt Type)
</span><a href="#local-6989586621679511620"><span class="hs-identifier hs-var hs-var">mangleAlt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#AltData"><span class="hs-identifier hs-type">I.AltData</span></a></span><span> </span><span id="local-6989586621679511618"><span class="annot"><span class="annottext">DConId
</span><a href="#local-6989586621679511618"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621679511617"><span class="annot"><span class="annottext">[Alt Type]
</span><a href="#local-6989586621679511617"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621679511616"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679511616"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DConId -&gt; [Alt Type] -&gt; Type -&gt; Alt Type
forall t. DConId -&gt; [Alt t] -&gt; t -&gt; Alt t
</span><a href="IR.IR.html#AltData"><span class="hs-identifier hs-var">I.AltData</span></a></span><span> </span><span class="annot"><span class="annottext">DConId
</span><a href="#local-6989586621679511618"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">([Alt Type] -&gt; Type -&gt; Alt Type)
-&gt; Mangle [Alt Type] -&gt; Mangle (Type -&gt; Alt Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Alt Type -&gt; Mangle (Alt Type)) -&gt; [Alt Type] -&gt; Mangle [Alt Type]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Alt Type -&gt; Mangle (Alt Type)
</span><a href="#local-6989586621679511620"><span class="hs-identifier hs-var">mangleAlt</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt Type]
</span><a href="#local-6989586621679511617"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Mangle (Type -&gt; Alt Type) -&gt; Mangle Type -&gt; Mangle (Alt Type)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Mangle Type
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679511616"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-154"></span><span>  </span><span class="annot"><a href="#local-6989586621679511620"><span class="hs-identifier hs-var">mangleAlt</span></a></span><span> </span><span id="local-6989586621679511615"><span class="annot"><span class="annottext">a :: Alt Type
</span><a href="#local-6989586621679511615"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#AltLit"><span class="hs-identifier hs-type">I.AltLit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Alt Type -&gt; Mangle (Alt Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Alt Type
</span><a href="#local-6989586621679511615"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-155"></span><span>  </span><span class="annot"><a href="#local-6989586621679511620"><span class="hs-identifier hs-var">mangleAlt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#AltBinder"><span class="hs-identifier hs-type">I.AltBinder</span></a></span><span> </span><span id="local-6989586621679511612"><span class="annot"><span class="annottext">Binder Type
</span><a href="#local-6989586621679511612"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Binder Type -&gt; Alt Type
forall t. Binder t -&gt; Alt t
</span><a href="IR.IR.html#AltBinder"><span class="hs-identifier hs-var">I.AltBinder</span></a></span><span> </span><span class="annot"><span class="annottext">(Binder Type -&gt; Alt Type)
-&gt; Mangle (Binder Type) -&gt; Mangle (Alt Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Binder Type -&gt; Mangle (Binder Type)
</span><a href="#local-6989586621679511611"><span class="hs-identifier hs-var">lookupBinder</span></a></span><span> </span><span class="annot"><span class="annottext">Binder Type
</span><a href="#local-6989586621679511612"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span>  </span><span class="annot"><a href="#local-6989586621679511611"><span class="hs-identifier hs-type">lookupBinder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IR.IR.html#Binder"><span class="hs-identifier hs-type">I.Binder</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IR.MangleNames.html#Mangle"><span class="hs-identifier hs-type">Mangle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#Binder"><span class="hs-identifier hs-type">I.Binder</span></a></span><span> </span><span class="annot"><a href="IR.Types.Type.html#Type"><span class="hs-identifier hs-type">I.Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>  </span><span id="local-6989586621679511611"><span class="annot"><span class="annottext">lookupBinder :: Binder Type -&gt; Mangle (Binder Type)
</span><a href="#local-6989586621679511611"><span class="hs-identifier hs-var hs-var">lookupBinder</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IR.IR.html#BindVar"><span class="hs-identifier hs-type">I.BindVar</span></a></span><span> </span><span id="local-6989586621679511610"><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511610"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679511609"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679511609"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-159"></span><span>    </span><span id="local-6989586621679511608"><span class="annot"><span class="annottext">Maybe MangledId
</span><a href="#local-6989586621679511608"><span class="hs-identifier hs-var">mi'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(MangleCtx -&gt; Maybe MangledId) -&gt; Mangle (Maybe MangledId)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">((MangleCtx -&gt; Maybe MangledId) -&gt; Mangle (Maybe MangledId))
-&gt; (MangleCtx -&gt; Maybe MangledId) -&gt; Mangle (Maybe MangledId)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MangledId -&gt; Map MangledId MangledId -&gt; Maybe MangledId
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511610"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(Map MangledId MangledId -&gt; Maybe MangledId)
-&gt; (MangleCtx -&gt; Map MangledId MangledId)
-&gt; MangleCtx
-&gt; Maybe MangledId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MangleCtx -&gt; Map MangledId MangledId
</span><a href="IR.MangleNames.html#localScope"><span class="hs-identifier hs-var hs-var">localScope</span></a></span><span>
</span><span id="line-160"></span><span>    </span><span id="local-6989586621679511607"><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511607"><span class="hs-identifier hs-var">i'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Mangle MangledId
-&gt; (MangledId -&gt; Mangle MangledId)
-&gt; Maybe MangledId
-&gt; Mangle MangledId
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Mangle MangledId
forall a. Mangle a
</span><a href="#local-6989586621679511606"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">MangledId -&gt; Mangle MangledId
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe MangledId
</span><a href="#local-6989586621679511608"><span class="hs-identifier hs-var">mi'</span></a></span><span>
</span><span id="line-161"></span><span>    </span><span class="annot"><span class="annottext">Binder Type -&gt; Mangle (Binder Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Binder Type -&gt; Mangle (Binder Type))
-&gt; Binder Type -&gt; Mangle (Binder Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MangledId -&gt; Type -&gt; Binder Type
forall t. MangledId -&gt; t -&gt; Binder t
</span><a href="IR.IR.html#BindVar"><span class="hs-identifier hs-var">I.BindVar</span></a></span><span> </span><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511607"><span class="hs-identifier hs-var">i'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679511609"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-162"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-163"></span><span>    </span><span id="local-6989586621679511606"><span class="annot"><span class="annottext">err :: Mangle a
</span><a href="#local-6989586621679511606"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Mangle a
forall (m :: * -&gt; *) a. MonadError Error m =&gt; String -&gt; m a
</span><a href="Common.Compiler.html#unexpected"><span class="hs-identifier hs-var">Compiler.unexpected</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Mangle a) -&gt; String -&gt; Mangle a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mangleAlt: Could not find I.Var &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">MangledId -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">MangledId
</span><a href="#local-6989586621679511610"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-164"></span><span>  </span><span class="annot"><a href="#local-6989586621679511611"><span class="hs-identifier hs-var">lookupBinder</span></a></span><span> </span><span id="local-6989586621679511605"><span class="annot"><span class="annottext">Binder Type
</span><a href="#local-6989586621679511605"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Binder Type -&gt; Mangle (Binder Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Binder Type
</span><a href="#local-6989586621679511605"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-165"></span></pre></body></html>