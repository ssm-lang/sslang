<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DerivingVia #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">{- | Check scoping rules and naming conventions for identifiers.

Here, we ensure that all identifiers that appear in the AST only appear after
they are previously declared or defined.

Identifiers can be segregated into two categories: data identifiers, which
produce expressions, and type identifiers, which produce types (more accurately,
type expressions). These inhabit separate namespaces and are distinguished by
the different contexts in which they are used.

Of each category, there are two kinds of identifiers: constructors and
variables. Constructors must begin with an upper case letter or a colon (@:@);
all other identifiers are variables (see 'isCons' and 'isVar'). For instance,
data constructors name the variants of an algebraic data type, while data
variables name values bound by a let-binding, a pattern-match, or a lambda.
Meanwhile, type constructors are points in the type system defined by the user,
while type variables are universally quantified in each type expression.

Consider the following example:

@@
type Bool =
  True
  False

type Either t u =
  Left t
  Right u

liftEither b x y: Bool -&gt; a -&gt; b -&gt; Either a b =
  match b
    True  = Left x
    False = Right y
@@

Data variables are @switch@, @b@, @x@, and @y@; data constructors are @True@,
@False@, @Left@, and @Right@. Type variables are @t@, @u@, @a@, and @b@; type
constructors are @Bool@ and @Either@.

The grammar as it appears in the parser does not actually distinguish between
any of these kinds of identifiers, so it is the responsibility of this module to
check that, a data constructor does not appear where a data variable is
expected, e.g., @let F x = e@, or vice versa, e.g., @let f (x Y) = e@.
-}</span><span>
</span><span id="line-50"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Front.Scope</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Scope.html#scopeProgram"><span class="hs-identifier">scopeProgram</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Common.Compiler.html"><span class="hs-identifier">Common.Compiler</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-53"></span><span>  </span><span class="annot"><a href="Common.Compiler.html#Error"><span class="hs-identifier">Error</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><a href="Common.Compiler.html#ErrorMsg"><span class="hs-identifier">ErrorMsg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>  </span><span class="annot"><span class="hs-identifier">MonadError</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>  </span><span class="annot"><span class="hs-identifier">MonadWriter</span></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>  </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier">Pass</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>  </span><span class="annot"><a href="Common.Compiler.html#Warning"><span class="hs-identifier">Warning</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>  </span><span class="annot"><span class="hs-identifier">fromString</span></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>  </span><span class="annot"><a href="Common.Compiler.html#warn"><span class="hs-identifier">warn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Common.Default.html"><span class="hs-identifier">Common.Default</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.Default.html#Default"><span class="hs-identifier">Default</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Common.Identifiers.html"><span class="hs-identifier">Common.Identifiers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.Identifiers.html#Identifiable"><span class="hs-identifier">Identifiable</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Common.Identifiers.html#Identifier"><span class="hs-identifier">Identifier</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Common.Identifiers.html#isCons"><span class="hs-identifier">isCons</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Common.Identifiers.html#isReserved"><span class="hs-identifier">isReserved</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Common.Identifiers.html#isVar"><span class="hs-identifier">isVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Front.Ast.html"><span class="hs-identifier">Front.Ast</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Front.Identifiers.html"><span class="hs-identifier">Front.Identifiers</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-67"></span><span>  </span><span class="annot"><a href="Front.Identifiers.html#DataInfo"><span class="hs-identifier">DataInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>  </span><span class="annot"><a href="Front.Identifiers.html#IdKind"><span class="hs-identifier">IdKind</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>  </span><span class="annot"><a href="Front.Identifiers.html#TypInfo"><span class="hs-identifier">TypInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>  </span><span class="annot"><a href="Front.Identifiers.html#builtinData"><span class="hs-identifier">builtinData</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>  </span><span class="annot"><a href="Front.Identifiers.html#builtinTypes"><span class="hs-identifier">builtinTypes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">forM_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unless</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">when</span></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadReader</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ReaderT</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">asks</span></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">group</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sort</span></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isJust</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-comment">-- | Report 'Identifier' for error reporting.</span><span>
</span><span id="line-82"></span><span class="annot"><a href="Front.Scope.html#showId"><span class="hs-identifier hs-type">showId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Common.Identifiers.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Common.Compiler.html#ErrorMsg"><span class="hs-identifier hs-type">ErrorMsg</span></a></span><span>
</span><span id="line-83"></span><span id="showId"><span class="annot"><span class="annottext">showId :: Identifier -&gt; ErrorMsg
</span><a href="Front.Scope.html#showId"><span class="hs-identifier hs-var hs-var">showId</span></a></span></span><span> </span><span id="local-6989586621679491817"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491817"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ErrorMsg
</span><span class="hs-string">&quot;'&quot;</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; ErrorMsg -&gt; ErrorMsg
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ErrorMsg
forall a. IsString a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; String
forall i. Identifiable i =&gt; i -&gt; String
</span><a href="Common.Identifiers.html#ident"><span class="hs-identifier hs-var">ident</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491817"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; ErrorMsg -&gt; ErrorMsg
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg
</span><span class="hs-string">&quot;'&quot;</span></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-comment">{- | Scoping environment, maintained during the scoping pass.

In type expressions that act as type annotations, type variables are implicitly
qualified at the top-level, so any type variable is always in scope. So, an
annotation like @id : a -&gt; a@ is legal, and means @id : forall a. a -&gt; a@.

However, in the context of type definitions, type variables must be quantified.
So something like @type T a = D a b@ is illegal because the type variable @b@
does not appear as a parameter of unary type constructor @T@.

To account for this discrepancy, the 'implicitScheme' field of the scoping
environment is used to keep track of this context.
-}</span><span>
</span><span id="line-99"></span><span class="hs-keyword">data</span><span> </span><span id="ScopeCtx"><span class="annot"><a href="Front.Scope.html#ScopeCtx"><span class="hs-identifier hs-var">ScopeCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ScopeCtx"><span class="annot"><a href="Front.Scope.html#ScopeCtx"><span class="hs-identifier hs-var">ScopeCtx</span></a></span></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- | Map of in-scope data ids</span><span>
</span><span id="line-101"></span><span>    </span><span id="dataMap"><span class="annot"><span class="annottext">ScopeCtx -&gt; Map Identifier DataInfo
</span><a href="Front.Scope.html#dataMap"><span class="hs-identifier hs-var hs-var">dataMap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Common.Identifiers.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="annot"><a href="Front.Identifiers.html#DataInfo"><span class="hs-identifier hs-type">DataInfo</span></a></span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- | Map of in-scope type ids</span><span>
</span><span id="line-103"></span><span>    </span><span id="typeMap"><span class="annot"><span class="annottext">ScopeCtx -&gt; Map Identifier TypInfo
</span><a href="Front.Scope.html#typeMap"><span class="hs-identifier hs-var hs-var">typeMap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Common.Identifiers.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="annot"><a href="Front.Identifiers.html#TypInfo"><span class="hs-identifier hs-type">TypInfo</span></a></span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- | Allow implicit type vars</span><span>
</span><span id="line-105"></span><span>    </span><span id="implicitScheme"><span class="annot"><span class="annottext">ScopeCtx -&gt; Bool
</span><a href="Front.Scope.html#implicitScheme"><span class="hs-identifier hs-var hs-var">implicitScheme</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-comment">-- | Scoping monad.</span><span>
</span><span id="line-110"></span><span class="hs-keyword">newtype</span><span> </span><span id="ScopeFn"><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-var">ScopeFn</span></a></span></span><span> </span><span id="local-6989586621679491811"><span class="annot"><a href="#local-6989586621679491811"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ScopeFn"><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-var">ScopeFn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeCtx"><span class="hs-identifier hs-type">ScopeCtx</span></a></span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Pass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679491811"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679491806"><span id="local-6989586621679491808"><span class="annot"><span class="annottext">a -&gt; ScopeFn b -&gt; ScopeFn a
(a -&gt; b) -&gt; ScopeFn a -&gt; ScopeFn b
(forall a b. (a -&gt; b) -&gt; ScopeFn a -&gt; ScopeFn b)
-&gt; (forall a b. a -&gt; ScopeFn b -&gt; ScopeFn a) -&gt; Functor ScopeFn
forall a b. a -&gt; ScopeFn b -&gt; ScopeFn a
forall a b. (a -&gt; b) -&gt; ScopeFn a -&gt; ScopeFn b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: a -&gt; ScopeFn b -&gt; ScopeFn a
$c&lt;$ :: forall a b. a -&gt; ScopeFn b -&gt; ScopeFn a
fmap :: (a -&gt; b) -&gt; ScopeFn a -&gt; ScopeFn b
$cfmap :: forall a b. (a -&gt; b) -&gt; ScopeFn a -&gt; ScopeFn b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeCtx"><span class="hs-identifier hs-type">ScopeCtx</span></a></span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Pass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679491794"><span id="local-6989586621679491796"><span id="local-6989586621679491798"><span id="local-6989586621679491800"><span id="local-6989586621679491802"><span class="annot"><span class="annottext">Functor ScopeFn
a -&gt; ScopeFn a
Functor ScopeFn
-&gt; (forall a. a -&gt; ScopeFn a)
-&gt; (forall a b. ScopeFn (a -&gt; b) -&gt; ScopeFn a -&gt; ScopeFn b)
-&gt; (forall a b c.
    (a -&gt; b -&gt; c) -&gt; ScopeFn a -&gt; ScopeFn b -&gt; ScopeFn c)
-&gt; (forall a b. ScopeFn a -&gt; ScopeFn b -&gt; ScopeFn b)
-&gt; (forall a b. ScopeFn a -&gt; ScopeFn b -&gt; ScopeFn a)
-&gt; Applicative ScopeFn
ScopeFn a -&gt; ScopeFn b -&gt; ScopeFn b
ScopeFn a -&gt; ScopeFn b -&gt; ScopeFn a
ScopeFn (a -&gt; b) -&gt; ScopeFn a -&gt; ScopeFn b
(a -&gt; b -&gt; c) -&gt; ScopeFn a -&gt; ScopeFn b -&gt; ScopeFn c
forall a. a -&gt; ScopeFn a
forall a b. ScopeFn a -&gt; ScopeFn b -&gt; ScopeFn a
forall a b. ScopeFn a -&gt; ScopeFn b -&gt; ScopeFn b
forall a b. ScopeFn (a -&gt; b) -&gt; ScopeFn a -&gt; ScopeFn b
forall a b c. (a -&gt; b -&gt; c) -&gt; ScopeFn a -&gt; ScopeFn b -&gt; ScopeFn c
forall (f :: * -&gt; *).
Functor f
-&gt; (forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
&lt;* :: ScopeFn a -&gt; ScopeFn b -&gt; ScopeFn a
$c&lt;* :: forall a b. ScopeFn a -&gt; ScopeFn b -&gt; ScopeFn a
*&gt; :: ScopeFn a -&gt; ScopeFn b -&gt; ScopeFn b
$c*&gt; :: forall a b. ScopeFn a -&gt; ScopeFn b -&gt; ScopeFn b
liftA2 :: (a -&gt; b -&gt; c) -&gt; ScopeFn a -&gt; ScopeFn b -&gt; ScopeFn c
$cliftA2 :: forall a b c. (a -&gt; b -&gt; c) -&gt; ScopeFn a -&gt; ScopeFn b -&gt; ScopeFn c
&lt;*&gt; :: ScopeFn (a -&gt; b) -&gt; ScopeFn a -&gt; ScopeFn b
$c&lt;*&gt; :: forall a b. ScopeFn (a -&gt; b) -&gt; ScopeFn a -&gt; ScopeFn b
pure :: a -&gt; ScopeFn a
$cpure :: forall a. a -&gt; ScopeFn a
$cp1Applicative :: Functor ScopeFn
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeCtx"><span class="hs-identifier hs-type">ScopeCtx</span></a></span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Pass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679491786"><span id="local-6989586621679491788"><span id="local-6989586621679491790"><span class="annot"><span class="annottext">Applicative ScopeFn
a -&gt; ScopeFn a
Applicative ScopeFn
-&gt; (forall a b. ScopeFn a -&gt; (a -&gt; ScopeFn b) -&gt; ScopeFn b)
-&gt; (forall a b. ScopeFn a -&gt; ScopeFn b -&gt; ScopeFn b)
-&gt; (forall a. a -&gt; ScopeFn a)
-&gt; Monad ScopeFn
ScopeFn a -&gt; (a -&gt; ScopeFn b) -&gt; ScopeFn b
ScopeFn a -&gt; ScopeFn b -&gt; ScopeFn b
forall a. a -&gt; ScopeFn a
forall a b. ScopeFn a -&gt; ScopeFn b -&gt; ScopeFn b
forall a b. ScopeFn a -&gt; (a -&gt; ScopeFn b) -&gt; ScopeFn b
forall (m :: * -&gt; *).
Applicative m
-&gt; (forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
return :: a -&gt; ScopeFn a
$creturn :: forall a. a -&gt; ScopeFn a
&gt;&gt; :: ScopeFn a -&gt; ScopeFn b -&gt; ScopeFn b
$c&gt;&gt; :: forall a b. ScopeFn a -&gt; ScopeFn b -&gt; ScopeFn b
&gt;&gt;= :: ScopeFn a -&gt; (a -&gt; ScopeFn b) -&gt; ScopeFn b
$c&gt;&gt;= :: forall a b. ScopeFn a -&gt; (a -&gt; ScopeFn b) -&gt; ScopeFn b
$cp1Monad :: Applicative ScopeFn
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeCtx"><span class="hs-identifier hs-type">ScopeCtx</span></a></span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Pass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679491782"><span class="annot"><span class="annottext">Monad ScopeFn
Monad ScopeFn
-&gt; (forall a. String -&gt; ScopeFn a) -&gt; MonadFail ScopeFn
String -&gt; ScopeFn a
forall a. String -&gt; ScopeFn a
forall (m :: * -&gt; *).
Monad m -&gt; (forall a. String -&gt; m a) -&gt; MonadFail m
fail :: String -&gt; ScopeFn a
$cfail :: forall a. String -&gt; ScopeFn a
$cp1MonadFail :: Monad ScopeFn
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadFail</span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeCtx"><span class="hs-identifier hs-type">ScopeCtx</span></a></span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Pass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679491776"><span id="local-6989586621679491778"><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Common.Compiler.html#Error"><span class="hs-identifier hs-type">Error</span></a></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeCtx"><span class="hs-identifier hs-type">ScopeCtx</span></a></span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Pass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679491765"><span id="local-6989586621679491767"><span id="local-6989586621679491769"><span id="local-6989586621679491771"><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Common.Compiler.html#Warning"><span class="hs-identifier hs-type">Warning</span></a></span><span class="hs-special">]</span></span></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeCtx"><span class="hs-identifier hs-type">ScopeCtx</span></a></span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Pass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679491757"><span id="local-6989586621679491759"><span id="local-6989586621679491761"><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeCtx"><span class="hs-identifier hs-type">ScopeCtx</span></a></span></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeCtx"><span class="hs-identifier hs-type">ScopeCtx</span></a></span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Pass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-comment">-- | Run a ScopeFn computation.</span><span>
</span><span id="line-121"></span><span id="local-6989586621679491875"><span class="annot"><a href="Front.Scope.html#runScopeFn"><span class="hs-identifier hs-type">runScopeFn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679491875"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Pass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679491875"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-122"></span><span id="runScopeFn"><span class="annot"><span class="annottext">runScopeFn :: ScopeFn a -&gt; Pass a
</span><a href="Front.Scope.html#runScopeFn"><span class="hs-identifier hs-var hs-var">runScopeFn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span id="local-6989586621679491754"><span class="annot"><span class="annottext">ReaderT ScopeCtx Pass a
</span><a href="#local-6989586621679491754"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-123"></span><span>  </span><span class="annot"><span class="annottext">ReaderT ScopeCtx Pass a -&gt; ScopeCtx -&gt; Pass a
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var hs-var">runReaderT</span></span><span>
</span><span id="line-124"></span><span>    </span><span class="annot"><span class="annottext">ReaderT ScopeCtx Pass a
</span><a href="#local-6989586621679491754"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-125"></span><span>    </span><span class="annot"><span class="annottext">ScopeCtx :: Map Identifier DataInfo
-&gt; Map Identifier TypInfo -&gt; Bool -&gt; ScopeCtx
</span><a href="Front.Scope.html#ScopeCtx"><span class="hs-identifier hs-type">ScopeCtx</span></a></span><span>
</span><span id="line-126"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dataMap :: Map Identifier DataInfo
</span><a href="Front.Scope.html#dataMap"><span class="hs-identifier hs-var">dataMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Identifier DataInfo
</span><a href="Front.Identifiers.html#builtinData"><span class="hs-identifier hs-var">builtinData</span></a></span><span>
</span><span id="line-127"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">typeMap :: Map Identifier TypInfo
</span><a href="Front.Scope.html#typeMap"><span class="hs-identifier hs-var">typeMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Identifier TypInfo
</span><a href="Front.Identifiers.html#builtinTypes"><span class="hs-identifier hs-var">builtinTypes</span></a></span><span>
</span><span id="line-128"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">implicitScheme :: Bool
</span><a href="Front.Scope.html#implicitScheme"><span class="hs-identifier hs-var">implicitScheme</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-129"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="hs-comment">-- | Add a list of data identifiers to the scope.</span><span>
</span><span id="line-133"></span><span id="local-6989586621679491861"><span class="annot"><a href="Front.Scope.html#withTypeScope"><span class="hs-identifier hs-type">withTypeScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Common.Identifiers.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Front.Identifiers.html#TypInfo"><span class="hs-identifier hs-type">TypInfo</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679491861"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679491861"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-134"></span><span id="withTypeScope"><span class="annot"><span class="annottext">withTypeScope :: [(Identifier, TypInfo)] -&gt; ScopeFn a -&gt; ScopeFn a
</span><a href="Front.Scope.html#withTypeScope"><span class="hs-identifier hs-var hs-var">withTypeScope</span></a></span></span><span> </span><span id="local-6989586621679491751"><span class="annot"><span class="annottext">[(Identifier, TypInfo)]
</span><a href="#local-6989586621679491751"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-135"></span><span>  </span><span class="annot"><span class="annottext">(ScopeCtx -&gt; ScopeCtx) -&gt; ScopeFn a -&gt; ScopeFn a
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; r) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">local</span></span><span> </span><span class="annot"><span class="annottext">((ScopeCtx -&gt; ScopeCtx) -&gt; ScopeFn a -&gt; ScopeFn a)
-&gt; (ScopeCtx -&gt; ScopeCtx) -&gt; ScopeFn a -&gt; ScopeFn a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679491749"><span class="annot"><span class="annottext">ScopeCtx
</span><a href="#local-6989586621679491749"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScopeCtx
</span><a href="#local-6989586621679491749"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">typeMap :: Map Identifier TypInfo
</span><a href="Front.Scope.html#typeMap"><span class="hs-identifier hs-var">typeMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Identifier, TypInfo)
 -&gt; Map Identifier TypInfo -&gt; Map Identifier TypInfo)
-&gt; Map Identifier TypInfo
-&gt; [(Identifier, TypInfo)]
-&gt; Map Identifier TypInfo
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Identifier
 -&gt; TypInfo -&gt; Map Identifier TypInfo -&gt; Map Identifier TypInfo)
-&gt; (Identifier, TypInfo)
-&gt; Map Identifier TypInfo
-&gt; Map Identifier TypInfo
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">Identifier
-&gt; TypInfo -&gt; Map Identifier TypInfo -&gt; Map Identifier TypInfo
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeCtx -&gt; Map Identifier TypInfo
</span><a href="Front.Scope.html#typeMap"><span class="hs-identifier hs-var hs-var">typeMap</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeCtx
</span><a href="#local-6989586621679491749"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Identifier, TypInfo)]
</span><a href="#local-6989586621679491751"><span class="hs-identifier hs-var">is</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-comment">-- | Add a list of data identifiers to the scope.</span><span>
</span><span id="line-139"></span><span id="local-6989586621679491855"><span class="annot"><a href="Front.Scope.html#withDataScope"><span class="hs-identifier hs-type">withDataScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Common.Identifiers.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Front.Identifiers.html#DataInfo"><span class="hs-identifier hs-type">DataInfo</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679491855"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679491855"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-140"></span><span id="withDataScope"><span class="annot"><span class="annottext">withDataScope :: [(Identifier, DataInfo)] -&gt; ScopeFn a -&gt; ScopeFn a
</span><a href="Front.Scope.html#withDataScope"><span class="hs-identifier hs-var hs-var">withDataScope</span></a></span></span><span> </span><span id="local-6989586621679491744"><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
</span><a href="#local-6989586621679491744"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-141"></span><span>  </span><span class="annot"><span class="annottext">(ScopeCtx -&gt; ScopeCtx) -&gt; ScopeFn a -&gt; ScopeFn a
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; r) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">local</span></span><span> </span><span class="annot"><span class="annottext">((ScopeCtx -&gt; ScopeCtx) -&gt; ScopeFn a -&gt; ScopeFn a)
-&gt; (ScopeCtx -&gt; ScopeCtx) -&gt; ScopeFn a -&gt; ScopeFn a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679491743"><span class="annot"><span class="annottext">ScopeCtx
</span><a href="#local-6989586621679491743"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScopeCtx
</span><a href="#local-6989586621679491743"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dataMap :: Map Identifier DataInfo
</span><a href="Front.Scope.html#dataMap"><span class="hs-identifier hs-var">dataMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Identifier, DataInfo)
 -&gt; Map Identifier DataInfo -&gt; Map Identifier DataInfo)
-&gt; Map Identifier DataInfo
-&gt; [(Identifier, DataInfo)]
-&gt; Map Identifier DataInfo
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Identifier
 -&gt; DataInfo -&gt; Map Identifier DataInfo -&gt; Map Identifier DataInfo)
-&gt; (Identifier, DataInfo)
-&gt; Map Identifier DataInfo
-&gt; Map Identifier DataInfo
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">Identifier
-&gt; DataInfo -&gt; Map Identifier DataInfo -&gt; Map Identifier DataInfo
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeCtx -&gt; Map Identifier DataInfo
</span><a href="Front.Scope.html#dataMap"><span class="hs-identifier hs-var hs-var">dataMap</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeCtx
</span><a href="#local-6989586621679491743"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
</span><a href="#local-6989586621679491744"><span class="hs-identifier hs-var">is</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span id="local-6989586621679491849"><span class="annot"><a href="Front.Scope.html#withExplicitScheme"><span class="hs-identifier hs-type">withExplicitScheme</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Common.Identifiers.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679491849"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679491849"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-145"></span><span id="withExplicitScheme"><span class="annot"><span class="annottext">withExplicitScheme :: [Identifier] -&gt; ScopeFn a -&gt; ScopeFn a
</span><a href="Front.Scope.html#withExplicitScheme"><span class="hs-identifier hs-var hs-var">withExplicitScheme</span></a></span></span><span> </span><span id="local-6989586621679491741"><span class="annot"><span class="annottext">[Identifier]
</span><a href="#local-6989586621679491741"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ScopeCtx -&gt; ScopeCtx) -&gt; ScopeFn a -&gt; ScopeFn a
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; r) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">local</span></span><span> </span><span class="annot"><span class="annottext">((ScopeCtx -&gt; ScopeCtx) -&gt; ScopeFn a -&gt; ScopeFn a)
-&gt; (ScopeCtx -&gt; ScopeCtx) -&gt; ScopeFn a -&gt; ScopeFn a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679491740"><span class="annot"><span class="annottext">ScopeCtx
</span><a href="#local-6989586621679491740"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-146"></span><span>  </span><span class="annot"><span class="annottext">ScopeCtx
</span><a href="#local-6989586621679491740"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">typeMap :: Map Identifier TypInfo
</span><a href="Front.Scope.html#typeMap"><span class="hs-identifier hs-var">typeMap</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-148"></span><span>        </span><span class="annot"><span class="annottext">((Identifier, TypInfo)
 -&gt; Map Identifier TypInfo -&gt; Map Identifier TypInfo)
-&gt; Map Identifier TypInfo
-&gt; [(Identifier, TypInfo)]
-&gt; Map Identifier TypInfo
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span>
</span><span id="line-149"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Identifier
 -&gt; TypInfo -&gt; Map Identifier TypInfo -&gt; Map Identifier TypInfo)
-&gt; (Identifier, TypInfo)
-&gt; Map Identifier TypInfo
-&gt; Map Identifier TypInfo
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">Identifier
-&gt; TypInfo -&gt; Map Identifier TypInfo -&gt; Map Identifier TypInfo
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeCtx -&gt; Map Identifier TypInfo
</span><a href="Front.Scope.html#typeMap"><span class="hs-identifier hs-var hs-var">typeMap</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeCtx
</span><a href="#local-6989586621679491740"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Identifier] -&gt; [TypInfo] -&gt; [(Identifier, TypInfo)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Identifier]
</span><a href="#local-6989586621679491741"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="annot"><span class="annottext">([TypInfo] -&gt; [(Identifier, TypInfo)])
-&gt; [TypInfo] -&gt; [(Identifier, TypInfo)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypInfo -&gt; [TypInfo]
forall a. a -&gt; [a]
</span><span class="hs-identifier hs-var">repeat</span></span><span> </span><span class="annot"><span class="annottext">TypInfo :: IdKind -&gt; TypInfo
</span><a href="Front.Identifiers.html#TypInfo"><span class="hs-identifier hs-type">TypInfo</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">typKind :: IdKind
</span><a href="Front.Identifiers.html#typKind"><span class="hs-identifier hs-var">typKind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IdKind
</span><a href="Front.Identifiers.html#User"><span class="hs-identifier hs-var">User</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">implicitScheme :: Bool
</span><a href="Front.Scope.html#implicitScheme"><span class="hs-identifier hs-var">implicitScheme</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="hs-comment">-- | Check that an 'Identifier' is not an empty string.</span><span>
</span><span id="line-157"></span><span class="annot"><a href="Front.Scope.html#ensureNonempty"><span class="hs-identifier hs-type">ensureNonempty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Common.Identifiers.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span id="ensureNonempty"><span class="annot"><span class="annottext">ensureNonempty :: Identifier -&gt; ScopeFn ()
</span><a href="Front.Scope.html#ensureNonempty"><span class="hs-identifier hs-var hs-var">ensureNonempty</span></a></span></span><span> </span><span id="local-6989586621679491734"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491734"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-159"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; ScopeFn () -&gt; ScopeFn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Bool) -&gt; String -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; String
forall i. Identifiable i =&gt; i -&gt; String
</span><a href="Common.Identifiers.html#ident"><span class="hs-identifier hs-var">ident</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491734"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ScopeFn () -&gt; ScopeFn ()) -&gt; ScopeFn () -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Error -&gt; ScopeFn ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(Error -&gt; ScopeFn ()) -&gt; Error -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; Error
</span><a href="Common.Compiler.html#UnexpectedError"><span class="hs-identifier hs-var">UnexpectedError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorMsg
</span><span class="hs-string">&quot;Empty identifier&quot;</span></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span class="hs-comment">-- | Check that a set of bindings does not define overlapping 'Identifier'.</span><span>
</span><span id="line-163"></span><span class="annot"><a href="Front.Scope.html#ensureUnique"><span class="hs-identifier hs-type">ensureUnique</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Common.Identifiers.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span id="ensureUnique"><span class="annot"><span class="annottext">ensureUnique :: [Identifier] -&gt; ScopeFn ()
</span><a href="Front.Scope.html#ensureUnique"><span class="hs-identifier hs-var hs-var">ensureUnique</span></a></span></span><span> </span><span id="local-6989586621679491729"><span class="annot"><span class="annottext">[Identifier]
</span><a href="#local-6989586621679491729"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-165"></span><span>  </span><span class="annot"><span class="annottext">[[Identifier]] -&gt; ([Identifier] -&gt; ScopeFn ()) -&gt; ScopeFn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Identifier] -&gt; [[Identifier]]
forall a. Eq a =&gt; [a] -&gt; [[a]]
</span><span class="hs-identifier hs-var">group</span></span><span> </span><span class="annot"><span class="annottext">([Identifier] -&gt; [[Identifier]]) -&gt; [Identifier] -&gt; [[Identifier]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Identifier] -&gt; [Identifier]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sort</span></span><span> </span><span class="annot"><span class="annottext">[Identifier]
</span><a href="#local-6989586621679491729"><span class="hs-identifier hs-var">ids</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([Identifier] -&gt; ScopeFn ()) -&gt; ScopeFn ())
-&gt; ([Identifier] -&gt; ScopeFn ()) -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Error -&gt; ScopeFn ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(Error -&gt; ScopeFn ()) -&gt; Error -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; Error
</span><a href="Common.Compiler.html#UnexpectedError"><span class="hs-identifier hs-var">UnexpectedError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorMsg
</span><span class="hs-string">&quot;unique should not be empty&quot;</span></span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Identifier
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ScopeFn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>    </span><span id="local-6989586621679491728"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491728"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Identifier]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Error -&gt; ScopeFn ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(Error -&gt; ScopeFn ()) -&gt; Error -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; Error
</span><a href="Common.Compiler.html#ScopeError"><span class="hs-identifier hs-var">ScopeError</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorMsg -&gt; Error) -&gt; ErrorMsg -&gt; Error
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg
</span><span class="hs-string">&quot;Defined more than once: &quot;</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; ErrorMsg -&gt; ErrorMsg
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; ErrorMsg
</span><a href="Front.Scope.html#showId"><span class="hs-identifier hs-var">showId</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491728"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="hs-comment">-- | Ensure that an identifier will not clash with compiler-generated ones</span><span>
</span><span id="line-172"></span><span class="annot"><a href="Front.Scope.html#ensureNotReserved"><span class="hs-identifier hs-type">ensureNotReserved</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Common.Identifiers.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span id="ensureNotReserved"><span class="annot"><span class="annottext">ensureNotReserved :: Identifier -&gt; ScopeFn ()
</span><a href="Front.Scope.html#ensureNotReserved"><span class="hs-identifier hs-var hs-var">ensureNotReserved</span></a></span></span><span> </span><span id="local-6989586621679491725"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491725"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-174"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; ScopeFn () -&gt; ScopeFn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Bool
forall a. Identifiable a =&gt; a -&gt; Bool
</span><a href="Common.Identifiers.html#isReserved"><span class="hs-identifier hs-var">isReserved</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491725"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ScopeFn () -&gt; ScopeFn ()) -&gt; ScopeFn () -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Error -&gt; ScopeFn ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">Error
</span><a href="#local-6989586621679491724"><span class="hs-identifier hs-var">nameErr</span></a></span><span>
</span><span id="line-175"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-176"></span><span>  </span><span id="local-6989586621679491724"><span class="annot"><span class="annottext">nameErr :: Error
</span><a href="#local-6989586621679491724"><span class="hs-identifier hs-var hs-var">nameErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; Error
</span><a href="Common.Compiler.html#NameError"><span class="hs-identifier hs-var">NameError</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorMsg -&gt; Error) -&gt; ErrorMsg -&gt; Error
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; ErrorMsg
</span><a href="Front.Scope.html#showId"><span class="hs-identifier hs-var">showId</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491725"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; ErrorMsg -&gt; ErrorMsg
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg
</span><span class="hs-string">&quot; may clash with internal sslang-generated identifiers&quot;</span></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span class="hs-comment">-- | Check that a constructor 'Identifier' has the right naming convention.</span><span>
</span><span id="line-180"></span><span class="annot"><a href="Front.Scope.html#ensureCons"><span class="hs-identifier hs-type">ensureCons</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Common.Identifiers.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span id="ensureCons"><span class="annot"><span class="annottext">ensureCons :: Identifier -&gt; ScopeFn ()
</span><a href="Front.Scope.html#ensureCons"><span class="hs-identifier hs-var hs-var">ensureCons</span></a></span></span><span> </span><span id="local-6989586621679491721"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491721"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-182"></span><span>  </span><span class="annot"><span class="annottext">Identifier -&gt; ScopeFn ()
</span><a href="Front.Scope.html#ensureNonempty"><span class="hs-identifier hs-var">ensureNonempty</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491721"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-183"></span><span>  </span><span class="annot"><span class="annottext">Identifier -&gt; ScopeFn ()
</span><a href="Front.Scope.html#ensureNotReserved"><span class="hs-identifier hs-var">ensureNotReserved</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491721"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-184"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; ScopeFn () -&gt; ScopeFn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Bool
forall a. Identifiable a =&gt; a -&gt; Bool
</span><a href="Common.Identifiers.html#isCons"><span class="hs-identifier hs-var">isCons</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491721"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ScopeFn () -&gt; ScopeFn ()) -&gt; ScopeFn () -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Error -&gt; ScopeFn ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">Error
</span><a href="#local-6989586621679491720"><span class="hs-identifier hs-var">nameErr</span></a></span><span>
</span><span id="line-185"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-186"></span><span>  </span><span id="local-6989586621679491720"><span class="annot"><span class="annottext">nameErr :: Error
</span><a href="#local-6989586621679491720"><span class="hs-identifier hs-var hs-var">nameErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; Error
</span><a href="Common.Compiler.html#NameError"><span class="hs-identifier hs-var">NameError</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorMsg -&gt; Error) -&gt; ErrorMsg -&gt; Error
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; ErrorMsg
</span><a href="Front.Scope.html#showId"><span class="hs-identifier hs-var">showId</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491721"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; ErrorMsg -&gt; ErrorMsg
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg
</span><span class="hs-string">&quot; should begin with upper case or begin and end with ':'&quot;</span></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-comment">-- | Check that a variable 'Identifier' has the right naming convention.</span><span>
</span><span id="line-190"></span><span class="annot"><a href="Front.Scope.html#ensureVar"><span class="hs-identifier hs-type">ensureVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Common.Identifiers.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span id="ensureVar"><span class="annot"><span class="annottext">ensureVar :: Identifier -&gt; ScopeFn ()
</span><a href="Front.Scope.html#ensureVar"><span class="hs-identifier hs-var hs-var">ensureVar</span></a></span></span><span> </span><span id="local-6989586621679491718"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491718"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-192"></span><span>  </span><span class="annot"><span class="annottext">Identifier -&gt; ScopeFn ()
</span><a href="Front.Scope.html#ensureNonempty"><span class="hs-identifier hs-var">ensureNonempty</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491718"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-193"></span><span>  </span><span class="annot"><span class="annottext">Identifier -&gt; ScopeFn ()
</span><a href="Front.Scope.html#ensureNotReserved"><span class="hs-identifier hs-var">ensureNotReserved</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491718"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-194"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; ScopeFn () -&gt; ScopeFn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Bool
forall a. Identifiable a =&gt; a -&gt; Bool
</span><a href="Common.Identifiers.html#isVar"><span class="hs-identifier hs-var">isVar</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491718"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ScopeFn () -&gt; ScopeFn ()) -&gt; ScopeFn () -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Error -&gt; ScopeFn ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">Error
</span><a href="#local-6989586621679491717"><span class="hs-identifier hs-var">nameErr</span></a></span><span>
</span><span id="line-195"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-196"></span><span>  </span><span id="local-6989586621679491717"><span class="annot"><span class="annottext">nameErr :: Error
</span><a href="#local-6989586621679491717"><span class="hs-identifier hs-var hs-var">nameErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; Error
</span><a href="Common.Compiler.html#NameError"><span class="hs-identifier hs-var">NameError</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorMsg -&gt; Error) -&gt; ErrorMsg -&gt; Error
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; ErrorMsg
</span><a href="Front.Scope.html#showId"><span class="hs-identifier hs-var">showId</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491718"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; ErrorMsg -&gt; ErrorMsg
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg
</span><span class="hs-string">&quot; should begin with upper case or begin and end with ':'&quot;</span></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="hs-comment">{- | Validate a declaration of a data 'Identifier'.

This includes binding to the left of the @=@ in a let-binding or pattern match,
and in the argument of lambdas. Does not include type definitions, where data
constructors are defined.
-}</span><span>
</span><span id="line-205"></span><span class="annot"><a href="Front.Scope.html#dataDecl"><span class="hs-identifier hs-type">dataDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Common.Identifiers.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span id="dataDecl"><span class="annot"><span class="annottext">dataDecl :: Identifier -&gt; ScopeFn ()
</span><a href="Front.Scope.html#dataDecl"><span class="hs-identifier hs-var hs-var">dataDecl</span></a></span></span><span> </span><span id="local-6989586621679491715"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491715"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-207"></span><span>  </span><span id="local-6989586621679491714"><span class="annot"><span class="annottext">Maybe DataInfo
</span><a href="#local-6989586621679491714"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ScopeCtx -&gt; Maybe DataInfo) -&gt; ScopeFn (Maybe DataInfo)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">((ScopeCtx -&gt; Maybe DataInfo) -&gt; ScopeFn (Maybe DataInfo))
-&gt; (ScopeCtx -&gt; Maybe DataInfo) -&gt; ScopeFn (Maybe DataInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Map Identifier DataInfo -&gt; Maybe DataInfo
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491715"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Identifier DataInfo -&gt; Maybe DataInfo)
-&gt; (ScopeCtx -&gt; Map Identifier DataInfo)
-&gt; ScopeCtx
-&gt; Maybe DataInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ScopeCtx -&gt; Map Identifier DataInfo
</span><a href="Front.Scope.html#dataMap"><span class="hs-identifier hs-var hs-var">dataMap</span></a></span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-comment">-- A data constructor cannot be defined inside of a pattern.</span><span>
</span><span id="line-210"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; ScopeFn () -&gt; ScopeFn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Bool
forall a. Identifiable a =&gt; a -&gt; Bool
</span><a href="Common.Identifiers.html#isCons"><span class="hs-identifier hs-var">isCons</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491715"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe DataInfo -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="#local-6989586621679491709"><span class="hs-identifier hs-var">inScope</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DataInfo
</span><a href="#local-6989586621679491714"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ScopeFn () -&gt; ScopeFn ()) -&gt; ScopeFn () -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-211"></span><span>    </span><span class="annot"><span class="annottext">Error -&gt; ScopeFn ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(Error -&gt; ScopeFn ()) -&gt; Error -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; Error
</span><a href="Common.Compiler.html#ScopeError"><span class="hs-identifier hs-var">ScopeError</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorMsg -&gt; Error) -&gt; ErrorMsg -&gt; Error
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg
</span><span class="hs-string">&quot;Data constructor is out of scope: &quot;</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; ErrorMsg -&gt; ErrorMsg
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; ErrorMsg
</span><a href="Front.Scope.html#showId"><span class="hs-identifier hs-var">showId</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491715"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-comment">-- A data variable can usually be shadowed, but we want warn about it.</span><span>
</span><span id="line-214"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; ScopeFn () -&gt; ScopeFn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Bool
forall a. Identifiable a =&gt; a -&gt; Bool
</span><a href="Common.Identifiers.html#isVar"><span class="hs-identifier hs-var">isVar</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491715"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Maybe DataInfo -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="#local-6989586621679491709"><span class="hs-identifier hs-var">inScope</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DataInfo
</span><a href="#local-6989586621679491714"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ScopeFn () -&gt; ScopeFn ()) -&gt; ScopeFn () -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-215"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Maybe DataInfo -&gt; Bool
</span><a href="#local-6989586621679491708"><span class="hs-identifier hs-var">canShadow</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DataInfo
</span><a href="#local-6989586621679491714"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-216"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Warning -&gt; ScopeFn ()
forall (m :: * -&gt; *). MonadWriter [Warning] m =&gt; Warning -&gt; m ()
</span><a href="Common.Compiler.html#warn"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; ScopeFn ()) -&gt; Warning -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; Warning
</span><a href="Common.Compiler.html#NameWarning"><span class="hs-identifier hs-var">NameWarning</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorMsg -&gt; Warning) -&gt; ErrorMsg -&gt; Warning
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg
</span><span class="hs-string">&quot;shadowing variable: &quot;</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; ErrorMsg -&gt; ErrorMsg
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; ErrorMsg
</span><a href="Front.Scope.html#showId"><span class="hs-identifier hs-var">showId</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491715"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-217"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Error -&gt; ScopeFn ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(Error -&gt; ScopeFn ()) -&gt; Error -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; Error
</span><a href="Common.Compiler.html#NameError"><span class="hs-identifier hs-var">NameError</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorMsg -&gt; Error) -&gt; ErrorMsg -&gt; Error
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg
</span><span class="hs-string">&quot;Cannot bind identifier shadowing: &quot;</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; ErrorMsg -&gt; ErrorMsg
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; ErrorMsg
</span><a href="Front.Scope.html#showId"><span class="hs-identifier hs-var">showId</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491715"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-218"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-219"></span><span>  </span><span id="local-6989586621679491709"><span class="annot"><span class="annottext">inScope :: Maybe a -&gt; Bool
</span><a href="#local-6989586621679491709"><span class="hs-identifier hs-var hs-var">inScope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span>
</span><span id="line-220"></span><span>  </span><span id="local-6989586621679491708"><span class="annot"><span class="annottext">canShadow :: Maybe DataInfo -&gt; Bool
</span><a href="#local-6989586621679491708"><span class="hs-identifier hs-var hs-var">canShadow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; (DataInfo -&gt; Bool) -&gt; Maybe DataInfo -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdKind -&gt; IdKind -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IdKind
</span><a href="Front.Identifiers.html#User"><span class="hs-identifier hs-var">User</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IdKind -&gt; Bool) -&gt; (DataInfo -&gt; IdKind) -&gt; DataInfo -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DataInfo -&gt; IdKind
</span><a href="Front.Identifiers.html#dataKind"><span class="hs-identifier hs-var hs-var">dataKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="hs-comment">-- | Validate a reference to a data 'Identifier'.</span><span>
</span><span id="line-224"></span><span class="annot"><a href="Front.Scope.html#dataRef"><span class="hs-identifier hs-type">dataRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Common.Identifiers.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span id="dataRef"><span class="annot"><span class="annottext">dataRef :: Identifier -&gt; ScopeFn ()
</span><a href="Front.Scope.html#dataRef"><span class="hs-identifier hs-var hs-var">dataRef</span></a></span></span><span> </span><span id="local-6989586621679491703"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491703"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; IO ()
forall a. Show a =&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">print</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; ErrorMsg
</span><a href="Front.Scope.html#showId"><span class="hs-identifier hs-var">showId</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491703"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679491702"><span class="annot"><span class="annottext">isDupDrop :: Bool
</span><a href="#local-6989586621679491702"><span class="hs-identifier hs-var hs-var">isDupDrop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; String
forall i. Identifiable i =&gt; i -&gt; String
</span><a href="Common.Identifiers.html#ident"><span class="hs-identifier hs-var">ident</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491703"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dup&quot;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; String
forall i. Identifiable i =&gt; i -&gt; String
</span><a href="Common.Identifiers.html#ident"><span class="hs-identifier hs-var">ident</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491703"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;drop&quot;</span></span><span>
</span><span id="line-228"></span><span>  </span><span id="local-6989586621679491700"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679491700"><span class="hs-identifier hs-var">inScope</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ScopeCtx -&gt; Bool) -&gt; ScopeFn Bool
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">((ScopeCtx -&gt; Bool) -&gt; ScopeFn Bool)
-&gt; (ScopeCtx -&gt; Bool) -&gt; ScopeFn Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Map Identifier DataInfo -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">M.member</span></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491703"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Identifier DataInfo -&gt; Bool)
-&gt; (ScopeCtx -&gt; Map Identifier DataInfo) -&gt; ScopeCtx -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ScopeCtx -&gt; Map Identifier DataInfo
</span><a href="Front.Scope.html#dataMap"><span class="hs-identifier hs-var hs-var">dataMap</span></a></span><span>
</span><span id="line-229"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; ScopeFn () -&gt; ScopeFn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679491700"><span class="hs-identifier hs-var">inScope</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679491702"><span class="hs-identifier hs-var">isDupDrop</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ScopeFn () -&gt; ScopeFn ()) -&gt; ScopeFn () -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-230"></span><span>    </span><span class="annot"><span class="annottext">Error -&gt; ScopeFn ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(Error -&gt; ScopeFn ()) -&gt; Error -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-231"></span><span>      </span><span class="annot"><span class="annottext">ErrorMsg -&gt; Error
</span><a href="Common.Compiler.html#ScopeError"><span class="hs-identifier hs-var">ScopeError</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorMsg -&gt; Error) -&gt; ErrorMsg -&gt; Error
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-232"></span><span>        </span><span class="annot"><span class="annottext">ErrorMsg
</span><span class="hs-string">&quot;Not in scope: &quot;</span></span><span>
</span><span id="line-233"></span><span>          </span><span class="annot"><span class="annottext">ErrorMsg -&gt; ErrorMsg -&gt; ErrorMsg
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; ErrorMsg
</span><a href="Front.Scope.html#showId"><span class="hs-identifier hs-var">showId</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491703"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="hs-comment">-- | Validate a reference to a type 'Identifier'.</span><span>
</span><span id="line-237"></span><span class="annot"><a href="Front.Scope.html#typeRef"><span class="hs-identifier hs-type">typeRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Common.Identifiers.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span id="typeRef"><span class="annot"><span class="annottext">typeRef :: Identifier -&gt; ScopeFn ()
</span><a href="Front.Scope.html#typeRef"><span class="hs-identifier hs-var hs-var">typeRef</span></a></span></span><span> </span><span id="local-6989586621679491697"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491697"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-239"></span><span>  </span><span id="local-6989586621679491696"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679491696"><span class="hs-identifier hs-var">inScope</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ScopeCtx -&gt; Bool) -&gt; ScopeFn Bool
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">((ScopeCtx -&gt; Bool) -&gt; ScopeFn Bool)
-&gt; (ScopeCtx -&gt; Bool) -&gt; ScopeFn Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Map Identifier TypInfo -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">M.member</span></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491697"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Identifier TypInfo -&gt; Bool)
-&gt; (ScopeCtx -&gt; Map Identifier TypInfo) -&gt; ScopeCtx -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ScopeCtx -&gt; Map Identifier TypInfo
</span><a href="Front.Scope.html#typeMap"><span class="hs-identifier hs-var hs-var">typeMap</span></a></span><span>
</span><span id="line-240"></span><span>  </span><span id="local-6989586621679491695"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679491695"><span class="hs-identifier hs-var">allowImplicit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ScopeCtx -&gt; Bool) -&gt; ScopeFn Bool
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">ScopeCtx -&gt; Bool
</span><a href="Front.Scope.html#implicitScheme"><span class="hs-identifier hs-var hs-var">implicitScheme</span></a></span><span>
</span><span id="line-241"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; ScopeFn () -&gt; ScopeFn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679491696"><span class="hs-identifier hs-var">inScope</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Bool
forall a. Identifiable a =&gt; a -&gt; Bool
</span><a href="Common.Identifiers.html#isCons"><span class="hs-identifier hs-var">isCons</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491697"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ScopeFn () -&gt; ScopeFn ()) -&gt; ScopeFn () -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-242"></span><span>    </span><span class="annot"><span class="annottext">Error -&gt; ScopeFn ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(Error -&gt; ScopeFn ()) -&gt; Error -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; Error
</span><a href="Common.Compiler.html#ScopeError"><span class="hs-identifier hs-var">ScopeError</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorMsg -&gt; Error) -&gt; ErrorMsg -&gt; Error
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg
</span><span class="hs-string">&quot;Type constructor is out of scope: &quot;</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; ErrorMsg -&gt; ErrorMsg
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; ErrorMsg
</span><a href="Front.Scope.html#showId"><span class="hs-identifier hs-var">showId</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491697"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-243"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; ScopeFn () -&gt; ScopeFn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679491696"><span class="hs-identifier hs-var">inScope</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Bool
forall a. Identifiable a =&gt; a -&gt; Bool
</span><a href="Common.Identifiers.html#isVar"><span class="hs-identifier hs-var">isVar</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491697"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679491695"><span class="hs-identifier hs-var">allowImplicit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ScopeFn () -&gt; ScopeFn ()) -&gt; ScopeFn () -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-244"></span><span>    </span><span class="annot"><span class="annottext">Error -&gt; ScopeFn ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(Error -&gt; ScopeFn ()) -&gt; Error -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; Error
</span><a href="Common.Compiler.html#ScopeError"><span class="hs-identifier hs-var">ScopeError</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorMsg -&gt; Error) -&gt; ErrorMsg -&gt; Error
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg
</span><span class="hs-string">&quot;Type variable is not defined: &quot;</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; ErrorMsg -&gt; ErrorMsg
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; ErrorMsg
</span><a href="Front.Scope.html#showId"><span class="hs-identifier hs-var">showId</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491697"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span class="hs-comment">-- | Check the scoping of a 'A.Program'.</span><span>
</span><span id="line-248"></span><span class="annot"><a href="Front.Scope.html#scopeProgram"><span class="hs-identifier hs-type">scopeProgram</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Front.Ast.html#Program"><span class="hs-identifier hs-type">A.Program</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Common.Compiler.html#Pass"><span class="hs-identifier hs-type">Pass</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span id="scopeProgram"><span class="annot"><span class="annottext">scopeProgram :: Program -&gt; Pass ()
</span><a href="Front.Scope.html#scopeProgram"><span class="hs-identifier hs-var hs-var">scopeProgram</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#Program"><span class="hs-identifier hs-type">A.Program</span></a></span><span> </span><span id="local-6989586621679491693"><span class="annot"><span class="annottext">[TopDef]
</span><a href="#local-6989586621679491693"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScopeFn () -&gt; Pass ()
forall a. ScopeFn a -&gt; Pass a
</span><a href="Front.Scope.html#runScopeFn"><span class="hs-identifier hs-var">runScopeFn</span></a></span><span> </span><span class="annot"><span class="annottext">(ScopeFn () -&gt; Pass ()) -&gt; ScopeFn () -&gt; Pass ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-250"></span><span>  </span><span class="annot"><span class="annottext">[TypeDef] -&gt; ScopeFn () -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeTypeDefs"><span class="hs-identifier hs-var">scopeTypeDefs</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeDef]
</span><a href="#local-6989586621679491691"><span class="hs-identifier hs-var">tds</span></a></span><span> </span><span class="annot"><span class="annottext">(ScopeFn () -&gt; ScopeFn ()) -&gt; ScopeFn () -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ExternDecl] -&gt; ScopeFn () -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeExterns"><span class="hs-identifier hs-var">scopeExterns</span></a></span><span> </span><span class="annot"><span class="annottext">[ExternDecl]
</span><a href="#local-6989586621679491689"><span class="hs-identifier hs-var">eds</span></a></span><span> </span><span class="annot"><span class="annottext">(ScopeFn () -&gt; ScopeFn ()) -&gt; ScopeFn () -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Definition] -&gt; ScopeFn () -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeDefs"><span class="hs-identifier hs-var">scopeDefs</span></a></span><span> </span><span class="annot"><span class="annottext">[Definition]
</span><a href="#local-6989586621679491687"><span class="hs-identifier hs-var">dds</span></a></span><span> </span><span class="annot"><span class="annottext">(ScopeFn () -&gt; ScopeFn ()) -&gt; ScopeFn () -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; ScopeFn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-252"></span><span>  </span><span id="local-6989586621679491689"><span class="annot"><span class="annottext">eds :: [ExternDecl]
</span><a href="#local-6989586621679491689"><span class="hs-identifier hs-var hs-var">eds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TopDef -&gt; Maybe ExternDecl) -&gt; [TopDef] -&gt; [ExternDecl]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">TopDef -&gt; Maybe ExternDecl
</span><a href="Front.Ast.html#getTopExtern"><span class="hs-identifier hs-var">A.getTopExtern</span></a></span><span> </span><span class="annot"><span class="annottext">[TopDef]
</span><a href="#local-6989586621679491693"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-253"></span><span>  </span><span id="local-6989586621679491691"><span class="annot"><span class="annottext">tds :: [TypeDef]
</span><a href="#local-6989586621679491691"><span class="hs-identifier hs-var hs-var">tds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TopDef -&gt; Maybe TypeDef) -&gt; [TopDef] -&gt; [TypeDef]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">TopDef -&gt; Maybe TypeDef
</span><a href="Front.Ast.html#getTopTypeDef"><span class="hs-identifier hs-var">A.getTopTypeDef</span></a></span><span> </span><span class="annot"><span class="annottext">[TopDef]
</span><a href="#local-6989586621679491693"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-254"></span><span>  </span><span id="local-6989586621679491687"><span class="annot"><span class="annottext">dds :: [Definition]
</span><a href="#local-6989586621679491687"><span class="hs-identifier hs-var hs-var">dds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TopDef -&gt; Maybe Definition) -&gt; [TopDef] -&gt; [Definition]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">TopDef -&gt; Maybe Definition
</span><a href="Front.Ast.html#getTopDataDef"><span class="hs-identifier hs-var">A.getTopDataDef</span></a></span><span> </span><span class="annot"><span class="annottext">[TopDef]
</span><a href="#local-6989586621679491693"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="hs-comment">-- | Check the scoping of a set of type definitions.</span><span>
</span><span id="line-258"></span><span class="annot"><a href="Front.Scope.html#scopeTypeDefs"><span class="hs-identifier hs-type">scopeTypeDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Front.Ast.html#TypeDef"><span class="hs-identifier hs-type">A.TypeDef</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span id="scopeTypeDefs"><span class="annot"><span class="annottext">scopeTypeDefs :: [TypeDef] -&gt; ScopeFn () -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeTypeDefs"><span class="hs-identifier hs-var hs-var">scopeTypeDefs</span></a></span></span><span> </span><span id="local-6989586621679491683"><span class="annot"><span class="annottext">[TypeDef]
</span><a href="#local-6989586621679491683"><span class="hs-identifier hs-var">tds</span></a></span></span><span> </span><span id="local-6989586621679491682"><span class="annot"><span class="annottext">ScopeFn ()
</span><a href="#local-6989586621679491682"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-260"></span><span>  </span><span class="hs-comment">-- Check and collect all type constructors, which are mutually recursive.</span><span>
</span><span id="line-261"></span><span>  </span><span id="local-6989586621679491681"><span class="annot"><span class="annottext">[(Identifier, TypInfo)]
</span><a href="#local-6989586621679491681"><span class="hs-identifier hs-var">tcons</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TypeDef -&gt; ScopeFn (Identifier, TypInfo))
-&gt; [TypeDef] -&gt; ScopeFn [(Identifier, TypInfo)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">TypeDef -&gt; ScopeFn (Identifier, TypInfo)
</span><a href="Front.Scope.html#scopeTCons"><span class="hs-identifier hs-var">scopeTCons</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeDef]
</span><a href="#local-6989586621679491683"><span class="hs-identifier hs-var">tds</span></a></span><span>
</span><span id="line-262"></span><span>  </span><span class="annot"><span class="annottext">[Identifier] -&gt; ScopeFn ()
</span><a href="Front.Scope.html#ensureUnique"><span class="hs-identifier hs-var">ensureUnique</span></a></span><span> </span><span class="annot"><span class="annottext">([Identifier] -&gt; ScopeFn ()) -&gt; [Identifier] -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Identifier, TypInfo) -&gt; Identifier)
-&gt; [(Identifier, TypInfo)] -&gt; [Identifier]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Identifier, TypInfo) -&gt; Identifier
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Identifier, TypInfo)]
</span><a href="#local-6989586621679491681"><span class="hs-identifier hs-var">tcons</span></a></span><span>
</span><span id="line-263"></span><span>  </span><span class="annot"><span class="annottext">[(Identifier, TypInfo)] -&gt; ScopeFn () -&gt; ScopeFn ()
forall a. [(Identifier, TypInfo)] -&gt; ScopeFn a -&gt; ScopeFn a
</span><a href="Front.Scope.html#withTypeScope"><span class="hs-identifier hs-var">withTypeScope</span></a></span><span> </span><span class="annot"><span class="annottext">[(Identifier, TypInfo)]
</span><a href="#local-6989586621679491681"><span class="hs-identifier hs-var">tcons</span></a></span><span> </span><span class="annot"><span class="annottext">(ScopeFn () -&gt; ScopeFn ()) -&gt; ScopeFn () -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-264"></span><span>    </span><span class="hs-comment">-- Then, check and collect all data constructors.</span><span>
</span><span id="line-265"></span><span>    </span><span id="local-6989586621679491678"><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
</span><a href="#local-6989586621679491678"><span class="hs-identifier hs-var">dcons</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[[(Identifier, DataInfo)]] -&gt; [(Identifier, DataInfo)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[(Identifier, DataInfo)]] -&gt; [(Identifier, DataInfo)])
-&gt; ScopeFn [[(Identifier, DataInfo)]]
-&gt; ScopeFn [(Identifier, DataInfo)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(TypeDef -&gt; ScopeFn [(Identifier, DataInfo)])
-&gt; [TypeDef] -&gt; ScopeFn [[(Identifier, DataInfo)]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">TypeDef -&gt; ScopeFn [(Identifier, DataInfo)]
</span><a href="Front.Scope.html#scopeDCons"><span class="hs-identifier hs-var">scopeDCons</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeDef]
</span><a href="#local-6989586621679491683"><span class="hs-identifier hs-var">tds</span></a></span><span>
</span><span id="line-266"></span><span>    </span><span class="annot"><span class="annottext">[Identifier] -&gt; ScopeFn ()
</span><a href="Front.Scope.html#ensureUnique"><span class="hs-identifier hs-var">ensureUnique</span></a></span><span> </span><span class="annot"><span class="annottext">([Identifier] -&gt; ScopeFn ()) -&gt; [Identifier] -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Identifier, DataInfo) -&gt; Identifier)
-&gt; [(Identifier, DataInfo)] -&gt; [Identifier]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Identifier, DataInfo) -&gt; Identifier
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
</span><a href="#local-6989586621679491678"><span class="hs-identifier hs-var">dcons</span></a></span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-comment">-- Continuation k is checked with all type and data constructors in scope</span><span>
</span><span id="line-268"></span><span>    </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)] -&gt; ScopeFn () -&gt; ScopeFn ()
forall a. [(Identifier, DataInfo)] -&gt; ScopeFn a -&gt; ScopeFn a
</span><a href="Front.Scope.html#withDataScope"><span class="hs-identifier hs-var">withDataScope</span></a></span><span> </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
</span><a href="#local-6989586621679491678"><span class="hs-identifier hs-var">dcons</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeFn ()
</span><a href="#local-6989586621679491682"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span class="hs-comment">-- | Check the scoping of a user-defined type constructor.</span><span>
</span><span id="line-272"></span><span class="annot"><a href="Front.Scope.html#scopeTCons"><span class="hs-identifier hs-type">scopeTCons</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Front.Ast.html#TypeDef"><span class="hs-identifier hs-type">A.TypeDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.Identifiers.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Front.Identifiers.html#TypInfo"><span class="hs-identifier hs-type">TypInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span id="scopeTCons"><span class="annot"><span class="annottext">scopeTCons :: TypeDef -&gt; ScopeFn (Identifier, TypInfo)
</span><a href="Front.Scope.html#scopeTCons"><span class="hs-identifier hs-var hs-var">scopeTCons</span></a></span></span><span> </span><span class="annot"><a href="Front.Ast.html#TypeDef"><span class="hs-identifier hs-type">A.TypeDef</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">typeName :: TypeDef -&gt; Identifier
</span><a href="Front.Ast.html#typeName"><span class="hs-identifier hs-var">A.typeName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679491672"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491672"><span class="hs-identifier hs-var">tn</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-274"></span><span>  </span><span class="annot"><span class="annottext">Identifier -&gt; ScopeFn ()
</span><a href="Front.Scope.html#ensureCons"><span class="hs-identifier hs-var">ensureCons</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491672"><span class="hs-identifier hs-var">tn</span></a></span><span>
</span><span id="line-275"></span><span>  </span><span class="annot"><span class="annottext">(Identifier, TypInfo) -&gt; ScopeFn (Identifier, TypInfo)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491672"><span class="hs-identifier hs-var">tn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypInfo :: IdKind -&gt; TypInfo
</span><a href="Front.Identifiers.html#TypInfo"><span class="hs-identifier hs-type">TypInfo</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">typKind :: IdKind
</span><a href="Front.Identifiers.html#typKind"><span class="hs-identifier hs-var">typKind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IdKind
</span><a href="Front.Identifiers.html#User"><span class="hs-identifier hs-var">User</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span class="hs-comment">-- | Check the scoping of the data constructors of a type definition.</span><span>
</span><span id="line-279"></span><span class="annot"><a href="Front.Scope.html#scopeDCons"><span class="hs-identifier hs-type">scopeDCons</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Front.Ast.html#TypeDef"><span class="hs-identifier hs-type">A.TypeDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Common.Identifiers.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Front.Identifiers.html#DataInfo"><span class="hs-identifier hs-type">DataInfo</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-280"></span><span id="scopeDCons"><span class="annot"><span class="annottext">scopeDCons :: TypeDef -&gt; ScopeFn [(Identifier, DataInfo)]
</span><a href="Front.Scope.html#scopeDCons"><span class="hs-identifier hs-var hs-var">scopeDCons</span></a></span></span><span> </span><span class="annot"><a href="Front.Ast.html#TypeDef"><span class="hs-identifier hs-type">A.TypeDef</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">typeVariants :: TypeDef -&gt; [TypeVariant]
</span><a href="Front.Ast.html#typeVariants"><span class="hs-identifier hs-var">A.typeVariants</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679491670"><span class="annot"><span class="annottext">[TypeVariant]
</span><a href="#local-6989586621679491670"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">typeParams :: TypeDef -&gt; [Identifier]
</span><a href="Front.Ast.html#typeParams"><span class="hs-identifier hs-var">A.typeParams</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679491668"><span class="annot"><span class="annottext">[Identifier]
</span><a href="#local-6989586621679491668"><span class="hs-identifier hs-var">tps</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-281"></span><span>  </span><span class="annot"><span class="annottext">(Identifier -&gt; ScopeFn ()) -&gt; [Identifier] -&gt; ScopeFn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; ScopeFn ()
</span><a href="Front.Scope.html#ensureVar"><span class="hs-identifier hs-var">ensureVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Identifier]
</span><a href="#local-6989586621679491668"><span class="hs-identifier hs-var">tps</span></a></span><span>
</span><span id="line-282"></span><span>  </span><span class="annot"><span class="annottext">[Identifier] -&gt; ScopeFn ()
</span><a href="Front.Scope.html#ensureUnique"><span class="hs-identifier hs-var">ensureUnique</span></a></span><span> </span><span class="annot"><span class="annottext">[Identifier]
</span><a href="#local-6989586621679491668"><span class="hs-identifier hs-var">tps</span></a></span><span>
</span><span id="line-283"></span><span>  </span><span class="annot"><span class="annottext">[Identifier]
-&gt; ScopeFn [(Identifier, DataInfo)]
-&gt; ScopeFn [(Identifier, DataInfo)]
forall a. [Identifier] -&gt; ScopeFn a -&gt; ScopeFn a
</span><a href="Front.Scope.html#withExplicitScheme"><span class="hs-identifier hs-var">withExplicitScheme</span></a></span><span> </span><span class="annot"><span class="annottext">[Identifier]
</span><a href="#local-6989586621679491668"><span class="hs-identifier hs-var">tps</span></a></span><span> </span><span class="annot"><span class="annottext">(ScopeFn [(Identifier, DataInfo)]
 -&gt; ScopeFn [(Identifier, DataInfo)])
-&gt; ScopeFn [(Identifier, DataInfo)]
-&gt; ScopeFn [(Identifier, DataInfo)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-284"></span><span>    </span><span class="annot"><span class="annottext">(TypeVariant -&gt; ScopeFn (Identifier, DataInfo))
-&gt; [TypeVariant] -&gt; ScopeFn [(Identifier, DataInfo)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">TypeVariant -&gt; ScopeFn (Identifier, DataInfo)
</span><a href="Front.Scope.html#scopeDcon"><span class="hs-identifier hs-var">scopeDcon</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeVariant]
</span><a href="#local-6989586621679491670"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span class="hs-comment">-- | Check the scoping of the data constructor a single data variant.</span><span>
</span><span id="line-288"></span><span class="annot"><a href="Front.Scope.html#scopeDcon"><span class="hs-identifier hs-type">scopeDcon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Front.Ast.html#TypeVariant"><span class="hs-identifier hs-type">A.TypeVariant</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.Identifiers.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Front.Identifiers.html#DataInfo"><span class="hs-identifier hs-type">DataInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span id="scopeDcon"><span class="annot"><span class="annottext">scopeDcon :: TypeVariant -&gt; ScopeFn (Identifier, DataInfo)
</span><a href="Front.Scope.html#scopeDcon"><span class="hs-identifier hs-var hs-var">scopeDcon</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#VariantUnnamed"><span class="hs-identifier hs-type">A.VariantUnnamed</span></a></span><span> </span><span id="local-6989586621679491664"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491664"><span class="hs-identifier hs-var">dcon</span></a></span></span><span> </span><span id="local-6989586621679491663"><span class="annot"><span class="annottext">[Typ]
</span><a href="#local-6989586621679491663"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-290"></span><span>  </span><span class="annot"><span class="annottext">Identifier -&gt; ScopeFn ()
</span><a href="Front.Scope.html#ensureCons"><span class="hs-identifier hs-var">ensureCons</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491664"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-291"></span><span>  </span><span class="annot"><span class="annottext">(Typ -&gt; ScopeFn ()) -&gt; [Typ] -&gt; ScopeFn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Typ -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeType"><span class="hs-identifier hs-var">scopeType</span></a></span><span> </span><span class="annot"><span class="annottext">[Typ]
</span><a href="#local-6989586621679491663"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-292"></span><span>  </span><span class="annot"><span class="annottext">(Identifier, DataInfo) -&gt; ScopeFn (Identifier, DataInfo)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491664"><span class="hs-identifier hs-var">dcon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DataInfo :: IdKind -&gt; DataInfo
</span><a href="Front.Identifiers.html#DataInfo"><span class="hs-identifier hs-type">DataInfo</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dataKind :: IdKind
</span><a href="Front.Identifiers.html#dataKind"><span class="hs-identifier hs-var">dataKind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IdKind
</span><a href="Front.Identifiers.html#User"><span class="hs-identifier hs-var">User</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="annot"><a href="Front.Scope.html#scopeExterns"><span class="hs-identifier hs-type">scopeExterns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Front.Ast.html#ExternDecl"><span class="hs-identifier hs-type">A.ExternDecl</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span id="scopeExterns"><span class="annot"><span class="annottext">scopeExterns :: [ExternDecl] -&gt; ScopeFn () -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeExterns"><span class="hs-identifier hs-var hs-var">scopeExterns</span></a></span></span><span> </span><span id="local-6989586621679491660"><span class="annot"><span class="annottext">[ExternDecl]
</span><a href="#local-6989586621679491660"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621679491659"><span class="annot"><span class="annottext">ScopeFn ()
</span><a href="#local-6989586621679491659"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-297"></span><span>  </span><span class="annot"><span class="annottext">(Typ -&gt; ScopeFn ()) -&gt; [Typ] -&gt; ScopeFn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Typ -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeType"><span class="hs-identifier hs-var">scopeType</span></a></span><span> </span><span class="annot"><span class="annottext">[Typ]
</span><a href="#local-6989586621679491658"><span class="hs-identifier hs-var">xTypes</span></a></span><span>
</span><span id="line-298"></span><span>  </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)] -&gt; ScopeFn () -&gt; ScopeFn ()
forall a. [(Identifier, DataInfo)] -&gt; ScopeFn a -&gt; ScopeFn a
</span><a href="Front.Scope.html#withDataScope"><span class="hs-identifier hs-var">withDataScope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Identifier -&gt; (Identifier, DataInfo))
-&gt; [Identifier] -&gt; [(Identifier, DataInfo)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-special">,</span></span><span class="annot"><span class="annottext">DataInfo
forall a. Default a =&gt; a
</span><a href="Common.Default.html#def"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Identifier]
</span><a href="#local-6989586621679491656"><span class="hs-identifier hs-var">xIds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScopeFn ()
</span><a href="#local-6989586621679491659"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-299"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-300"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679491656"><span class="annot"><span class="annottext">[Identifier]
</span><a href="#local-6989586621679491656"><span class="hs-identifier hs-var">xIds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679491658"><span class="annot"><span class="annottext">[Typ]
</span><a href="#local-6989586621679491658"><span class="hs-identifier hs-var">xTypes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Identifier, Typ)] -&gt; ([Identifier], [Typ])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">([(Identifier, Typ)] -&gt; ([Identifier], [Typ]))
-&gt; [(Identifier, Typ)] -&gt; ([Identifier], [Typ])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ExternDecl -&gt; (Identifier, Typ))
-&gt; [ExternDecl] -&gt; [(Identifier, Typ)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#ExternDecl"><span class="hs-identifier hs-type">A.ExternDecl</span></a></span><span> </span><span id="local-6989586621679491653"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491653"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679491652"><span class="annot"><span class="annottext">Typ
</span><a href="#local-6989586621679491652"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491653"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Typ
</span><a href="#local-6989586621679491652"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ExternDecl]
</span><a href="#local-6989586621679491660"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span class="hs-comment">-- | Check the scoping of a set of parallel (co-recursive) 'A.Definition'.</span><span>
</span><span id="line-304"></span><span class="annot"><a href="Front.Scope.html#scopeDefs"><span class="hs-identifier hs-type">scopeDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Front.Ast.html#Definition"><span class="hs-identifier hs-type">A.Definition</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span id="scopeDefs"><span class="annot"><span class="annottext">scopeDefs :: [Definition] -&gt; ScopeFn () -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeDefs"><span class="hs-identifier hs-var hs-var">scopeDefs</span></a></span></span><span> </span><span id="local-6989586621679491651"><span class="annot"><span class="annottext">[Definition]
</span><a href="#local-6989586621679491651"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621679491650"><span class="annot"><span class="annottext">ScopeFn ()
</span><a href="#local-6989586621679491650"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-306"></span><span>  </span><span id="local-6989586621679491649"><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
</span><a href="#local-6989586621679491649"><span class="hs-identifier hs-var">corecs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[[(Identifier, DataInfo)]] -&gt; [(Identifier, DataInfo)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[(Identifier, DataInfo)]] -&gt; [(Identifier, DataInfo)])
-&gt; ScopeFn [[(Identifier, DataInfo)]]
-&gt; ScopeFn [(Identifier, DataInfo)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; ScopeFn [(Identifier, DataInfo)])
-&gt; [Definition] -&gt; ScopeFn [[(Identifier, DataInfo)]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; ScopeFn [(Identifier, DataInfo)]
</span><a href="#local-6989586621679491648"><span class="hs-identifier hs-var">scopeCorec</span></a></span><span> </span><span class="annot"><span class="annottext">[Definition]
</span><a href="#local-6989586621679491651"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-307"></span><span>  </span><span class="annot"><span class="annottext">[Identifier] -&gt; ScopeFn ()
</span><a href="Front.Scope.html#ensureUnique"><span class="hs-identifier hs-var">ensureUnique</span></a></span><span> </span><span class="annot"><span class="annottext">([Identifier] -&gt; ScopeFn ()) -&gt; [Identifier] -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Identifier, DataInfo) -&gt; Identifier)
-&gt; [(Identifier, DataInfo)] -&gt; [Identifier]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Identifier, DataInfo) -&gt; Identifier
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
</span><a href="#local-6989586621679491649"><span class="hs-identifier hs-var">corecs</span></a></span><span>
</span><span id="line-308"></span><span>  </span><span class="annot"><span class="annottext">(Definition -&gt; ScopeFn ()) -&gt; [Definition] -&gt; ScopeFn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Identifier, DataInfo)] -&gt; Definition -&gt; ScopeFn ()
</span><a href="#local-6989586621679491647"><span class="hs-identifier hs-var">scopeDef</span></a></span><span> </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
</span><a href="#local-6989586621679491649"><span class="hs-identifier hs-var">corecs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Definition]
</span><a href="#local-6989586621679491651"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-309"></span><span>  </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)] -&gt; ScopeFn () -&gt; ScopeFn ()
forall a. [(Identifier, DataInfo)] -&gt; ScopeFn a -&gt; ScopeFn a
</span><a href="Front.Scope.html#withDataScope"><span class="hs-identifier hs-var">withDataScope</span></a></span><span> </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
</span><a href="#local-6989586621679491649"><span class="hs-identifier hs-var">corecs</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeFn ()
</span><a href="#local-6989586621679491650"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-310"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-311"></span><span>  </span><span class="annot"><a href="#local-6989586621679491648"><span class="hs-identifier hs-type">scopeCorec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Front.Ast.html#Definition"><span class="hs-identifier hs-type">A.Definition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Common.Identifiers.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Front.Identifiers.html#DataInfo"><span class="hs-identifier hs-type">DataInfo</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-312"></span><span>  </span><span id="local-6989586621679491648"><span class="annot"><span class="annottext">scopeCorec :: Definition -&gt; ScopeFn [(Identifier, DataInfo)]
</span><a href="#local-6989586621679491648"><span class="hs-identifier hs-var hs-var">scopeCorec</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#DefFn"><span class="hs-identifier hs-type">A.DefFn</span></a></span><span> </span><span id="local-6989586621679491645"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491645"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679491644"><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621679491644"><span class="hs-identifier hs-var">_ps</span></a></span></span><span> </span><span id="local-6989586621679491643"><span class="annot"><span class="annottext">TypFn
</span><a href="#local-6989586621679491643"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679491642"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491642"><span class="hs-identifier hs-var">_e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-313"></span><span>    </span><span class="annot"><span class="annottext">TypFn -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeTypeFn"><span class="hs-identifier hs-var">scopeTypeFn</span></a></span><span> </span><span class="annot"><span class="annottext">TypFn
</span><a href="#local-6989586621679491643"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-314"></span><span>    </span><span class="annot"><span class="annottext">Identifier -&gt; ScopeFn ()
</span><a href="Front.Scope.html#ensureVar"><span class="hs-identifier hs-var">ensureVar</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491645"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-315"></span><span>    </span><span class="annot"><span class="annottext">Identifier -&gt; ScopeFn ()
</span><a href="Front.Scope.html#dataDecl"><span class="hs-identifier hs-var">dataDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491645"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-316"></span><span>    </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)] -&gt; ScopeFn [(Identifier, DataInfo)]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491645"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DataInfo
forall a. Default a =&gt; a
</span><a href="Common.Default.html#def"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-317"></span><span>  </span><span class="annot"><a href="#local-6989586621679491648"><span class="hs-identifier hs-var">scopeCorec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#DefPat"><span class="hs-identifier hs-type">A.DefPat</span></a></span><span> </span><span id="local-6989586621679491639"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621679491639"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-318"></span><span>    </span><span id="local-6989586621679491638"><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
</span><a href="#local-6989586621679491638"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pat -&gt; ScopeFn [(Identifier, DataInfo)]
</span><a href="Front.Scope.html#scopePat"><span class="hs-identifier hs-var">scopePat</span></a></span><span> </span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621679491639"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-319"></span><span>    </span><span class="hs-comment">-- Not strictly necessary here, but gives a more precise error message.</span><span>
</span><span id="line-320"></span><span>    </span><span class="annot"><span class="annottext">[Identifier] -&gt; ScopeFn ()
</span><a href="Front.Scope.html#ensureUnique"><span class="hs-identifier hs-var">ensureUnique</span></a></span><span> </span><span class="annot"><span class="annottext">([Identifier] -&gt; ScopeFn ()) -&gt; [Identifier] -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Identifier, DataInfo) -&gt; Identifier)
-&gt; [(Identifier, DataInfo)] -&gt; [Identifier]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Identifier, DataInfo) -&gt; Identifier
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
</span><a href="#local-6989586621679491638"><span class="hs-identifier hs-var">ids</span></a></span><span>
</span><span id="line-321"></span><span>    </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)] -&gt; ScopeFn [(Identifier, DataInfo)]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
</span><a href="#local-6989586621679491638"><span class="hs-identifier hs-var">ids</span></a></span><span>
</span><span id="line-322"></span><span>  </span><span class="annot"><a href="#local-6989586621679491647"><span class="hs-identifier hs-type">scopeDef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Common.Identifiers.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Front.Identifiers.html#DataInfo"><span class="hs-identifier hs-type">DataInfo</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Ast.html#Definition"><span class="hs-identifier hs-type">A.Definition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>  </span><span id="local-6989586621679491647"><span class="annot"><span class="annottext">scopeDef :: [(Identifier, DataInfo)] -&gt; Definition -&gt; ScopeFn ()
</span><a href="#local-6989586621679491647"><span class="hs-identifier hs-var hs-var">scopeDef</span></a></span></span><span> </span><span id="local-6989586621679491636"><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
</span><a href="#local-6989586621679491636"><span class="hs-identifier hs-var">corecs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#DefFn"><span class="hs-identifier hs-type">A.DefFn</span></a></span><span> </span><span id="local-6989586621679491635"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491635"><span class="hs-identifier hs-var">_f</span></a></span></span><span> </span><span id="local-6989586621679491634"><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621679491634"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621679491633"><span class="annot"><span class="annottext">TypFn
</span><a href="#local-6989586621679491633"><span class="hs-identifier hs-var">_t</span></a></span></span><span> </span><span id="local-6989586621679491632"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491632"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-324"></span><span>    </span><span class="hs-comment">-- NOTE: corecs should already contain _f</span><span>
</span><span id="line-325"></span><span>    </span><span id="local-6989586621679491631"><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
</span><a href="#local-6989586621679491631"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
</span><a href="#local-6989586621679491636"><span class="hs-identifier hs-var">corecs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
-&gt; [(Identifier, DataInfo)] -&gt; [(Identifier, DataInfo)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Identifier, DataInfo)] -&gt; [(Identifier, DataInfo)])
-&gt; ([[(Identifier, DataInfo)]] -&gt; [(Identifier, DataInfo)])
-&gt; [[(Identifier, DataInfo)]]
-&gt; [(Identifier, DataInfo)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[[(Identifier, DataInfo)]] -&gt; [(Identifier, DataInfo)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[(Identifier, DataInfo)]] -&gt; [(Identifier, DataInfo)])
-&gt; ScopeFn [[(Identifier, DataInfo)]]
-&gt; ScopeFn [(Identifier, DataInfo)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Pat -&gt; ScopeFn [(Identifier, DataInfo)])
-&gt; [Pat] -&gt; ScopeFn [[(Identifier, DataInfo)]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; ScopeFn [(Identifier, DataInfo)]
</span><a href="Front.Scope.html#scopePat"><span class="hs-identifier hs-var">scopePat</span></a></span><span> </span><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621679491634"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-326"></span><span>    </span><span class="annot"><span class="annottext">[Identifier] -&gt; ScopeFn ()
</span><a href="Front.Scope.html#ensureUnique"><span class="hs-identifier hs-var">ensureUnique</span></a></span><span> </span><span class="annot"><span class="annottext">([Identifier] -&gt; ScopeFn ()) -&gt; [Identifier] -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Identifier, DataInfo) -&gt; Identifier)
-&gt; [(Identifier, DataInfo)] -&gt; [Identifier]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Identifier, DataInfo) -&gt; Identifier
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
</span><a href="#local-6989586621679491631"><span class="hs-identifier hs-var">ids</span></a></span><span>
</span><span id="line-327"></span><span>    </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)] -&gt; ScopeFn () -&gt; ScopeFn ()
forall a. [(Identifier, DataInfo)] -&gt; ScopeFn a -&gt; ScopeFn a
</span><a href="Front.Scope.html#withDataScope"><span class="hs-identifier hs-var">withDataScope</span></a></span><span> </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
</span><a href="#local-6989586621679491631"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">(ScopeFn () -&gt; ScopeFn ()) -&gt; ScopeFn () -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491632"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-328"></span><span>  </span><span class="annot"><a href="#local-6989586621679491647"><span class="hs-identifier hs-var">scopeDef</span></a></span><span> </span><span id="local-6989586621679491629"><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
</span><a href="#local-6989586621679491629"><span class="hs-identifier hs-var">corecs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#DefPat"><span class="hs-identifier hs-type">A.DefPat</span></a></span><span> </span><span id="local-6989586621679491628"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621679491628"><span class="hs-identifier hs-var">_p</span></a></span></span><span> </span><span id="local-6989586621679491627"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491627"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-329"></span><span>    </span><span class="hs-comment">-- NOTE: corecs should already contain _p's identifiers</span><span>
</span><span id="line-330"></span><span>    </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)] -&gt; ScopeFn () -&gt; ScopeFn ()
forall a. [(Identifier, DataInfo)] -&gt; ScopeFn a -&gt; ScopeFn a
</span><a href="Front.Scope.html#withDataScope"><span class="hs-identifier hs-var">withDataScope</span></a></span><span> </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
</span><a href="#local-6989586621679491629"><span class="hs-identifier hs-var">corecs</span></a></span><span> </span><span class="annot"><span class="annottext">(ScopeFn () -&gt; ScopeFn ()) -&gt; ScopeFn () -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491627"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span class="hs-comment">-- | Check the scoping of an 'A.Expr'.</span><span>
</span><span id="line-334"></span><span class="annot"><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-type">scopeExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Front.Ast.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-335"></span><span id="scopeExpr"><span class="annot"><span class="annottext">scopeExpr :: Expr -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var hs-var">scopeExpr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#Id"><span class="hs-identifier hs-type">A.Id</span></a></span><span> </span><span id="local-6989586621679491625"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491625"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; ScopeFn ()
</span><a href="Front.Scope.html#dataRef"><span class="hs-identifier hs-var">dataRef</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491625"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-336"></span><span class="annot"><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#Match"><span class="hs-identifier hs-type">A.Match</span></a></span><span> </span><span id="local-6989586621679491623"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491623"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679491622"><span class="annot"><span class="annottext">[(Pat, Expr)]
</span><a href="#local-6989586621679491622"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-337"></span><span>  </span><span class="annot"><span class="annottext">Expr -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491623"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-338"></span><span>  </span><span class="annot"><span class="annottext">[(Pat, Expr)] -&gt; ((Pat, Expr) -&gt; ScopeFn ()) -&gt; ScopeFn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="annot"><span class="annottext">[(Pat, Expr)]
</span><a href="#local-6989586621679491622"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="annot"><span class="annottext">(((Pat, Expr) -&gt; ScopeFn ()) -&gt; ScopeFn ())
-&gt; ((Pat, Expr) -&gt; ScopeFn ()) -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679491621"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621679491621"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679491620"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491620"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-339"></span><span>    </span><span id="local-6989586621679491619"><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
</span><a href="#local-6989586621679491619"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pat -&gt; ScopeFn [(Identifier, DataInfo)]
</span><a href="Front.Scope.html#scopePat"><span class="hs-identifier hs-var">scopePat</span></a></span><span> </span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621679491621"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-340"></span><span>    </span><span class="annot"><span class="annottext">[Identifier] -&gt; ScopeFn ()
</span><a href="Front.Scope.html#ensureUnique"><span class="hs-identifier hs-var">ensureUnique</span></a></span><span> </span><span class="annot"><span class="annottext">([Identifier] -&gt; ScopeFn ()) -&gt; [Identifier] -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Identifier, DataInfo) -&gt; Identifier)
-&gt; [(Identifier, DataInfo)] -&gt; [Identifier]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Identifier, DataInfo) -&gt; Identifier
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
</span><a href="#local-6989586621679491619"><span class="hs-identifier hs-var">ids</span></a></span><span>
</span><span id="line-341"></span><span>    </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)] -&gt; ScopeFn () -&gt; ScopeFn ()
forall a. [(Identifier, DataInfo)] -&gt; ScopeFn a -&gt; ScopeFn a
</span><a href="Front.Scope.html#withDataScope"><span class="hs-identifier hs-var">withDataScope</span></a></span><span> </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
</span><a href="#local-6989586621679491619"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">(ScopeFn () -&gt; ScopeFn ()) -&gt; ScopeFn () -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491620"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-342"></span><span class="annot"><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#Lambda"><span class="hs-identifier hs-type">A.Lambda</span></a></span><span> </span><span id="local-6989586621679491617"><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621679491617"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span id="local-6989586621679491616"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491616"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-343"></span><span>  </span><span id="local-6989586621679491615"><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
</span><a href="#local-6989586621679491615"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[[(Identifier, DataInfo)]] -&gt; [(Identifier, DataInfo)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[(Identifier, DataInfo)]] -&gt; [(Identifier, DataInfo)])
-&gt; ScopeFn [[(Identifier, DataInfo)]]
-&gt; ScopeFn [(Identifier, DataInfo)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Pat -&gt; ScopeFn [(Identifier, DataInfo)])
-&gt; [Pat] -&gt; ScopeFn [[(Identifier, DataInfo)]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; ScopeFn [(Identifier, DataInfo)]
</span><a href="Front.Scope.html#scopePat"><span class="hs-identifier hs-var">scopePat</span></a></span><span> </span><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621679491617"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-344"></span><span>  </span><span class="annot"><span class="annottext">[Identifier] -&gt; ScopeFn ()
</span><a href="Front.Scope.html#ensureUnique"><span class="hs-identifier hs-var">ensureUnique</span></a></span><span> </span><span class="annot"><span class="annottext">([Identifier] -&gt; ScopeFn ()) -&gt; [Identifier] -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Identifier, DataInfo) -&gt; Identifier)
-&gt; [(Identifier, DataInfo)] -&gt; [Identifier]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Identifier, DataInfo) -&gt; Identifier
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
</span><a href="#local-6989586621679491615"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-345"></span><span>  </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)] -&gt; ScopeFn () -&gt; ScopeFn ()
forall a. [(Identifier, DataInfo)] -&gt; ScopeFn a -&gt; ScopeFn a
</span><a href="Front.Scope.html#withDataScope"><span class="hs-identifier hs-var">withDataScope</span></a></span><span> </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
</span><a href="#local-6989586621679491615"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">(ScopeFn () -&gt; ScopeFn ()) -&gt; ScopeFn () -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491616"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-346"></span><span class="annot"><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#Let"><span class="hs-identifier hs-type">A.Let</span></a></span><span> </span><span id="local-6989586621679491613"><span class="annot"><span class="annottext">[Definition]
</span><a href="#local-6989586621679491613"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621679491612"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491612"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Definition] -&gt; ScopeFn () -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeDefs"><span class="hs-identifier hs-var">scopeDefs</span></a></span><span> </span><span class="annot"><span class="annottext">[Definition]
</span><a href="#local-6989586621679491613"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">(ScopeFn () -&gt; ScopeFn ()) -&gt; ScopeFn () -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491612"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-347"></span><span class="annot"><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#Constraint"><span class="hs-identifier hs-type">A.Constraint</span></a></span><span> </span><span id="local-6989586621679491610"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491610"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679491609"><span class="annot"><span class="annottext">Typ
</span><a href="#local-6989586621679491609"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Typ -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeType"><span class="hs-identifier hs-var">scopeType</span></a></span><span> </span><span class="annot"><span class="annottext">Typ
</span><a href="#local-6989586621679491609"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeFn () -&gt; ScopeFn () -&gt; ScopeFn ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491610"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-348"></span><span class="annot"><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#Apply"><span class="hs-identifier hs-type">A.Apply</span></a></span><span> </span><span id="local-6989586621679491607"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491607"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679491606"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491606"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491607"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeFn () -&gt; ScopeFn () -&gt; ScopeFn ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491606"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-349"></span><span class="annot"><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#While"><span class="hs-identifier hs-type">A.While</span></a></span><span> </span><span id="local-6989586621679491604"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491604"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679491603"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491603"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491604"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeFn () -&gt; ScopeFn () -&gt; ScopeFn ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491603"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-350"></span><span class="annot"><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#Loop"><span class="hs-identifier hs-type">A.Loop</span></a></span><span> </span><span id="local-6989586621679491601"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491601"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491601"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-351"></span><span class="annot"><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#Par"><span class="hs-identifier hs-type">A.Par</span></a></span><span> </span><span id="local-6989586621679491599"><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679491599"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; ScopeFn ()) -&gt; [Expr] -&gt; ScopeFn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679491599"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-352"></span><span class="annot"><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#IfElse"><span class="hs-identifier hs-type">A.IfElse</span></a></span><span> </span><span id="local-6989586621679491597"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491597"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679491596"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491596"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679491595"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491595"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; ScopeFn ()) -&gt; [Expr] -&gt; ScopeFn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491597"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491596"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491595"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-353"></span><span class="annot"><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#After"><span class="hs-identifier hs-type">A.After</span></a></span><span> </span><span id="local-6989586621679491593"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491593"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621679491592"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491592"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679491591"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491591"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; ScopeFn ()) -&gt; [Expr] -&gt; ScopeFn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491593"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491592"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491591"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-354"></span><span class="annot"><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#Assign"><span class="hs-identifier hs-type">A.Assign</span></a></span><span> </span><span id="local-6989586621679491589"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491589"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679491588"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491588"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; ScopeFn ()) -&gt; [Expr] -&gt; ScopeFn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491589"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491588"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-355"></span><span class="annot"><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#Wait"><span class="hs-identifier hs-type">A.Wait</span></a></span><span> </span><span id="local-6989586621679491586"><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679491586"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; ScopeFn ()) -&gt; [Expr] -&gt; ScopeFn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679491586"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-356"></span><span class="annot"><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#Seq"><span class="hs-identifier hs-type">A.Seq</span></a></span><span> </span><span id="local-6989586621679491584"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491584"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679491583"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491583"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; ScopeFn ()) -&gt; [Expr] -&gt; ScopeFn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491584"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491583"><span class="hs-identifier hs-var">e'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-357"></span><span class="annot"><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#Lit"><span class="hs-identifier hs-type">A.Lit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; ScopeFn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span class="annot"><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#ListExpr"><span class="hs-identifier hs-type">A.ListExpr</span></a></span><span> </span><span id="local-6989586621679491580"><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679491580"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; ScopeFn ()) -&gt; [Expr] -&gt; ScopeFn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679491580"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-359"></span><span class="annot"><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="Front.Ast.html#Break"><span class="hs-identifier hs-var">A.Break</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; ScopeFn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span class="annot"><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#Tuple"><span class="hs-identifier hs-type">A.Tuple</span></a></span><span> </span><span id="local-6989586621679491577"><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679491577"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; ScopeFn ()) -&gt; [Expr] -&gt; ScopeFn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679491577"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-361"></span><span class="annot"><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#OpRegion"><span class="hs-identifier hs-type">A.OpRegion</span></a></span><span> </span><span id="local-6989586621679491575"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491575"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679491574"><span class="annot"><span class="annottext">OpRegion
</span><a href="#local-6989586621679491574"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-362"></span><span>  </span><span class="annot"><span class="annottext">Error -&gt; ScopeFn ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(Error -&gt; ScopeFn ()) -&gt; Error -&gt; ScopeFn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-363"></span><span>    </span><span class="annot"><span class="annottext">ErrorMsg -&gt; Error
</span><a href="Common.Compiler.html#UnexpectedError"><span class="hs-identifier hs-var">UnexpectedError</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorMsg -&gt; Error) -&gt; ErrorMsg -&gt; Error
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-364"></span><span>      </span><span class="annot"><span class="annottext">ErrorMsg
</span><span class="hs-string">&quot;OpRegion should not be reachable: &quot;</span></span><span>
</span><span id="line-365"></span><span>        </span><span class="annot"><span class="annottext">ErrorMsg -&gt; ErrorMsg -&gt; ErrorMsg
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ErrorMsg
forall a. IsString a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491575"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>        </span><span class="annot"><span class="annottext">ErrorMsg -&gt; ErrorMsg -&gt; ErrorMsg
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-367"></span><span>        </span><span class="annot"><span class="annottext">ErrorMsg -&gt; ErrorMsg -&gt; ErrorMsg
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ErrorMsg
forall a. IsString a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OpRegion -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">OpRegion
</span><a href="#local-6989586621679491574"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span class="annot"><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#CQuote"><span class="hs-identifier hs-type">A.CQuote</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; ScopeFn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span class="annot"><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#CCall"><span class="hs-identifier hs-type">A.CCall</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679491570"><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679491570"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; ScopeFn ()) -&gt; [Expr] -&gt; ScopeFn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679491570"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-370"></span><span class="annot"><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#Last"><span class="hs-identifier hs-type">A.Last</span></a></span><span> </span><span id="local-6989586621679491568"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491568"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679491568"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-371"></span><span class="annot"><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="Front.Ast.html#Now"><span class="hs-identifier hs-var">A.Now</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; ScopeFn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span class="annot"><a href="Front.Scope.html#scopeExpr"><span class="hs-identifier hs-var">scopeExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="Front.Ast.html#NoExpr"><span class="hs-identifier hs-var">A.NoExpr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; ScopeFn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span class="hs-comment">{- | Check 'A.Pat' and retrieve variable identifiers defined therein.

Not responsible for ensuring data identifiers are in scope, though it will call
'scopeType' to check type identifiers.
-}</span><span>
</span><span id="line-380"></span><span class="annot"><a href="Front.Scope.html#scopePat"><span class="hs-identifier hs-type">scopePat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Front.Ast.html#Pat"><span class="hs-identifier hs-type">A.Pat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Common.Identifiers.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Front.Identifiers.html#DataInfo"><span class="hs-identifier hs-type">DataInfo</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-381"></span><span id="scopePat"><span class="annot"><span class="annottext">scopePat :: Pat -&gt; ScopeFn [(Identifier, DataInfo)]
</span><a href="Front.Scope.html#scopePat"><span class="hs-identifier hs-var hs-var">scopePat</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#PatId"><span class="hs-identifier hs-type">A.PatId</span></a></span><span> </span><span id="local-6989586621679491564"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491564"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-comment">-- NOTE: here, i may be either a data constructor or a variable name.</span><span>
</span><span id="line-383"></span><span>  </span><span class="annot"><span class="annottext">Identifier -&gt; ScopeFn ()
</span><a href="Front.Scope.html#dataDecl"><span class="hs-identifier hs-var">dataDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491564"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-384"></span><span>  </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)] -&gt; ScopeFn [(Identifier, DataInfo)]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([(Identifier, DataInfo)] -&gt; ScopeFn [(Identifier, DataInfo)])
-&gt; [(Identifier, DataInfo)] -&gt; ScopeFn [(Identifier, DataInfo)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491564"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DataInfo
forall a. Default a =&gt; a
</span><a href="Common.Default.html#def"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Bool
forall a. Identifiable a =&gt; a -&gt; Bool
</span><a href="Common.Identifiers.html#isVar"><span class="hs-identifier hs-var">isVar</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491564"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-385"></span><span class="annot"><a href="Front.Scope.html#scopePat"><span class="hs-identifier hs-var">scopePat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#PatAs"><span class="hs-identifier hs-type">A.PatAs</span></a></span><span> </span><span id="local-6989586621679491562"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491562"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679491561"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621679491561"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-386"></span><span>  </span><span class="hs-comment">-- When we have v@p, v should always be a variable identifier.</span><span>
</span><span id="line-387"></span><span>  </span><span class="annot"><span class="annottext">Identifier -&gt; ScopeFn ()
</span><a href="Front.Scope.html#ensureVar"><span class="hs-identifier hs-var">ensureVar</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491562"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-388"></span><span>  </span><span class="annot"><span class="annottext">Identifier -&gt; ScopeFn ()
</span><a href="Front.Scope.html#dataDecl"><span class="hs-identifier hs-var">dataDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491562"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-389"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491562"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DataInfo
forall a. Default a =&gt; a
</span><a href="Common.Default.html#def"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Bool
forall a. Identifiable a =&gt; a -&gt; Bool
</span><a href="Common.Identifiers.html#isVar"><span class="hs-identifier hs-var">isVar</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491562"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)]
-&gt; [(Identifier, DataInfo)] -&gt; [(Identifier, DataInfo)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Identifier, DataInfo)] -&gt; [(Identifier, DataInfo)])
-&gt; ScopeFn [(Identifier, DataInfo)]
-&gt; ScopeFn [(Identifier, DataInfo)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; ScopeFn [(Identifier, DataInfo)]
</span><a href="Front.Scope.html#scopePat"><span class="hs-identifier hs-var">scopePat</span></a></span><span> </span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621679491561"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-390"></span><span class="annot"><a href="Front.Scope.html#scopePat"><span class="hs-identifier hs-var">scopePat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#PatTup"><span class="hs-identifier hs-type">A.PatTup</span></a></span><span> </span><span id="local-6989586621679491559"><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621679491559"><span class="hs-identifier hs-var">pats</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621679491559"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-392"></span><span>    </span><span class="annot"><span class="annottext">Error -&gt; ScopeFn [(Identifier, DataInfo)]
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(Error -&gt; ScopeFn [(Identifier, DataInfo)])
-&gt; Error -&gt; ScopeFn [(Identifier, DataInfo)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-393"></span><span>      </span><span class="annot"><span class="annottext">ErrorMsg -&gt; Error
</span><a href="Common.Compiler.html#UnexpectedError"><span class="hs-identifier hs-var">UnexpectedError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorMsg
</span><span class="hs-string">&quot;PatTup should have arity greater than 2&quot;</span></span><span>
</span><span id="line-394"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(Identifier, DataInfo)]] -&gt; [(Identifier, DataInfo)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[(Identifier, DataInfo)]] -&gt; [(Identifier, DataInfo)])
-&gt; ScopeFn [[(Identifier, DataInfo)]]
-&gt; ScopeFn [(Identifier, DataInfo)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Pat -&gt; ScopeFn [(Identifier, DataInfo)])
-&gt; [Pat] -&gt; ScopeFn [[(Identifier, DataInfo)]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; ScopeFn [(Identifier, DataInfo)]
</span><a href="Front.Scope.html#scopePat"><span class="hs-identifier hs-var">scopePat</span></a></span><span> </span><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621679491559"><span class="hs-identifier hs-var">pats</span></a></span><span>
</span><span id="line-395"></span><span class="annot"><a href="Front.Scope.html#scopePat"><span class="hs-identifier hs-var">scopePat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#PatApp"><span class="hs-identifier hs-type">A.PatApp</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-396"></span><span>  </span><span class="annot"><span class="annottext">Error -&gt; ScopeFn [(Identifier, DataInfo)]
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(Error -&gt; ScopeFn [(Identifier, DataInfo)])
-&gt; Error -&gt; ScopeFn [(Identifier, DataInfo)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; Error
</span><a href="Common.Compiler.html#UnexpectedError"><span class="hs-identifier hs-var">UnexpectedError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorMsg
</span><span class="hs-string">&quot;PatApp should not be empty&quot;</span></span><span>
</span><span id="line-397"></span><span class="annot"><a href="Front.Scope.html#scopePat"><span class="hs-identifier hs-var">scopePat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#PatApp"><span class="hs-identifier hs-type">A.PatApp</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Pat
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-398"></span><span>  </span><span class="annot"><span class="annottext">Error -&gt; ScopeFn [(Identifier, DataInfo)]
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(Error -&gt; ScopeFn [(Identifier, DataInfo)])
-&gt; Error -&gt; ScopeFn [(Identifier, DataInfo)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; Error
</span><a href="Common.Compiler.html#UnexpectedError"><span class="hs-identifier hs-var">UnexpectedError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorMsg
</span><span class="hs-string">&quot;PatApp should not be singleton&quot;</span></span><span>
</span><span id="line-399"></span><span class="annot"><a href="Front.Scope.html#scopePat"><span class="hs-identifier hs-var">scopePat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#PatApp"><span class="hs-identifier hs-type">A.PatApp</span></a></span><span> </span><span id="local-6989586621679491555"><span class="annot"><span class="annottext">pats :: [Pat]
</span><a href="#local-6989586621679491555"><span class="hs-identifier hs-var">pats</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#PatId"><span class="hs-identifier hs-type">A.PatId</span></a></span><span> </span><span id="local-6989586621679491554"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491554"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Pat]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-400"></span><span>  </span><span class="annot"><span class="annottext">Identifier -&gt; ScopeFn ()
</span><a href="Front.Scope.html#ensureCons"><span class="hs-identifier hs-var">ensureCons</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491554"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-401"></span><span>  </span><span class="annot"><span class="annottext">[[(Identifier, DataInfo)]] -&gt; [(Identifier, DataInfo)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[(Identifier, DataInfo)]] -&gt; [(Identifier, DataInfo)])
-&gt; ScopeFn [[(Identifier, DataInfo)]]
-&gt; ScopeFn [(Identifier, DataInfo)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Pat -&gt; ScopeFn [(Identifier, DataInfo)])
-&gt; [Pat] -&gt; ScopeFn [[(Identifier, DataInfo)]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; ScopeFn [(Identifier, DataInfo)]
</span><a href="Front.Scope.html#scopePat"><span class="hs-identifier hs-var">scopePat</span></a></span><span> </span><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621679491555"><span class="hs-identifier hs-var">pats</span></a></span><span>
</span><span id="line-402"></span><span class="annot"><a href="Front.Scope.html#scopePat"><span class="hs-identifier hs-var">scopePat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#PatApp"><span class="hs-identifier hs-type">A.PatApp</span></a></span><span> </span><span class="annot"><span class="annottext">[Pat]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-403"></span><span>  </span><span class="hs-comment">-- We encountered something like @let f ((x y) z) = ...@</span><span>
</span><span id="line-404"></span><span>  </span><span class="annot"><span class="annottext">Error -&gt; ScopeFn [(Identifier, DataInfo)]
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(Error -&gt; ScopeFn [(Identifier, DataInfo)])
-&gt; Error -&gt; ScopeFn [(Identifier, DataInfo)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-405"></span><span>    </span><span class="annot"><span class="annottext">ErrorMsg -&gt; Error
</span><a href="Common.Compiler.html#PatternError"><span class="hs-identifier hs-var">PatternError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorMsg
</span><span class="hs-string">&quot;Head of destructuring pattern must be a data constructor&quot;</span></span><span>
</span><span id="line-406"></span><span class="annot"><a href="Front.Scope.html#scopePat"><span class="hs-identifier hs-var">scopePat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#PatAnn"><span class="hs-identifier hs-type">A.PatAnn</span></a></span><span> </span><span id="local-6989586621679491551"><span class="annot"><span class="annottext">Typ
</span><a href="#local-6989586621679491551"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span id="local-6989586621679491550"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621679491550"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Typ -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeType"><span class="hs-identifier hs-var">scopeType</span></a></span><span> </span><span class="annot"><span class="annottext">Typ
</span><a href="#local-6989586621679491551"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeFn ()
-&gt; ScopeFn [(Identifier, DataInfo)]
-&gt; ScopeFn [(Identifier, DataInfo)]
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; ScopeFn [(Identifier, DataInfo)]
</span><a href="Front.Scope.html#scopePat"><span class="hs-identifier hs-var">scopePat</span></a></span><span> </span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621679491550"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-407"></span><span class="annot"><a href="Front.Scope.html#scopePat"><span class="hs-identifier hs-var">scopePat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#PatLit"><span class="hs-identifier hs-type">A.PatLit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)] -&gt; ScopeFn [(Identifier, DataInfo)]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-408"></span><span class="annot"><a href="Front.Scope.html#scopePat"><span class="hs-identifier hs-var">scopePat</span></a></span><span> </span><span class="annot"><span class="annottext">Pat
</span><a href="Front.Ast.html#PatWildcard"><span class="hs-identifier hs-var">A.PatWildcard</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Identifier, DataInfo)] -&gt; ScopeFn [(Identifier, DataInfo)]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span class="hs-comment">-- | Check scoping for a 'A.TypFn' annotation.</span><span>
</span><span id="line-412"></span><span class="annot"><a href="Front.Scope.html#scopeTypeFn"><span class="hs-identifier hs-type">scopeTypeFn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Front.Ast.html#TypFn"><span class="hs-identifier hs-type">A.TypFn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-413"></span><span id="scopeTypeFn"><span class="annot"><span class="annottext">scopeTypeFn :: TypFn -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeTypeFn"><span class="hs-identifier hs-var hs-var">scopeTypeFn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#TypReturn"><span class="hs-identifier hs-type">A.TypReturn</span></a></span><span> </span><span id="local-6989586621679491546"><span class="annot"><span class="annottext">Typ
</span><a href="#local-6989586621679491546"><span class="hs-identifier hs-var">typ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Typ -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeType"><span class="hs-identifier hs-var">scopeType</span></a></span><span> </span><span class="annot"><span class="annottext">Typ
</span><a href="#local-6989586621679491546"><span class="hs-identifier hs-var">typ</span></a></span><span>
</span><span id="line-414"></span><span class="annot"><a href="Front.Scope.html#scopeTypeFn"><span class="hs-identifier hs-var">scopeTypeFn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#TypProper"><span class="hs-identifier hs-type">A.TypProper</span></a></span><span> </span><span id="local-6989586621679491544"><span class="annot"><span class="annottext">Typ
</span><a href="#local-6989586621679491544"><span class="hs-identifier hs-var">typ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Typ -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeType"><span class="hs-identifier hs-var">scopeType</span></a></span><span> </span><span class="annot"><span class="annottext">Typ
</span><a href="#local-6989586621679491544"><span class="hs-identifier hs-var">typ</span></a></span><span>
</span><span id="line-415"></span><span class="annot"><a href="Front.Scope.html#scopeTypeFn"><span class="hs-identifier hs-var">scopeTypeFn</span></a></span><span> </span><span class="annot"><span class="annottext">TypFn
</span><a href="Front.Ast.html#TypNone"><span class="hs-identifier hs-var">A.TypNone</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; ScopeFn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-416"></span><span>
</span><span id="line-417"></span><span>
</span><span id="line-418"></span><span class="hs-comment">-- | Check scoping for a 'A.Typ' annotation.</span><span>
</span><span id="line-419"></span><span class="annot"><a href="Front.Scope.html#scopeType"><span class="hs-identifier hs-type">scopeType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Front.Ast.html#Typ"><span class="hs-identifier hs-type">A.Typ</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Front.Scope.html#ScopeFn"><span class="hs-identifier hs-type">ScopeFn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-420"></span><span id="scopeType"><span class="annot"><span class="annottext">scopeType :: Typ -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeType"><span class="hs-identifier hs-var hs-var">scopeType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#TCon"><span class="hs-identifier hs-type">A.TCon</span></a></span><span> </span><span id="local-6989586621679491541"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491541"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; ScopeFn ()
</span><a href="Front.Scope.html#typeRef"><span class="hs-identifier hs-var">typeRef</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679491541"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-421"></span><span class="annot"><a href="Front.Scope.html#scopeType"><span class="hs-identifier hs-var">scopeType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#TApp"><span class="hs-identifier hs-type">A.TApp</span></a></span><span> </span><span id="local-6989586621679491539"><span class="annot"><span class="annottext">Typ
</span><a href="#local-6989586621679491539"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679491538"><span class="annot"><span class="annottext">Typ
</span><a href="#local-6989586621679491538"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Typ -&gt; ScopeFn ()) -&gt; [Typ] -&gt; ScopeFn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Typ -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeType"><span class="hs-identifier hs-var">scopeType</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Typ
</span><a href="#local-6989586621679491539"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Typ
</span><a href="#local-6989586621679491538"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-422"></span><span class="annot"><a href="Front.Scope.html#scopeType"><span class="hs-identifier hs-var">scopeType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#TTuple"><span class="hs-identifier hs-type">A.TTuple</span></a></span><span> </span><span id="local-6989586621679491536"><span class="annot"><span class="annottext">[Typ]
</span><a href="#local-6989586621679491536"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Typ -&gt; ScopeFn ()) -&gt; [Typ] -&gt; ScopeFn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Typ -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeType"><span class="hs-identifier hs-var">scopeType</span></a></span><span> </span><span class="annot"><span class="annottext">[Typ]
</span><a href="#local-6989586621679491536"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-423"></span><span class="annot"><a href="Front.Scope.html#scopeType"><span class="hs-identifier hs-var">scopeType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Front.Ast.html#TArrow"><span class="hs-identifier hs-type">A.TArrow</span></a></span><span> </span><span id="local-6989586621679491534"><span class="annot"><span class="annottext">Typ
</span><a href="#local-6989586621679491534"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679491533"><span class="annot"><span class="annottext">Typ
</span><a href="#local-6989586621679491533"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Typ -&gt; ScopeFn ()) -&gt; [Typ] -&gt; ScopeFn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Typ -&gt; ScopeFn ()
</span><a href="Front.Scope.html#scopeType"><span class="hs-identifier hs-var">scopeType</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Typ
</span><a href="#local-6989586621679491534"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Typ
</span><a href="#local-6989586621679491533"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-424"></span></pre></body></html>