<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>IR.InsertRefCounting</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">sslang-0.1.0.0</span><ul class="links" id="page-menu"><li><a href="src/IR.InsertRefCounting.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">IR.InsertRefCounting</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This inserts <code>dup</code> and <code>drop</code> primitives according to a caller <code>dup</code>,
callee <code>drop</code> policy.  The value returned by a function should be
passed back referenced (ownership transfers from the callee back to
the caller).</p><p>The <code>dup : a -&gt; a</code> primitive behaves like the identity function,
evaluating and returning its first argument and increasing the
reference count on the result.  It is meant to be wrapped around
function arguments.</p><p>The <code>drop : a -&gt; b -&gt; a</code> primitive evaluates and returns its first
argument.  It decrements the reference count to its second argument
after it has evaluated its first argument.  It is meant to be wrapped
around function bodies that need to use and then de-reference their
arguments.</p><p>Thus, something like</p><pre>add a b = a + b</pre><p>becomes</p><pre>add a b =
  drop
    (drop
       ((dup a) + (dup b))
       b)
    a
</pre><p>Arguments <code>a</code> and <code>b</code> to the <code>+</code> primitive are duplicated and the
result of <code>+</code> is duplicated internally, so <code>add</code> does not need to
duplicate its result.  Both arguments <code>a</code> and <code>b</code> are dropped.</p><p>Try running <code>sslc --dump-ir-final</code> on an example to see the inserted
<code>dup</code> and <code>drop</code> constructs.</p><p>Our approach was inspired by Perceus
<a href="https://www.microsoft.com/en-us/research/publication/perceus-garbage-free-reference-counting-with-reuse/">https://www.microsoft.com/en-us/research/publication/perceus-garbage-free-reference-counting-with-reuse/</a></p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:insertRefCounting">insertRefCounting</a> :: <a href="IR-IR.html#t:Program" title="IR.IR">Program</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a> -&gt; <a href="Common-Compiler.html#t:Pass" title="Common.Compiler">Pass</a> (<a href="IR-IR.html#t:Program" title="IR.IR">Program</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a>)</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:insertRefCounting" class="def">insertRefCounting</a> :: <a href="IR-IR.html#t:Program" title="IR.IR">Program</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a> -&gt; <a href="Common-Compiler.html#t:Pass" title="Common.Compiler">Pass</a> (<a href="IR-IR.html#t:Program" title="IR.IR">Program</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a>) <a href="src/IR.InsertRefCounting.html#insertRefCounting" class="link">Source</a> <a href="#v:insertRefCounting" class="selflink">#</a></p><div class="doc"><p>Insert dup and drop primitives throughout a program</p><p>Applies <code>insertTop</code> to the program's definitions</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.24.2</p></div></body></html>