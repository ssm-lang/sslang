<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>IR.HM</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">sslang-0.1.0.0</span><ul class="links" id="page-menu"><li><a href="src/IR.HM.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">IR.HM</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Infer types for IR of optionally annotated program using Hindley Milner
type inference algorithm with union find tree data structure.</p><p>There are three main stages of the algorithm
1. Assign symbolic typenames
   During this stage, we walk through each expression recursively, initialize
   its type by either assigning a fresh type variable or looking it up in the
   type context at that point, and generate a list of type equations to record
   the relationships between types. We also collapse the list of type
   annotations into the most specific one and put that information into a type
   equation as well to bring it into the later inference. Note that we will be
   modifying the expression monad simultaneously to record its new type info.
2. Solve type equations using unification.
   During this stage, we solve the type equations generated in the last stage
   and build a union find tree. This stage should be merged with stage 1 in the
   future.
3. Find the type of the expression.
   During this stage, we walk through each expression recursively and assign it
   with its inferred type by loop up the root of its temporary type in the union
  find tree.</p><p>The three stages are encaptured by the functions <code><a href="IR-HM.html#v:initTypeVars" title="IR.HM">initTypeVars</a></code>, <code><a href="IR-HM.html#v:unifyAll" title="IR.HM">unifyAll</a></code>,
and <code><a href="IR-HM.html#v:getType" title="IR.HM">getType</a></code>.</p><p>TODO:
- Define a partial order for the generality of types. The order will be used to
  (1) collapse type annotations into the most specific one; (2) check that
  type annotation is equal to or more specific than the expression's inferred
  type.
- Handle recursive function correctly.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:InferState">InferState</a> = <a href="#v:InferState">InferState</a> {<ul class="subs"><li><a href="#v:varMap">varMap</a> :: <a href="../containers-0.6.5.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a> <a href="IR-Types-Classes.html#t:Scheme" title="IR.Types.Classes">Scheme</a></li><li><a href="#v:equations">equations</a> :: [(<a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>, <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>)]</li><li><a href="#v:unionFindTree">unionFindTree</a> :: <a href="../containers-0.6.5.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a></li><li><a href="#v:count">count</a> :: <a href="../base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li><a href="#v:dConType">dConType</a> :: <a href="../containers-0.6.5.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="Common-Identifiers.html#t:DConId" title="Common.Identifiers">DConId</a> (<a href="Common-Identifiers.html#t:TConId" title="Common.Identifiers">TConId</a>, [<a href="Common-Identifiers.html#t:TVarId" title="Common.Identifiers">TVarId</a>], [<a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>])</li></ul>}</li><li class="src short"><span class="keyword">newtype</span> <a href="#t:InferFn">InferFn</a> a = <a href="#v:InferFn">InferFn</a> (<a href="../mtl-2.2.2/Control-Monad-State-Lazy.html#t:StateT" title="Control.Monad.State.Lazy">StateT</a> <a href="IR-HM.html#t:InferState" title="IR.HM">InferState</a> <a href="Common-Compiler.html#t:Pass" title="Common.Compiler">Pass</a> a)</li><li class="src short"><a href="#v:runInferFn">runInferFn</a> :: <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a -&gt; <a href="Common-Compiler.html#t:Pass" title="Common.Compiler">Pass</a> a</li><li class="src short"><a href="#v:inferProgram">inferProgram</a> :: <a href="IR-IR.html#t:Program" title="IR.IR">Program</a> <a href="IR-Types-Annotated.html#t:Type" title="IR.Types.Annotated">Type</a> -&gt; <a href="Common-Compiler.html#t:Pass" title="Common.Compiler">Pass</a> (<a href="IR-IR.html#t:Program" title="IR.IR">Program</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>)</li><li class="src short"><a href="#v:recordFDefs">recordFDefs</a> :: [(<a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a>, <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Annotated.html#t:Type" title="IR.Types.Annotated">Type</a>)] -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> ()</li><li class="src short"><a href="#v:recordADTs">recordADTs</a> :: [(<a href="Common-Identifiers.html#t:TConId" title="Common.Identifiers">TConId</a>, <a href="IR-Types-TypeSystem.html#t:TypeDef" title="IR.Types.TypeSystem">TypeDef</a> <a href="IR-Types-Annotated.html#t:Type" title="IR.Types.Annotated">Type</a>)] -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> [(<a href="Common-Identifiers.html#t:TConId" title="Common.Identifiers">TConId</a>, <a href="IR-Types-TypeSystem.html#t:TypeDef" title="IR.Types.TypeSystem">TypeDef</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>)]</li><li class="src short"><a href="#v:recordDCon">recordDCon</a> :: <a href="Common-Identifiers.html#t:TConId" title="Common.Identifiers">TConId</a> -&gt; [<a href="Common-Identifiers.html#t:TVarId" title="Common.Identifiers">TVarId</a>] -&gt; (<a href="Common-Identifiers.html#t:DConId" title="Common.Identifiers">DConId</a>, <a href="IR-Types-TypeSystem.html#t:TypeVariant" title="IR.Types.TypeSystem">TypeVariant</a> <a href="IR-Types-Annotated.html#t:Type" title="IR.Types.Annotated">Type</a>) -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> ()</li><li class="src short"><a href="#v:recordExterns">recordExterns</a> :: [(<a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a>, <a href="IR-Types-Annotated.html#t:Type" title="IR.Types.Annotated">Type</a>)] -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> [(<a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a>, <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>)]</li><li class="src short"><a href="#v:inferProgramDefs">inferProgramDefs</a> :: [(<a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a>, <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Annotated.html#t:Type" title="IR.Types.Annotated">Type</a>)] -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> [(<a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a>, <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>)]</li><li class="src short"><a href="#v:initAllTypeVars">initAllTypeVars</a> :: [(<a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a>, <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Annotated.html#t:Type" title="IR.Types.Annotated">Type</a>)] -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> [(<a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a>, <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>)]</li><li class="src short"><a href="#v:getAllTypes">getAllTypes</a> :: [(<a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a>, <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>)] -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> [(<a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a>, <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>)]</li><li class="src short"><span class="keyword">class</span> <a href="#t:HasFreeTVars">HasFreeTVars</a> a <span class="keyword">where</span><ul class="subs"><li><a href="#v:freeTVars">freeTVars</a> :: a -&gt; <a href="../containers-0.6.5.1/Data-Set.html#t:Set" title="Data.Set">Set</a> <a href="Common-Identifiers.html#t:TVarId" title="Common.Identifiers">TVarId</a></li></ul></li><li class="src short"><a href="#v:instantiate">instantiate</a> :: <a href="IR-Types-Classes.html#t:Scheme" title="IR.Types.Classes">Scheme</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a></li><li class="src short"><a href="#v:generalize">generalize</a> :: <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> <a href="IR-Types-Classes.html#t:Scheme" title="IR.Types.Classes">Scheme</a></li><li class="src short"><a href="#v:letters">letters</a> :: [<a href="../base-4.14.3.0/Data-String.html#t:String" title="Data.String">String</a>]</li><li class="src short"><a href="#v:dummyAnnT">dummyAnnT</a> :: <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a></li><li class="src short"><a href="#v:fresh">fresh</a> :: <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a></li><li class="src short"><a href="#v:lookupVar">lookupVar</a> :: <a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> (<a href="../base-4.14.3.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="IR-Types-Classes.html#t:Scheme" title="IR.Types.Classes">Scheme</a>)</li><li class="src short"><a href="#v:lookupDCon">lookupDCon</a> :: <a href="Common-Identifiers.html#t:DConId" title="Common.Identifiers">DConId</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> (<a href="../base-4.14.3.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="IR-Types-Classes.html#t:Scheme" title="IR.Types.Classes">Scheme</a>)</li><li class="src short"><a href="#v:insertVar">insertVar</a> :: <a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a> -&gt; <a href="IR-Types-Classes.html#t:Scheme" title="IR.Types.Classes">Scheme</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> ()</li><li class="src short"><a href="#v:insertBinder">insertBinder</a> :: <a href="Common-Identifiers.html#t:Binder" title="Common.Identifiers">Binder</a> -&gt; <a href="IR-Types-Classes.html#t:Scheme" title="IR.Types.Classes">Scheme</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> ()</li><li class="src short"><a href="#v:insertEquation">insertEquation</a> :: (<a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>, <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>) -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> ()</li><li class="src short"><a href="#v:insertUnion">insertUnion</a> :: <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> -&gt; <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> ()</li><li class="src short"><a href="#v:withNewScope">withNewScope</a> :: <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a</li><li class="src short"><a href="#v:withNewTypeScope">withNewTypeScope</a> :: <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a</li><li class="src short"><a href="#v:collapseAnnT">collapseAnnT</a> :: <a href="IR-Types-Annotated.html#t:Type" title="IR.Types.Annotated">Type</a> -&gt; <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a></li><li class="src short"><a href="#v:initTypeVars">initTypeVars</a> :: <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Annotated.html#t:Type" title="IR.Types.Annotated">Type</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> (<a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>)</li><li class="src short"><a href="#v:inferPrimBinop">inferPrimBinop</a> :: <a href="IR-IR.html#t:PrimOp" title="IR.IR">PrimOp</a> -&gt; <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Annotated.html#t:Type" title="IR.Types.Annotated">Type</a> -&gt; <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Annotated.html#t:Type" title="IR.Types.Annotated">Type</a> -&gt; <a href="IR-Types-Annotated.html#t:Type" title="IR.Types.Annotated">Type</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> (<a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>)</li><li class="src short"><a href="#v:typeCheck">typeCheck</a> :: <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> -&gt; <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a></li><li class="src short"><a href="#v:unifyAll">unifyAll</a> :: <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> ()</li><li class="src short"><a href="#v:unify">unify</a> :: <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> -&gt; <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> ()</li><li class="src short"><a href="#v:getType">getType</a> :: <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> (<a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>)</li><li class="src short"><a href="#v:getTypePrimOp">getTypePrimOp</a> :: <a href="IR-IR.html#t:PrimOp" title="IR.IR">PrimOp</a> -&gt; [<a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>] -&gt; <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> (<a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>)</li><li class="src short"><a href="#v:solveType">solveType</a> :: <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a></li><li class="src short"><a href="#v:findRoot">findRoot</a> :: <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a></li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:InferState" class="def">InferState</a> <a href="src/IR.HM.html#InferState" class="link">Source</a> <a href="#t:InferState" class="selflink">#</a></p><div class="doc"><p>Inference State.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:InferState" class="def">InferState</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:varMap" class="def">varMap</a> :: <a href="../containers-0.6.5.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a> <a href="IR-Types-Classes.html#t:Scheme" title="IR.Types.Classes">Scheme</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:equations" class="def">equations</a> :: [(<a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>, <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>)]</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:unionFindTree" class="def">unionFindTree</a> :: <a href="../containers-0.6.5.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:count" class="def">count</a> :: <a href="../base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:dConType" class="def">dConType</a> :: <a href="../containers-0.6.5.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="Common-Identifiers.html#t:DConId" title="Common.Identifiers">DConId</a> (<a href="Common-Identifiers.html#t:TConId" title="Common.Identifiers">TConId</a>, [<a href="Common-Identifiers.html#t:TVarId" title="Common.Identifiers">TVarId</a>], [<a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>])</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:InferState">Instances</h4><details id="i:InferState" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:InferState:MonadState:1"></span> <a href="../mtl-2.2.2/Control-Monad-State-Class.html#t:MonadState" title="Control.Monad.State.Class">MonadState</a> <a href="IR-HM.html#t:InferState" title="IR.HM">InferState</a> <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a></span> <a href="src/IR.HM.html#line-91" class="link">Source</a> <a href="#t:InferState" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:InferState:MonadState:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="IR-HM.html">IR.HM</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:get">get</a> :: <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> <a href="IR-HM.html#t:InferState" title="IR.HM">InferState</a> <a href="#v:get" class="selflink">#</a></p><p class="src"><a href="#v:put">put</a> :: <a href="IR-HM.html#t:InferState" title="IR.HM">InferState</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> () <a href="#v:put" class="selflink">#</a></p><p class="src"><a href="#v:state">state</a> :: (<a href="IR-HM.html#t:InferState" title="IR.HM">InferState</a> -&gt; (a, <a href="IR-HM.html#t:InferState" title="IR.HM">InferState</a>)) -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a <a href="#v:state" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">newtype</span> <a id="t:InferFn" class="def">InferFn</a> a <a href="src/IR.HM.html#InferFn" class="link">Source</a> <a href="#t:InferFn" class="selflink">#</a></p><div class="doc"><p>Inference Monad.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:InferFn" class="def">InferFn</a> (<a href="../mtl-2.2.2/Control-Monad-State-Lazy.html#t:StateT" title="Control.Monad.State.Lazy">StateT</a> <a href="IR-HM.html#t:InferState" title="IR.HM">InferState</a> <a href="Common-Compiler.html#t:Pass" title="Common.Compiler">Pass</a> a)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:InferFn">Instances</h4><details id="i:InferFn" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:InferFn:Monad:1"></span> <a href="../base-4.14.3.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a></span> <a href="src/IR.HM.html#line-88" class="link">Source</a> <a href="#t:InferFn" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:InferFn:Monad:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="IR-HM.html">IR.HM</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-62--62--61-">(&gt;&gt;=)</a> :: <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a -&gt; (a -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> b) -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> b <a href="#v:-62--62--61-" class="selflink">#</a></p><p class="src"><a href="#v:-62--62-">(&gt;&gt;)</a> :: <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> b -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> b <a href="#v:-62--62-" class="selflink">#</a></p><p class="src"><a href="#v:return">return</a> :: a -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a <a href="#v:return" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:InferFn:Functor:2"></span> <a href="../base-4.14.3.0/Data-Functor.html#t:Functor" title="Data.Functor">Functor</a> <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a></span> <a href="src/IR.HM.html#line-86" class="link">Source</a> <a href="#t:InferFn" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:InferFn:Functor:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="IR-HM.html">IR.HM</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:fmap">fmap</a> :: (a -&gt; b) -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> b <a href="#v:fmap" class="selflink">#</a></p><p class="src"><a href="#v:-60--36-">(&lt;$)</a> :: a -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> b -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a <a href="#v:-60--36-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:InferFn:MonadFail:3"></span> <a href="../base-4.14.3.0/Control-Monad-Fail.html#t:MonadFail" title="Control.Monad.Fail">MonadFail</a> <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a></span> <a href="src/IR.HM.html#line-89" class="link">Source</a> <a href="#t:InferFn" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:InferFn:MonadFail:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="IR-HM.html">IR.HM</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:fail">fail</a> :: <a href="../base-4.14.3.0/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a <a href="#v:fail" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:InferFn:Applicative:4"></span> <a href="../base-4.14.3.0/Control-Applicative.html#t:Applicative" title="Control.Applicative">Applicative</a> <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a></span> <a href="src/IR.HM.html#line-87" class="link">Source</a> <a href="#t:InferFn" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:InferFn:Applicative:4"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="IR-HM.html">IR.HM</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:pure">pure</a> :: a -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a <a href="#v:pure" class="selflink">#</a></p><p class="src"><a href="#v:-60--42--62-">(&lt;*&gt;)</a> :: <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> (a -&gt; b) -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> b <a href="#v:-60--42--62-" class="selflink">#</a></p><p class="src"><a href="#v:liftA2">liftA2</a> :: (a -&gt; b -&gt; c) -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> b -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> c <a href="#v:liftA2" class="selflink">#</a></p><p class="src"><a href="#v:-42--62-">(*&gt;)</a> :: <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> b -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> b <a href="#v:-42--62-" class="selflink">#</a></p><p class="src"><a href="#v:-60--42-">(&lt;*)</a> :: <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> b -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a <a href="#v:-60--42-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:InferFn:MonadState:5"></span> <a href="../mtl-2.2.2/Control-Monad-State-Class.html#t:MonadState" title="Control.Monad.State.Class">MonadState</a> <a href="IR-HM.html#t:InferState" title="IR.HM">InferState</a> <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a></span> <a href="src/IR.HM.html#line-91" class="link">Source</a> <a href="#t:InferFn" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:InferFn:MonadState:5"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="IR-HM.html">IR.HM</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:get">get</a> :: <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> <a href="IR-HM.html#t:InferState" title="IR.HM">InferState</a> <a href="#v:get" class="selflink">#</a></p><p class="src"><a href="#v:put">put</a> :: <a href="IR-HM.html#t:InferState" title="IR.HM">InferState</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> () <a href="#v:put" class="selflink">#</a></p><p class="src"><a href="#v:state">state</a> :: (<a href="IR-HM.html#t:InferState" title="IR.HM">InferState</a> -&gt; (a, <a href="IR-HM.html#t:InferState" title="IR.HM">InferState</a>)) -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a <a href="#v:state" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:InferFn:MonadError:6"></span> <a href="Common-Compiler.html#t:MonadError" title="Common.Compiler">MonadError</a> <a href="Common-Compiler.html#t:Error" title="Common.Compiler">Error</a> <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a></span> <a href="src/IR.HM.html#line-90" class="link">Source</a> <a href="#t:InferFn" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:InferFn:MonadError:6"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="IR-HM.html">IR.HM</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:throwError">throwError</a> :: <a href="Common-Compiler.html#t:Error" title="Common.Compiler">Error</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a <a href="#v:throwError" class="selflink">#</a></p><p class="src"><a href="#v:catchError">catchError</a> :: <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a -&gt; (<a href="Common-Compiler.html#t:Error" title="Common.Compiler">Error</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a) -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a <a href="#v:catchError" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:runInferFn" class="def">runInferFn</a> :: <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a -&gt; <a href="Common-Compiler.html#t:Pass" title="Common.Compiler">Pass</a> a <a href="src/IR.HM.html#runInferFn" class="link">Source</a> <a href="#v:runInferFn" class="selflink">#</a></p><div class="doc"><p>Run a InferFn computation.</p></div></div><div class="top"><p class="src"><a id="v:inferProgram" class="def">inferProgram</a> :: <a href="IR-IR.html#t:Program" title="IR.IR">Program</a> <a href="IR-Types-Annotated.html#t:Type" title="IR.Types.Annotated">Type</a> -&gt; <a href="Common-Compiler.html#t:Pass" title="Common.Compiler">Pass</a> (<a href="IR-IR.html#t:Program" title="IR.IR">Program</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>) <a href="src/IR.HM.html#inferProgram" class="link">Source</a> <a href="#v:inferProgram" class="selflink">#</a></p><div class="doc"><p><code><a href="IR-HM.html#v:inferProgram" title="IR.HM">inferProgram</a></code> <code>p</code> infers the type of all the programDefs of the given program <code>p</code>.</p></div></div><div class="top"><p class="src"><a id="v:recordFDefs" class="def">recordFDefs</a> :: [(<a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a>, <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Annotated.html#t:Type" title="IR.Types.Annotated">Type</a>)] -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> () <a href="src/IR.HM.html#recordFDefs" class="link">Source</a> <a href="#v:recordFDefs" class="selflink">#</a></p><div class="doc"><p><code><a href="IR-HM.html#v:recordFDefs" title="IR.HM">recordFDefs</a></code> saves information about all the declared functions for future use</p></div></div><div class="top"><p class="src"><a id="v:recordADTs" class="def">recordADTs</a> :: [(<a href="Common-Identifiers.html#t:TConId" title="Common.Identifiers">TConId</a>, <a href="IR-Types-TypeSystem.html#t:TypeDef" title="IR.Types.TypeSystem">TypeDef</a> <a href="IR-Types-Annotated.html#t:Type" title="IR.Types.Annotated">Type</a>)] -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> [(<a href="Common-Identifiers.html#t:TConId" title="Common.Identifiers">TConId</a>, <a href="IR-Types-TypeSystem.html#t:TypeDef" title="IR.Types.TypeSystem">TypeDef</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>)] <a href="src/IR.HM.html#recordADTs" class="link">Source</a> <a href="#v:recordADTs" class="selflink">#</a></p><div class="doc"><p><code><a href="IR-HM.html#v:recordADTs" title="IR.HM">recordADTs</a></code> saves information about ADTs in the Inference State for future use</p><p>saves type of DCon as a (DCon,TCon) key-value pair
transforms Ann.Type to Classes.Type
saves types of DCon args (the ADT fields) as (DCon, [type]) key-value pairs</p></div></div><div class="top"><p class="src"><a id="v:recordDCon" class="def">recordDCon</a> :: <a href="Common-Identifiers.html#t:TConId" title="Common.Identifiers">TConId</a> -&gt; [<a href="Common-Identifiers.html#t:TVarId" title="Common.Identifiers">TVarId</a>] -&gt; (<a href="Common-Identifiers.html#t:DConId" title="Common.Identifiers">DConId</a>, <a href="IR-Types-TypeSystem.html#t:TypeVariant" title="IR.Types.TypeSystem">TypeVariant</a> <a href="IR-Types-Annotated.html#t:Type" title="IR.Types.Annotated">Type</a>) -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> () <a href="src/IR.HM.html#recordDCon" class="link">Source</a> <a href="#v:recordDCon" class="selflink">#</a></p><div class="doc"><p><code>insertType</code> inserts the overall type of an ADT's <code>DConid</code> into the Inference State</p></div></div><div class="top"><p class="src"><a id="v:recordExterns" class="def">recordExterns</a> :: [(<a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a>, <a href="IR-Types-Annotated.html#t:Type" title="IR.Types.Annotated">Type</a>)] -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> [(<a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a>, <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>)] <a href="src/IR.HM.html#recordExterns" class="link">Source</a> <a href="#v:recordExterns" class="selflink">#</a></p><div class="doc"><p>Record the types of extern symbols.
 NOTE: this does not actually check for arity and probably doesn't do
 polymorphism correctly either.</p></div></div><div class="top"><p class="src"><a id="v:inferProgramDefs" class="def">inferProgramDefs</a> :: [(<a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a>, <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Annotated.html#t:Type" title="IR.Types.Annotated">Type</a>)] -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> [(<a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a>, <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>)] <a href="src/IR.HM.html#inferProgramDefs" class="link">Source</a> <a href="#v:inferProgramDefs" class="selflink">#</a></p><div class="doc"><p><code><a href="IR-HM.html#v:inferProgramDefs" title="IR.HM">inferProgramDefs</a></code> <code>ds</code> infers the type of programDefs <code>ds</code> recursively and binds each varibale to its type.</p></div></div><div class="top"><p class="src"><a id="v:initAllTypeVars" class="def">initAllTypeVars</a> :: [(<a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a>, <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Annotated.html#t:Type" title="IR.Types.Annotated">Type</a>)] -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> [(<a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a>, <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>)] <a href="src/IR.HM.html#initAllTypeVars" class="link">Source</a> <a href="#v:initAllTypeVars" class="selflink">#</a></p><div class="doc"><p><code><a href="IR-HM.html#v:initAllTypeVars" title="IR.HM">initAllTypeVars</a></code> initialize all the funcitons' type at once</p></div></div><div class="top"><p class="src"><a id="v:getAllTypes" class="def">getAllTypes</a> :: [(<a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a>, <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>)] -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> [(<a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a>, <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>)] <a href="src/IR.HM.html#getAllTypes" class="link">Source</a> <a href="#v:getAllTypes" class="selflink">#</a></p><div class="doc"><p><code><a href="IR-HM.html#v:getAllTypes" title="IR.HM">getAllTypes</a></code> replace all the type variables in the initial funciton types</p></div></div><div class="top"><p class="src"><span class="keyword">class</span> <a id="t:HasFreeTVars" class="def">HasFreeTVars</a> a <span class="keyword">where</span> <a href="src/IR.HM.html#HasFreeTVars" class="link">Source</a> <a href="#t:HasFreeTVars" class="selflink">#</a></p><div class="doc"><p>Class of things that may contain free type variables.</p></div><div class="subs methods"><p class="caption">Methods</p><p class="src"><a id="v:freeTVars" class="def">freeTVars</a> :: a -&gt; <a href="../containers-0.6.5.1/Data-Set.html#t:Set" title="Data.Set">Set</a> <a href="Common-Identifiers.html#t:TVarId" title="Common.Identifiers">TVarId</a> <a href="src/IR.HM.html#freeTVars" class="link">Source</a> <a href="#v:freeTVars" class="selflink">#</a></p></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:HasFreeTVars">Instances</h4><details id="i:HasFreeTVars" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:ic:HasFreeTVars:HasFreeTVars:1"></span> <a href="IR-HM.html#t:HasFreeTVars" title="IR.HM">HasFreeTVars</a> <a href="Common-Identifiers.html#t:TVarId" title="Common.Identifiers">TVarId</a></span> <a href="src/IR.HM.html#line-202" class="link">Source</a> <a href="#t:HasFreeTVars" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:ic:HasFreeTVars:HasFreeTVars:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="IR-HM.html">IR.HM</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:freeTVars">freeTVars</a> :: <a href="Common-Identifiers.html#t:TVarId" title="Common.Identifiers">TVarId</a> -&gt; <a href="../containers-0.6.5.1/Data-Set.html#t:Set" title="Data.Set">Set</a> <a href="Common-Identifiers.html#t:TVarId" title="Common.Identifiers">TVarId</a> <a href="src/IR.HM.html#freeTVars" class="link">Source</a> <a href="#v:freeTVars" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:ic:HasFreeTVars:HasFreeTVars:2"></span> <a href="IR-HM.html#t:HasFreeTVars" title="IR.HM">HasFreeTVars</a> <a href="IR-Types-Classes.html#t:Scheme" title="IR.Types.Classes">Scheme</a></span> <a href="src/IR.HM.html#line-205" class="link">Source</a> <a href="#t:HasFreeTVars" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:ic:HasFreeTVars:HasFreeTVars:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="IR-HM.html">IR.HM</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:freeTVars">freeTVars</a> :: <a href="IR-Types-Classes.html#t:Scheme" title="IR.Types.Classes">Scheme</a> -&gt; <a href="../containers-0.6.5.1/Data-Set.html#t:Set" title="Data.Set">Set</a> <a href="Common-Identifiers.html#t:TVarId" title="Common.Identifiers">TVarId</a> <a href="src/IR.HM.html#freeTVars" class="link">Source</a> <a href="#v:freeTVars" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:ic:HasFreeTVars:HasFreeTVars:3"></span> <a href="IR-HM.html#t:HasFreeTVars" title="IR.HM">HasFreeTVars</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a></span> <a href="src/IR.HM.html#line-213" class="link">Source</a> <a href="#t:HasFreeTVars" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:ic:HasFreeTVars:HasFreeTVars:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="IR-HM.html">IR.HM</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:freeTVars">freeTVars</a> :: <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> -&gt; <a href="../containers-0.6.5.1/Data-Set.html#t:Set" title="Data.Set">Set</a> <a href="Common-Identifiers.html#t:TVarId" title="Common.Identifiers">TVarId</a> <a href="src/IR.HM.html#freeTVars" class="link">Source</a> <a href="#v:freeTVars" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:ic:HasFreeTVars:HasFreeTVars:4"></span> <a href="IR-HM.html#t:HasFreeTVars" title="IR.HM">HasFreeTVars</a> a =&gt; <a href="IR-HM.html#t:HasFreeTVars" title="IR.HM">HasFreeTVars</a> [a]</span> <a href="src/IR.HM.html#line-226" class="link">Source</a> <a href="#t:HasFreeTVars" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:ic:HasFreeTVars:HasFreeTVars:4"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="IR-HM.html">IR.HM</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:freeTVars">freeTVars</a> :: [a] -&gt; <a href="../containers-0.6.5.1/Data-Set.html#t:Set" title="Data.Set">Set</a> <a href="Common-Identifiers.html#t:TVarId" title="Common.Identifiers">TVarId</a> <a href="src/IR.HM.html#freeTVars" class="link">Source</a> <a href="#v:freeTVars" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:ic:HasFreeTVars:HasFreeTVars:5"></span> <a href="IR-HM.html#t:HasFreeTVars" title="IR.HM">HasFreeTVars</a> t =&gt; <a href="IR-HM.html#t:HasFreeTVars" title="IR.HM">HasFreeTVars</a> (<a href="IR-Types-TypeSystem.html#t:Builtin" title="IR.Types.TypeSystem">Builtin</a> t)</span> <a href="src/IR.HM.html#line-218" class="link">Source</a> <a href="#t:HasFreeTVars" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:ic:HasFreeTVars:HasFreeTVars:5"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="IR-HM.html">IR.HM</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:freeTVars">freeTVars</a> :: <a href="IR-Types-TypeSystem.html#t:Builtin" title="IR.Types.TypeSystem">Builtin</a> t -&gt; <a href="../containers-0.6.5.1/Data-Set.html#t:Set" title="Data.Set">Set</a> <a href="Common-Identifiers.html#t:TVarId" title="Common.Identifiers">TVarId</a> <a href="src/IR.HM.html#freeTVars" class="link">Source</a> <a href="#v:freeTVars" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:instantiate" class="def">instantiate</a> :: <a href="IR-Types-Classes.html#t:Scheme" title="IR.Types.Classes">Scheme</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> <a href="src/IR.HM.html#instantiate" class="link">Source</a> <a href="#v:instantiate" class="selflink">#</a></p><div class="doc"><p>Instantiates the type from the scheme <code>Forall vs t</code>.</p><p>Create fresh type variable for each quantified type variable in <code>vs</code> and
substitute them in <code>t</code> by applying <code>subst</code> to <code>t</code>.</p></div></div><div class="top"><p class="src"><a id="v:generalize" class="def">generalize</a> :: <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> <a href="IR-Types-Classes.html#t:Scheme" title="IR.Types.Classes">Scheme</a> <a href="src/IR.HM.html#generalize" class="link">Source</a> <a href="#v:generalize" class="selflink">#</a></p><div class="doc"><p>Generalizes the type <code>t</code> into a type scheme given the typing context <code>ctx</code>.</p><p>Collect all the free type variables in the type <code>t</code> and all the free type
variables in the typing context <code>ctx</code>,
away any type variables that appear free in the type environment, and whatever
is leftover can be generalized into a type scheme.</p></div></div><div class="top"><p class="src"><a id="v:letters" class="def">letters</a> :: [<a href="../base-4.14.3.0/Data-String.html#t:String" title="Data.String">String</a>] <a href="src/IR.HM.html#letters" class="link">Source</a> <a href="#v:letters" class="selflink">#</a></p><div class="doc"><p><code><a href="IR-HM.html#v:letters" title="IR.HM">letters</a></code> represents list of identifiers to be used to construct free type
 variables assigned during type inference. The leading '_' distinguish them
 from user-annotated type variables.</p></div></div><div class="top"><p class="src"><a id="v:dummyAnnT" class="def">dummyAnnT</a> :: <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> <a href="src/IR.HM.html#dummyAnnT" class="link">Source</a> <a href="#v:dummyAnnT" class="selflink">#</a></p><div class="doc"><p><code>dummyAnnT</code> represents empty type annotation list.</p></div></div><div class="top"><p class="src"><a id="v:fresh" class="def">fresh</a> :: <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> <a href="src/IR.HM.html#fresh" class="link">Source</a> <a href="#v:fresh" class="selflink">#</a></p><div class="doc"><p>Generates a new <code>TVar</code> using the next tick number and increment the counter.</p></div></div><div class="top"><p class="src"><a id="v:lookupVar" class="def">lookupVar</a> :: <a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> (<a href="../base-4.14.3.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="IR-Types-Classes.html#t:Scheme" title="IR.Types.Classes">Scheme</a>) <a href="src/IR.HM.html#lookupVar" class="link">Source</a> <a href="#v:lookupVar" class="selflink">#</a></p><div class="doc"><p><code><a href="IR-HM.html#v:lookupVar" title="IR.HM">lookupVar</a></code> <code>v</code> looks up the type scheme of a variable in the current <code><a href="IR-HM.html#v:varMap" title="IR.HM">varMap</a></code> given its variable ID <code>v</code>.</p></div></div><div class="top"><p class="src"><a id="v:lookupDCon" class="def">lookupDCon</a> :: <a href="Common-Identifiers.html#t:DConId" title="Common.Identifiers">DConId</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> (<a href="../base-4.14.3.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="IR-Types-Classes.html#t:Scheme" title="IR.Types.Classes">Scheme</a>) <a href="src/IR.HM.html#lookupDCon" class="link">Source</a> <a href="#v:lookupDCon" class="selflink">#</a></p><div class="doc"><p>Look up the type of a data constructor in the inference state.</p></div></div><div class="top"><p class="src"><a id="v:insertVar" class="def">insertVar</a> :: <a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a> -&gt; <a href="IR-Types-Classes.html#t:Scheme" title="IR.Types.Classes">Scheme</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> () <a href="src/IR.HM.html#insertVar" class="link">Source</a> <a href="#v:insertVar" class="selflink">#</a></p><div class="doc"><p><code><a href="IR-HM.html#v:insertVar" title="IR.HM">insertVar</a></code> <code>v t</code> Insert a variable ID and its type scheme into current <code><a href="IR-HM.html#v:varMap" title="IR.HM">varMap</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:insertBinder" class="def">insertBinder</a> :: <a href="Common-Identifiers.html#t:Binder" title="Common.Identifiers">Binder</a> -&gt; <a href="IR-Types-Classes.html#t:Scheme" title="IR.Types.Classes">Scheme</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> () <a href="src/IR.HM.html#insertBinder" class="link">Source</a> <a href="#v:insertBinder" class="selflink">#</a></p><div class="doc"><p><code><a href="IR-HM.html#v:insertBinder" title="IR.HM">insertBinder</a></code> is a wrapper of <code><a href="IR-HM.html#v:insertVar" title="IR.HM">insertVar</a></code> for <code><a href="Common-Identifiers.html#t:Binder" title="Common.Identifiers">Binder</a></code> type.</p></div></div><div class="top"><p class="src"><a id="v:insertEquation" class="def">insertEquation</a> :: (<a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>, <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>) -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> () <a href="src/IR.HM.html#insertEquation" class="link">Source</a> <a href="#v:insertEquation" class="selflink">#</a></p><div class="doc"><p><code><a href="IR-HM.html#v:insertEquation" title="IR.HM">insertEquation</a></code> <code>e</code> inserts <code>e</code> into the current <code><a href="IR-HM.html#v:equations" title="IR.HM">equations</a></code> list.</p></div></div><div class="top"><p class="src"><a id="v:insertUnion" class="def">insertUnion</a> :: <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> -&gt; <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> () <a href="src/IR.HM.html#insertUnion" class="link">Source</a> <a href="#v:insertUnion" class="selflink">#</a></p><div class="doc"><p><code><a href="IR-HM.html#v:insertUnion" title="IR.HM">insertUnion</a></code> <code>t1 t2</code> inserts <code>t1 : t2</code> into the current <code><a href="IR-HM.html#v:unionFindTree" title="IR.HM">unionFindTree</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:withNewScope" class="def">withNewScope</a> :: <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a <a href="src/IR.HM.html#withNewScope" class="link">Source</a> <a href="#v:withNewScope" class="selflink">#</a></p><div class="doc"><p>Helper function to support local modificaton of <code><a href="IR-HM.html#v:varMap" title="IR.HM">varMap</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:withNewTypeScope" class="def">withNewTypeScope</a> :: <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> a <a href="src/IR.HM.html#withNewTypeScope" class="link">Source</a> <a href="#v:withNewTypeScope" class="selflink">#</a></p><div class="doc"><p>Helper function to support local modificaton of <code><a href="IR-HM.html#v:unionFindTree" title="IR.HM">unionFindTree</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:collapseAnnT" class="def">collapseAnnT</a> :: <a href="IR-Types-Annotated.html#t:Type" title="IR.Types.Annotated">Type</a> -&gt; <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> <a href="src/IR.HM.html#collapseAnnT" class="link">Source</a> <a href="#v:collapseAnnT" class="selflink">#</a></p><div class="doc"><p>Helper function to collapse a list of type annotation to a single one with
 'Classes.type' type. If the list is empty, use
 <code>Classes.TVar (TVarId $ Identifier &quot;_&quot;))</code> to denote a dummy annotation.
 TODO: Currently just take the first type annotation of the list as the
 result. Need to implement the <code>collapse</code> step to find and return the most
 specific type annotation from the list. Need yo add support for annotating
 type variables as well.</p></div></div><div class="top"><p class="src"><a id="v:initTypeVars" class="def">initTypeVars</a> :: <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Annotated.html#t:Type" title="IR.Types.Annotated">Type</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> (<a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>) <a href="src/IR.HM.html#initTypeVars" class="link">Source</a> <a href="#v:initTypeVars" class="selflink">#</a></p><div class="doc"><p>Stage 1: Assign symbolic typenames</p><p><code><a href="IR-HM.html#v:initTypeVars" title="IR.HM">initTypeVars</a></code> <code>e</code> walks into the expression <code>e</code> recursively, assign a fresh
<code>TVar</code> to each unknown type, and build type equations that will be solved later.</p></div></div><div class="top"><p class="src"><a id="v:inferPrimBinop" class="def">inferPrimBinop</a> :: <a href="IR-IR.html#t:PrimOp" title="IR.IR">PrimOp</a> -&gt; <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Annotated.html#t:Type" title="IR.Types.Annotated">Type</a> -&gt; <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Annotated.html#t:Type" title="IR.Types.Annotated">Type</a> -&gt; <a href="IR-Types-Annotated.html#t:Type" title="IR.Types.Annotated">Type</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> (<a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>) <a href="src/IR.HM.html#inferPrimBinop" class="link">Source</a> <a href="#v:inferPrimBinop" class="selflink">#</a></p><div class="doc"><p>Infer the type of a binary integer operation.</p></div></div><div class="top"><p class="src"><a id="v:typeCheck" class="def">typeCheck</a> :: <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> -&gt; <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> <a href="src/IR.HM.html#typeCheck" class="link">Source</a> <a href="#v:typeCheck" class="selflink">#</a></p><div class="doc"><p><code>typeCheck annT expectedT</code> checks whether the type annotation <code>annT</code> is
 compatible with the expected type <code>expectedT</code>. Insert new type equations when
 the expected type is a type variable.
 TODO: currently only consider equality as compatibility. Need to support the
 case when type annotation is more specific than the expected type.</p></div></div><div class="top"><p class="src"><a id="v:unifyAll" class="def">unifyAll</a> :: <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> () <a href="src/IR.HM.html#unifyAll" class="link">Source</a> <a href="#v:unifyAll" class="selflink">#</a></p><div class="doc"><p>Stage 2: Solve type equations using unification.</p><p>Solve the list of <code><a href="IR-HM.html#v:equations" title="IR.HM">equations</a></code> one by one and puts solutions as new enties in
the <code><a href="IR-HM.html#v:unionFindTree" title="IR.HM">unionFindTree</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:unify" class="def">unify</a> :: <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> -&gt; <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> () <a href="src/IR.HM.html#unify" class="link">Source</a> <a href="#v:unify" class="selflink">#</a></p><div class="doc"><p><code><a href="IR-HM.html#v:unify" title="IR.HM">unify</a></code> <code>t1 t2</code> solves the type equation t1 ~ t2 and put the solution into <code><a href="IR-HM.html#v:unionFindTree" title="IR.HM">unionFindTree</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:getType" class="def">getType</a> :: <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> (<a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>) <a href="src/IR.HM.html#getType" class="link">Source</a> <a href="#v:getType" class="selflink">#</a></p><div class="doc"><p>Stage 3: Find the type of the expression based on <code><a href="IR-HM.html#v:unionFindTree" title="IR.HM">unionFindTree</a></code>.</p><p><code><a href="IR-HM.html#v:getType" title="IR.HM">getType</a></code> <code>e</code> walks into the expression <code>e</code> and solves its type <code>t</code> recursively.</p></div></div><div class="top"><p class="src"><a id="v:getTypePrimOp" class="def">getTypePrimOp</a> :: <a href="IR-IR.html#t:PrimOp" title="IR.IR">PrimOp</a> -&gt; [<a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>] -&gt; <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> (<a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a>) <a href="src/IR.HM.html#getTypePrimOp" class="link">Source</a> <a href="#v:getTypePrimOp" class="selflink">#</a></p><div class="doc"><p>Recursively get type of operands to PrimOp, then apply given type.</p></div></div><div class="top"><p class="src"><a id="v:solveType" class="def">solveType</a> :: <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> <a href="src/IR.HM.html#solveType" class="link">Source</a> <a href="#v:solveType" class="selflink">#</a></p><div class="doc"><p><code><a href="IR-HM.html#v:solveType" title="IR.HM">solveType</a></code> <code>t</code> solves the type <code>t</code> by replacing any embeded <code>TVar</code> <code>tvar</code>
   with its real type, which is the root of <code>tvar</code> in the <code><a href="IR-HM.html#v:unionFindTree" title="IR.HM">unionFindTree</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:findRoot" class="def">findRoot</a> :: <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> -&gt; <a href="IR-HM.html#t:InferFn" title="IR.HM">InferFn</a> <a href="IR-Types-Classes.html#t:Type" title="IR.Types.Classes">Type</a> <a href="src/IR.HM.html#findRoot" class="link">Source</a> <a href="#v:findRoot" class="selflink">#</a></p><div class="doc"><p><code><a href="IR-HM.html#v:findRoot" title="IR.HM">findRoot</a></code> <code>t</code> finds the root of <code>t</code> inside <code><a href="IR-HM.html#v:unionFindTree" title="IR.HM">unionFindTree</a></code>.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.24.2</p></div></body></html>