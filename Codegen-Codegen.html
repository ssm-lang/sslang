<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Codegen.Codegen</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">sslang-0.1.0.0</span><ul class="links" id="page-menu"><li><a href="src/Codegen.Codegen.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Codegen.Codegen</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Translate SSM program to C compilation unit.</p><p>What is expected of the IR:</p><p>Well-formed: All primitive functions are applied to the right number of
arguments.</p><p>Pure par expression: All par-expressions' operands are applications that have no
side effects.</p><p>Defunctionalized: No lambdas; the only terms with an arrow type are variables
or applications.</p><p>Name mangled: All variable identifiers are unique.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:todo">todo</a> :: <a href="../base-4.14.3.0/GHC-Stack.html#t:HasCallStack" title="GHC.Stack">HasCallStack</a> =&gt; a</li><li class="src short"><a href="#v:nope">nope</a> :: <a href="../base-4.14.3.0/GHC-Stack.html#t:HasCallStack" title="GHC.Stack">HasCallStack</a> =&gt; a</li><li class="src short"><span class="keyword">newtype</span> <a href="#t:EscExp">EscExp</a> = <a href="#v:EscExp">EscExp</a> <a href="../base-4.14.3.0/Data-String.html#t:String" title="Data.String">String</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:GenFnState">GenFnState</a> = <a href="#v:GenFnState">GenFnState</a> {<ul class="subs"><li><a href="#v:fnName">fnName</a> :: <a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a></li><li><a href="#v:fnParams">fnParams</a> :: [<a href="IR-IR.html#t:Binder" title="IR.IR">Binder</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a>]</li><li><a href="#v:fnRetTy">fnRetTy</a> :: <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a></li><li><a href="#v:fnBody">fnBody</a> :: <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a></li><li><a href="#v:fnLocals">fnLocals</a> :: <a href="../containers-0.6.5.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a></li><li><a href="#v:fnVars">fnVars</a> :: <a href="../containers-0.6.5.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a> Exp</li><li><a href="#v:fnMaxWaits">fnMaxWaits</a> :: <a href="../base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li><a href="#v:fnCases">fnCases</a> :: <a href="../base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li><a href="#v:fnFresh">fnFresh</a> :: <a href="../base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li><a href="#v:fnTypeInfo">fnTypeInfo</a> :: <a href="Codegen-Typegen.html#t:TypegenInfo" title="Codegen.Typegen">TypegenInfo</a></li></ul>}</li><li class="src short"><span class="keyword">newtype</span> <a href="#t:GenFn">GenFn</a> a = <a href="#v:GenFn">GenFn</a> (<a href="../mtl-2.2.2/Control-Monad-State-Lazy.html#t:StateT" title="Control.Monad.State.Lazy">StateT</a> <a href="Codegen-Codegen.html#t:GenFnState" title="Codegen.Codegen">GenFnState</a> <a href="Common-Compiler.html#t:Pass" title="Common.Compiler">Pass</a> a)</li><li class="src short"><a href="#v:runGenFn">runGenFn</a> :: <a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a> -&gt; [<a href="IR-IR.html#t:Binder" title="IR.IR">Binder</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a>] -&gt; <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a> -&gt; <a href="Codegen-Typegen.html#t:TypegenInfo" title="Codegen.Typegen">TypegenInfo</a> -&gt; [(<a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a>, <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a>)] -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a -&gt; <a href="Common-Compiler.html#t:Pass" title="Common.Compiler">Pass</a> a</li><li class="src short"><a href="#v:getsTCon">getsTCon</a> :: (<a href="Codegen-Typegen.html#t:TConInfo" title="Codegen.Typegen">TConInfo</a> -&gt; a) -&gt; <a href="Common-Identifiers.html#t:TConId" title="Common.Identifiers">TConId</a> -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a</li><li class="src short"><a href="#v:getsDCon">getsDCon</a> :: (<a href="Codegen-Typegen.html#t:DConInfo" title="Codegen.Typegen">DConInfo</a> -&gt; a) -&gt; <a href="Common-Identifiers.html#t:DConId" title="Common.Identifiers">DConId</a> -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a</li><li class="src short"><a href="#v:nextCase">nextCase</a> :: <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> <a href="../base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li class="src short"><a href="#v:getFresh">getFresh</a> :: <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> <a href="../base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li class="src short"><a href="#v:addBinding">addBinding</a> :: <a href="IR-IR.html#t:Binder" title="IR.IR">Binder</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a> -&gt; Exp -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> ()</li><li class="src short"><a href="#v:addLocal">addLocal</a> :: <a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a> -&gt; <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a> -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> <a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a></li><li class="src short"><a href="#v:withBindings">withBindings</a> :: [(<a href="IR-IR.html#t:Binder" title="IR.IR">Binder</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a>, Exp)] -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a</li><li class="src short"><a href="#v:withNewLocal">withNewLocal</a> :: (<a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a>, <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a>) -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a</li><li class="src short"><a href="#v:maxWait">maxWait</a> :: <a href="../base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> ()</li><li class="src short"><a href="#v:freshLabel">freshLabel</a> :: <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> <a href="Codegen-LibSSM.html#t:CIdent" title="Codegen.LibSSM">CIdent</a></li><li class="src short"><a href="#v:genTmp">genTmp</a> :: <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a> -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> Exp</li><li class="src short"><a href="#v:genParams">genParams</a> :: [<a href="IR-IR.html#t:Binder" title="IR.IR">Binder</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a>] -&gt; [(<a href="Codegen-LibSSM.html#t:CIdent" title="Codegen.LibSSM">CIdent</a>, Type)]</li><li class="src short"><a href="#v:genLocals">genLocals</a> :: [(<a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a>, <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a>)] -&gt; [(<a href="Codegen-LibSSM.html#t:CIdent" title="Codegen.LibSSM">CIdent</a>, Type)]</li><li class="src short"><a href="#v:genTrigs">genTrigs</a> :: <a href="../base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; [(<a href="Codegen-LibSSM.html#t:CIdent" title="Codegen.LibSSM">CIdent</a>, Type)]</li><li class="src short"><a href="#v:unit">unit</a> :: Exp</li><li class="src short"><a href="#v:undef">undef</a> :: Exp</li><li class="src short"><a href="#v:genProgram">genProgram</a> :: <a href="IR-IR.html#t:Program" title="IR.IR">Program</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a> -&gt; <a href="Common-Compiler.html#t:Pass" title="Common.Compiler">Pass</a> [Definition]</li><li class="src short"><a href="#v:includes">includes</a> :: [Definition]</li><li class="src short"><a href="#v:genInitProgram">genInitProgram</a> :: <a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a> -&gt; [Definition]</li><li class="src short"><a href="#v:genExtern">genExtern</a> :: (<a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a>, <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a>) -&gt; <a href="Common-Compiler.html#t:Pass" title="Common.Compiler">Pass</a> Definition</li><li class="src short"><a href="#v:genStruct">genStruct</a> :: <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> Definition</li><li class="src short"><a href="#v:genEnter">genEnter</a> :: <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> (Definition, Definition)</li><li class="src short"><a href="#v:genStaticClosure">genStaticClosure</a> :: <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> (Definition, Definition)</li><li class="src short"><a href="#v:genStep">genStep</a> :: <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> (Definition, Definition)</li><li class="src short"><a href="#v:genYield">genYield</a> :: <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> [BlockItem]</li><li class="src short"><a href="#v:genExpr">genExpr</a> :: <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a> -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> (Exp, [BlockItem])</li><li class="src short"><a href="#v:genPrim">genPrim</a> :: <a href="IR-IR.html#t:Primitive" title="IR.IR">Primitive</a> -&gt; [<a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a>] -&gt; <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a> -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> (Exp, [BlockItem])</li><li class="src short"><a href="#v:genLiteral">genLiteral</a> :: <a href="IR-IR.html#t:Literal" title="IR.IR">Literal</a> -&gt; Exp</li><li class="src short"><a href="#v:genLiteralRaw">genLiteralRaw</a> :: <a href="IR-IR.html#t:Literal" title="IR.IR">Literal</a> -&gt; Exp</li><li class="src short"><a href="#v:genPrimOp">genPrimOp</a> :: <a href="IR-IR.html#t:PrimOp" title="IR.IR">PrimOp</a> -&gt; [<a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a>] -&gt; <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a> -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> (Exp, [BlockItem])</li><li class="src short"><a href="#v:genBinop">genBinop</a> :: <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a> -&gt; <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a> -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> ((Exp, Exp), [BlockItem])</li><li class="src short"><a href="#v:genParArgs">genParArgs</a> :: <a href="../base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; (Exp, Exp) -&gt; [(Exp, Exp)]</li><li class="src short"><a href="#v:depthSub">depthSub</a> :: <a href="../base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; Exp</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:todo" class="def">todo</a> :: <a href="../base-4.14.3.0/GHC-Stack.html#t:HasCallStack" title="GHC.Stack">HasCallStack</a> =&gt; a <a href="src/Codegen.Codegen.html#todo" class="link">Source</a> <a href="#v:todo" class="selflink">#</a></p><div class="doc"><p>Possible, but temporarily punted for the sake of expediency.</p></div></div><div class="top"><p class="src"><a id="v:nope" class="def">nope</a> :: <a href="../base-4.14.3.0/GHC-Stack.html#t:HasCallStack" title="GHC.Stack">HasCallStack</a> =&gt; a <a href="src/Codegen.Codegen.html#nope" class="link">Source</a> <a href="#v:nope" class="selflink">#</a></p><div class="doc"><p>Impossible without a discussion about implementation strategy.</p></div></div><div class="top"><p class="src"><span class="keyword">newtype</span> <a id="t:EscExp" class="def">EscExp</a> <a href="src/Codegen.Codegen.html#EscExp" class="link">Source</a> <a href="#t:EscExp" class="selflink">#</a></p><div class="doc"><p>Hack to allow us to splice string literals into C AST</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:EscExp" class="def">EscExp</a> <a href="../base-4.14.3.0/Data-String.html#t:String" title="Data.String">String</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:EscExp">Instances</h4><details id="i:EscExp" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:EscExp:ToExp:1"></span> ToExp <a href="Codegen-Codegen.html#t:EscExp" title="Codegen.Codegen">EscExp</a></span> <a href="src/Codegen.Codegen.html#line-72" class="link">Source</a> <a href="#t:EscExp" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:EscExp:ToExp:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Codegen-Codegen.html">Codegen.Codegen</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:toExp">toExp</a> :: <a href="Codegen-Codegen.html#t:EscExp" title="Codegen.Codegen">EscExp</a> -&gt; SrcLoc -&gt; Exp</p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:GenFnState" class="def">GenFnState</a> <a href="src/Codegen.Codegen.html#GenFnState" class="link">Source</a> <a href="#t:GenFnState" class="selflink">#</a></p><div class="doc"><p>State maintained while compiling a top-level SSM function.</p><p>The information here is populated while generating the step function, so that
should be computed first, before this information is used to generate the act
struct and enter definitions.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:GenFnState" class="def">GenFnState</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:fnName" class="def">fnName</a> :: <a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a></dfn><div class="doc"><p>Function name</p></div></li><li><dfn class="src"><a id="v:fnParams" class="def">fnParams</a> :: [<a href="IR-IR.html#t:Binder" title="IR.IR">Binder</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a>]</dfn><div class="doc"><p>Function parameters</p></div></li><li><dfn class="src"><a id="v:fnRetTy" class="def">fnRetTy</a> :: <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a></dfn><div class="doc"><p>Function return type</p></div></li><li><dfn class="src"><a id="v:fnBody" class="def">fnBody</a> :: <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a></dfn><div class="doc"><p>Function body</p></div></li><li><dfn class="src"><a id="v:fnLocals" class="def">fnLocals</a> :: <a href="../containers-0.6.5.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a></dfn><div class="doc"><p>Function local variables</p></div></li><li><dfn class="src"><a id="v:fnVars" class="def">fnVars</a> :: <a href="../containers-0.6.5.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a> Exp</dfn><div class="doc"><p>How to resolve variables</p></div></li><li><dfn class="src"><a id="v:fnMaxWaits" class="def">fnMaxWaits</a> :: <a href="../base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a></dfn><div class="doc"><p>Number of triggers needed</p></div></li><li><dfn class="src"><a id="v:fnCases" class="def">fnCases</a> :: <a href="../base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a></dfn><div class="doc"><p>Yield point counter</p></div></li><li><dfn class="src"><a id="v:fnFresh" class="def">fnFresh</a> :: <a href="../base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a></dfn><div class="doc"><p>Temporary variable name counter</p></div></li><li><dfn class="src"><a id="v:fnTypeInfo" class="def">fnTypeInfo</a> :: <a href="Codegen-Typegen.html#t:TypegenInfo" title="Codegen.Typegen">TypegenInfo</a></dfn><div class="doc"><p>(User-defined) type information</p></div></li></ul></div></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:GenFnState">Instances</h4><details id="i:GenFnState" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:GenFnState:MonadState:1"></span> <a href="../mtl-2.2.2/Control-Monad-State-Class.html#t:MonadState" title="Control.Monad.State.Class">MonadState</a> <a href="Codegen-Codegen.html#t:GenFnState" title="Codegen.Codegen">GenFnState</a> <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a></span> <a href="src/Codegen.Codegen.html#line-117" class="link">Source</a> <a href="#t:GenFnState" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:GenFnState:MonadState:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Codegen-Codegen.html">Codegen.Codegen</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:get">get</a> :: <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> <a href="Codegen-Codegen.html#t:GenFnState" title="Codegen.Codegen">GenFnState</a> <a href="#v:get" class="selflink">#</a></p><p class="src"><a href="#v:put">put</a> :: <a href="Codegen-Codegen.html#t:GenFnState" title="Codegen.Codegen">GenFnState</a> -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> () <a href="#v:put" class="selflink">#</a></p><p class="src"><a href="#v:state">state</a> :: (<a href="Codegen-Codegen.html#t:GenFnState" title="Codegen.Codegen">GenFnState</a> -&gt; (a, <a href="Codegen-Codegen.html#t:GenFnState" title="Codegen.Codegen">GenFnState</a>)) -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a <a href="#v:state" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">newtype</span> <a id="t:GenFn" class="def">GenFn</a> a <a href="src/Codegen.Codegen.html#GenFn" class="link">Source</a> <a href="#t:GenFn" class="selflink">#</a></p><div class="doc"><p>Translation monad for procedures, with derived typeclass instances.</p><p>We declare <code><a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a></code> as a newtype so that we can implement <code><a href="../base-4.14.3.0/Control-Monad-Fail.html#t:MonadFail" title="Control.Monad.Fail">MonadFail</a></code> for it,
allowing us to use monadic pattern matching.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:GenFn" class="def">GenFn</a> (<a href="../mtl-2.2.2/Control-Monad-State-Lazy.html#t:StateT" title="Control.Monad.State.Lazy">StateT</a> <a href="Codegen-Codegen.html#t:GenFnState" title="Codegen.Codegen">GenFnState</a> <a href="Common-Compiler.html#t:Pass" title="Common.Compiler">Pass</a> a)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:GenFn">Instances</h4><details id="i:GenFn" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:GenFn:Monad:1"></span> <a href="../base-4.14.3.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a></span> <a href="src/Codegen.Codegen.html#line-114" class="link">Source</a> <a href="#t:GenFn" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:GenFn:Monad:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Codegen-Codegen.html">Codegen.Codegen</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-62--62--61-">(&gt;&gt;=)</a> :: <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a -&gt; (a -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> b) -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> b <a href="#v:-62--62--61-" class="selflink">#</a></p><p class="src"><a href="#v:-62--62-">(&gt;&gt;)</a> :: <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> b -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> b <a href="#v:-62--62-" class="selflink">#</a></p><p class="src"><a href="#v:return">return</a> :: a -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a <a href="#v:return" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:GenFn:Functor:2"></span> <a href="../base-4.14.3.0/Data-Functor.html#t:Functor" title="Data.Functor">Functor</a> <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a></span> <a href="src/Codegen.Codegen.html#line-112" class="link">Source</a> <a href="#t:GenFn" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:GenFn:Functor:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Codegen-Codegen.html">Codegen.Codegen</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:fmap">fmap</a> :: (a -&gt; b) -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> b <a href="#v:fmap" class="selflink">#</a></p><p class="src"><a href="#v:-60--36-">(&lt;$)</a> :: a -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> b -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a <a href="#v:-60--36-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:GenFn:MonadFail:3"></span> <a href="../base-4.14.3.0/Control-Monad-Fail.html#t:MonadFail" title="Control.Monad.Fail">MonadFail</a> <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a></span> <a href="src/Codegen.Codegen.html#line-115" class="link">Source</a> <a href="#t:GenFn" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:GenFn:MonadFail:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Codegen-Codegen.html">Codegen.Codegen</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:fail">fail</a> :: <a href="../base-4.14.3.0/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a <a href="#v:fail" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:GenFn:Applicative:4"></span> <a href="../base-4.14.3.0/Control-Applicative.html#t:Applicative" title="Control.Applicative">Applicative</a> <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a></span> <a href="src/Codegen.Codegen.html#line-113" class="link">Source</a> <a href="#t:GenFn" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:GenFn:Applicative:4"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Codegen-Codegen.html">Codegen.Codegen</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:pure">pure</a> :: a -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a <a href="#v:pure" class="selflink">#</a></p><p class="src"><a href="#v:-60--42--62-">(&lt;*&gt;)</a> :: <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> (a -&gt; b) -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> b <a href="#v:-60--42--62-" class="selflink">#</a></p><p class="src"><a href="#v:liftA2">liftA2</a> :: (a -&gt; b -&gt; c) -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> b -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> c <a href="#v:liftA2" class="selflink">#</a></p><p class="src"><a href="#v:-42--62-">(*&gt;)</a> :: <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> b -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> b <a href="#v:-42--62-" class="selflink">#</a></p><p class="src"><a href="#v:-60--42-">(&lt;*)</a> :: <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> b -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a <a href="#v:-60--42-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:GenFn:MonadState:5"></span> <a href="../mtl-2.2.2/Control-Monad-State-Class.html#t:MonadState" title="Control.Monad.State.Class">MonadState</a> <a href="Codegen-Codegen.html#t:GenFnState" title="Codegen.Codegen">GenFnState</a> <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a></span> <a href="src/Codegen.Codegen.html#line-117" class="link">Source</a> <a href="#t:GenFn" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:GenFn:MonadState:5"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Codegen-Codegen.html">Codegen.Codegen</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:get">get</a> :: <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> <a href="Codegen-Codegen.html#t:GenFnState" title="Codegen.Codegen">GenFnState</a> <a href="#v:get" class="selflink">#</a></p><p class="src"><a href="#v:put">put</a> :: <a href="Codegen-Codegen.html#t:GenFnState" title="Codegen.Codegen">GenFnState</a> -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> () <a href="#v:put" class="selflink">#</a></p><p class="src"><a href="#v:state">state</a> :: (<a href="Codegen-Codegen.html#t:GenFnState" title="Codegen.Codegen">GenFnState</a> -&gt; (a, <a href="Codegen-Codegen.html#t:GenFnState" title="Codegen.Codegen">GenFnState</a>)) -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a <a href="#v:state" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:GenFn:MonadError:6"></span> <a href="Common-Compiler.html#t:MonadError" title="Common.Compiler">MonadError</a> <a href="Common-Compiler.html#t:Error" title="Common.Compiler">Error</a> <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a></span> <a href="src/Codegen.Codegen.html#line-116" class="link">Source</a> <a href="#t:GenFn" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:GenFn:MonadError:6"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Codegen-Codegen.html">Codegen.Codegen</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:throwError">throwError</a> :: <a href="Common-Compiler.html#t:Error" title="Common.Compiler">Error</a> -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a <a href="#v:throwError" class="selflink">#</a></p><p class="src"><a href="#v:catchError">catchError</a> :: <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a -&gt; (<a href="Common-Compiler.html#t:Error" title="Common.Compiler">Error</a> -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a) -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a <a href="#v:catchError" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:GenFn:MonadWriter:7"></span> <a href="Common-Compiler.html#t:MonadWriter" title="Common.Compiler">MonadWriter</a> [<a href="Common-Compiler.html#t:Warning" title="Common.Compiler">Warning</a>] <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a></span> <a href="src/Codegen.Codegen.html#line-118" class="link">Source</a> <a href="#t:GenFn" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:GenFn:MonadWriter:7"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Codegen-Codegen.html">Codegen.Codegen</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:writer">writer</a> :: (a, [<a href="Common-Compiler.html#t:Warning" title="Common.Compiler">Warning</a>]) -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a <a href="#v:writer" class="selflink">#</a></p><p class="src"><a href="#v:tell">tell</a> :: [<a href="Common-Compiler.html#t:Warning" title="Common.Compiler">Warning</a>] -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> () <a href="#v:tell" class="selflink">#</a></p><p class="src"><a href="#v:listen">listen</a> :: <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> (a, [<a href="Common-Compiler.html#t:Warning" title="Common.Compiler">Warning</a>]) <a href="#v:listen" class="selflink">#</a></p><p class="src"><a href="#v:pass">pass</a> :: <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> (a, [<a href="Common-Compiler.html#t:Warning" title="Common.Compiler">Warning</a>] -&gt; [<a href="Common-Compiler.html#t:Warning" title="Common.Compiler">Warning</a>]) -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a <a href="#v:pass" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:runGenFn" class="def">runGenFn</a> <a href="src/Codegen.Codegen.html#runGenFn" class="link">Source</a> <a href="#v:runGenFn" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a></td><td class="doc"><p>Name of procedure</p></td></tr><tr><td class="src">-&gt; [<a href="IR-IR.html#t:Binder" title="IR.IR">Binder</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a>]</td><td class="doc"><p>Names and types of parameters to procedure</p></td></tr><tr><td class="src">-&gt; <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a></td><td class="doc"><p>Body of procedure</p></td></tr><tr><td class="src">-&gt; <a href="Codegen-Typegen.html#t:TypegenInfo" title="Codegen.Typegen">TypegenInfo</a></td><td class="doc"><p>Type information</p></td></tr><tr><td class="src">-&gt; [(<a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a>, <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a>)]</td><td class="doc"><p>Other global identifiers</p></td></tr><tr><td class="src">-&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a</td><td class="doc"><p>Translation monad to run</p></td></tr><tr><td class="src">-&gt; <a href="Common-Compiler.html#t:Pass" title="Common.Compiler">Pass</a> a</td><td class="doc"><p>Pass on errors to caller</p></td></tr></table></div><div class="doc"><p>Run a <code><a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a></code> computation on a procedure.</p></div></div><div class="top"><p class="src"><a id="v:getsTCon" class="def">getsTCon</a> :: (<a href="Codegen-Typegen.html#t:TConInfo" title="Codegen.Typegen">TConInfo</a> -&gt; a) -&gt; <a href="Common-Identifiers.html#t:TConId" title="Common.Identifiers">TConId</a> -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a <a href="src/Codegen.Codegen.html#getsTCon" class="link">Source</a> <a href="#v:getsTCon" class="selflink">#</a></p><div class="doc"><p>Lookup some information associated with a type constructor.</p></div></div><div class="top"><p class="src"><a id="v:getsDCon" class="def">getsDCon</a> :: (<a href="Codegen-Typegen.html#t:DConInfo" title="Codegen.Typegen">DConInfo</a> -&gt; a) -&gt; <a href="Common-Identifiers.html#t:DConId" title="Common.Identifiers">DConId</a> -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a <a href="src/Codegen.Codegen.html#getsDCon" class="link">Source</a> <a href="#v:getsDCon" class="selflink">#</a></p><div class="doc"><p>Lookup some information associated with a data constructor.</p></div></div><div class="top"><p class="src"><a id="v:nextCase" class="def">nextCase</a> :: <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> <a href="../base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a> <a href="src/Codegen.Codegen.html#nextCase" class="link">Source</a> <a href="#v:nextCase" class="selflink">#</a></p><div class="doc"><p>Read and increment the number of cases in a procedure, i.e., <code>fnCases++</code>.</p></div></div><div class="top"><p class="src"><a id="v:getFresh" class="def">getFresh</a> :: <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> <a href="../base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a> <a href="src/Codegen.Codegen.html#getFresh" class="link">Source</a> <a href="#v:getFresh" class="selflink">#</a></p><div class="doc"><p>Obtain fresh integer in the <code><a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a></code> monad</p></div></div><div class="top"><p class="src"><a id="v:addBinding" class="def">addBinding</a> :: <a href="IR-IR.html#t:Binder" title="IR.IR">Binder</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a> -&gt; Exp -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> () <a href="src/Codegen.Codegen.html#addBinding" class="link">Source</a> <a href="#v:addBinding" class="selflink">#</a></p><div class="doc"><p>Bind a variable to a C expression.</p></div></div><div class="top"><p class="src"><a id="v:addLocal" class="def">addLocal</a> :: <a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a> -&gt; <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a> -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> <a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a> <a href="src/Codegen.Codegen.html#addLocal" class="link">Source</a> <a href="#v:addLocal" class="selflink">#</a></p><div class="doc"><p>Register a new local variable, to be declared in activation record.</p></div></div><div class="top"><p class="src"><a id="v:withBindings" class="def">withBindings</a> :: [(<a href="IR-IR.html#t:Binder" title="IR.IR">Binder</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a>, Exp)] -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a <a href="src/Codegen.Codegen.html#withBindings" class="link">Source</a> <a href="#v:withBindings" class="selflink">#</a></p><div class="doc"><p>Bind a variable to a C expression only while computing the given monad.</p></div></div><div class="top"><p class="src"><a id="v:withNewLocal" class="def">withNewLocal</a> :: (<a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a>, <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a>) -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> a <a href="src/Codegen.Codegen.html#withNewLocal" class="link">Source</a> <a href="#v:withNewLocal" class="selflink">#</a></p><div class="doc"><p>Register a local variable and bind its C expression during a monad.</p></div></div><div class="top"><p class="src"><a id="v:maxWait" class="def">maxWait</a> :: <a href="../base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> () <a href="src/Codegen.Codegen.html#maxWait" class="link">Source</a> <a href="#v:maxWait" class="selflink">#</a></p><div class="doc"><p>Register number of wait statements track of number of triggers needed.</p></div></div><div class="top"><p class="src"><a id="v:freshLabel" class="def">freshLabel</a> :: <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> <a href="Codegen-LibSSM.html#t:CIdent" title="Codegen.LibSSM">CIdent</a> <a href="src/Codegen.Codegen.html#freshLabel" class="link">Source</a> <a href="#v:freshLabel" class="selflink">#</a></p><div class="doc"><p>Generate a fresh label.</p></div></div><div class="top"><p class="src"><a id="v:genTmp" class="def">genTmp</a> :: <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a> -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> Exp <a href="src/Codegen.Codegen.html#genTmp" class="link">Source</a> <a href="#v:genTmp" class="selflink">#</a></p><div class="doc"><p>Generate anonymous local variable in activation record for storage.</p></div></div><div class="top"><p class="src"><a id="v:genParams" class="def">genParams</a> :: [<a href="IR-IR.html#t:Binder" title="IR.IR">Binder</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a>] -&gt; [(<a href="Codegen-LibSSM.html#t:CIdent" title="Codegen.LibSSM">CIdent</a>, Type)] <a href="src/Codegen.Codegen.html#genParams" class="link">Source</a> <a href="#v:genParams" class="selflink">#</a></p><div class="doc"><p>Translate a list of SSM parameters to C parameters.</p></div></div><div class="top"><p class="src"><a id="v:genLocals" class="def">genLocals</a> :: [(<a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a>, <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a>)] -&gt; [(<a href="Codegen-LibSSM.html#t:CIdent" title="Codegen.LibSSM">CIdent</a>, Type)] <a href="src/Codegen.Codegen.html#genLocals" class="link">Source</a> <a href="#v:genLocals" class="selflink">#</a></p><div class="doc"><p>Translate a list of SSM local declarations to C declarations.</p></div></div><div class="top"><p class="src"><a id="v:genTrigs" class="def">genTrigs</a> :: <a href="../base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; [(<a href="Codegen-LibSSM.html#t:CIdent" title="Codegen.LibSSM">CIdent</a>, Type)] <a href="src/Codegen.Codegen.html#genTrigs" class="link">Source</a> <a href="#v:genTrigs" class="selflink">#</a></p><div class="doc"><p>Generate declarations for <code>numTrigs</code> triggers.</p></div></div><div class="top"><p class="src"><a id="v:unit" class="def">unit</a> :: Exp <a href="src/Codegen.Codegen.html#unit" class="link">Source</a> <a href="#v:unit" class="selflink">#</a></p><div class="doc"><p>The constant unit value, the singleton inhabitant of the type Unit.</p></div></div><div class="top"><p class="src"><a id="v:undef" class="def">undef</a> :: Exp <a href="src/Codegen.Codegen.html#undef" class="link">Source</a> <a href="#v:undef" class="selflink">#</a></p><div class="doc"><p>Fake undefined value used for expressions of type Void.</p></div></div><div class="top"><p class="src"><a id="v:genProgram" class="def">genProgram</a> :: <a href="IR-IR.html#t:Program" title="IR.IR">Program</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a> -&gt; <a href="Common-Compiler.html#t:Pass" title="Common.Compiler">Pass</a> [Definition] <a href="src/Codegen.Codegen.html#genProgram" class="link">Source</a> <a href="#v:genProgram" class="selflink">#</a></p><div class="doc"><p>Generate a C compilation from an SSM program.</p><p>Each top-level function in a program is turned into three components:</p><ol><li>a struct (the activation record);</li><li>an initialization function (the enter function); and</li><li>a step function, which corresponds to the actual procedure body.</li></ol><p>Items 2 and 3 include both declarations and definitions.</p></div></div><div class="top"><p class="src"><a id="v:includes" class="def">includes</a> :: [Definition] <a href="src/Codegen.Codegen.html#includes" class="link">Source</a> <a href="#v:includes" class="selflink">#</a></p><div class="doc"><p>Include statements in the generated C file.</p></div></div><div class="top"><p class="src"><a id="v:genInitProgram" class="def">genInitProgram</a> :: <a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a> -&gt; [Definition] <a href="src/Codegen.Codegen.html#genInitProgram" class="link">Source</a> <a href="#v:genInitProgram" class="selflink">#</a></p><div class="doc"><p>Setup the entry point of the program.</p></div></div><div class="top"><p class="src"><a id="v:genExtern" class="def">genExtern</a> :: (<a href="Common-Identifiers.html#t:VarId" title="Common.Identifiers">VarId</a>, <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a>) -&gt; <a href="Common-Compiler.html#t:Pass" title="Common.Compiler">Pass</a> Definition <a href="src/Codegen.Codegen.html#genExtern" class="link">Source</a> <a href="#v:genExtern" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:genStruct" class="def">genStruct</a> :: <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> Definition <a href="src/Codegen.Codegen.html#genStruct" class="link">Source</a> <a href="#v:genStruct" class="selflink">#</a></p><div class="doc"><p>Generate struct definition for an SSM procedure.</p><p>This is where local variables, triggers, and parameter values are stored.</p></div></div><div class="top"><p class="src"><a id="v:genEnter" class="def">genEnter</a> :: <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> (Definition, Definition) <a href="src/Codegen.Codegen.html#genEnter" class="link">Source</a> <a href="#v:genEnter" class="selflink">#</a></p><div class="doc"><p>Generate the enter function for an SSM procedure and its signature.</p><p>Its struct is allocated and initialized (partially; local variables' values are
 left uninitialized).</p></div></div><div class="top"><p class="src"><a id="v:genStaticClosure" class="def">genStaticClosure</a> :: <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> (Definition, Definition) <a href="src/Codegen.Codegen.html#genStaticClosure" class="link">Source</a> <a href="#v:genStaticClosure" class="selflink">#</a></p><div class="doc"><p>Generate static closure for top-level function</p></div></div><div class="top"><p class="src"><a id="v:genStep" class="def">genStep</a> :: <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> (Definition, Definition) <a href="src/Codegen.Codegen.html#genStep" class="link">Source</a> <a href="#v:genStep" class="selflink">#</a></p><div class="doc"><p>Generate the step function for an SSM procedure.</p><p>This function just defines the function definition and switch statement that
 wraps the statements of the procedure. The heavy lifting is performed by
 <code><a href="Codegen-Codegen.html#v:genExpr" title="Codegen.Codegen">genExpr</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:genYield" class="def">genYield</a> :: <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> [BlockItem] <a href="src/Codegen.Codegen.html#genYield" class="link">Source</a> <a href="#v:genYield" class="selflink">#</a></p><div class="doc"><p>Helper to generate yield point in step function.</p></div></div><div class="top"><p class="src"><a id="v:genExpr" class="def">genExpr</a> :: <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a> -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> (Exp, [BlockItem]) <a href="src/Codegen.Codegen.html#genExpr" class="link">Source</a> <a href="#v:genExpr" class="selflink">#</a></p><div class="doc"><p>Translate an SSM expression into a C expression and statements.</p><p>SSM IR is a side-effectful expression language, with two implications when
 translating to C:</p><ol><li>every expression has a value (even if it is an uninhabited type), so this
    must be reflected in C; and</li><li>some of the side effects in SSM cannot be implemented in C using expressions
    alone.</li></ol><p>These two implications roughly translate to the <code>C.Exp</code> and <code>[C.BlockItem]</code> in
 <code>genExpr</code>'s return type. When we translate an SSM expression <code>e</code>:</p><pre>(val, stms) &lt;- genExpr e</pre><p><code>val</code> represents the C expression that corresponds to the value of <code>e</code> upon
 evaluation, while <code>stms</code> represents the list of preceding statements that
 compute <code>val</code>.</p><p>A further consideration upon point 2 is that SSM expressions may yield control
 at any point. Thus, the C expression returned by <code>genExpr</code> must accommodate the
 step function suspending and resuming. For instance, consider the following SSM
 IR expression:</p><pre>(let x = 3 in x) + (wait r; 6)</pre><p>The <code>x</code> in the let-binding in the left operand cannot just be a local variable
 in the step function, because it would be &quot;uninitialized&quot; by the yield in the
 right operand:</p><pre>  // let x = 3 in x
  // stms:
  int x = 3;
  // exp: x

  // (wait r; 6)
  // stms:
  ssm_sensitize(r);
  actg-&gt;pc = N;
  return;
case N:
  ssm_desensitize(r);
  // exp: 6

  // After the return, x is no longer initialized, so the following is
  // undefined behavior:
  x + 6</pre><p>To ensure this is cannot happen, we conservatively declare <code>x</code> as a local
 variable in the activation record, so that its value is preserved between
 yields, even if this is not usually necessary. We leave it to later compiler
 passes to optimize this.</p></div></div><div class="top"><p class="src"><a id="v:genPrim" class="def">genPrim</a> :: <a href="IR-IR.html#t:Primitive" title="IR.IR">Primitive</a> -&gt; [<a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a>] -&gt; <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a> -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> (Exp, [BlockItem]) <a href="src/Codegen.Codegen.html#genPrim" class="link">Source</a> <a href="#v:genPrim" class="selflink">#</a></p><div class="doc"><p>Generate code for SSM primitive; see <code><a href="Codegen-Codegen.html#v:genExpr" title="Codegen.Codegen">genExpr</a></code> for extended discussion.</p></div></div><div class="top"><p class="src"><a id="v:genLiteral" class="def">genLiteral</a> :: <a href="IR-IR.html#t:Literal" title="IR.IR">Literal</a> -&gt; Exp <a href="src/Codegen.Codegen.html#genLiteral" class="link">Source</a> <a href="#v:genLiteral" class="selflink">#</a></p><div class="doc"><p>Generate C value for SSM literal, marshalled.</p></div></div><div class="top"><p class="src"><a id="v:genLiteralRaw" class="def">genLiteralRaw</a> :: <a href="IR-IR.html#t:Literal" title="IR.IR">Literal</a> -&gt; Exp <a href="src/Codegen.Codegen.html#genLiteralRaw" class="link">Source</a> <a href="#v:genLiteralRaw" class="selflink">#</a></p><div class="doc"><p>Generate C value for SSM literal, unmarshalled.</p></div></div><div class="top"><p class="src"><a id="v:genPrimOp" class="def">genPrimOp</a> :: <a href="IR-IR.html#t:PrimOp" title="IR.IR">PrimOp</a> -&gt; [<a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a>] -&gt; <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a> -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> (Exp, [BlockItem]) <a href="src/Codegen.Codegen.html#genPrimOp" class="link">Source</a> <a href="#v:genPrimOp" class="selflink">#</a></p><div class="doc"><p>Generate C expression for SSM primitive operation.</p></div></div><div class="top"><p class="src"><a id="v:genBinop" class="def">genBinop</a> :: <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a> -&gt; <a href="IR-IR.html#t:Expr" title="IR.IR">Expr</a> <a href="IR-Types-Type.html#t:Type" title="IR.Types.Type">Type</a> -&gt; <a href="Codegen-Codegen.html#t:GenFn" title="Codegen.Codegen">GenFn</a> ((Exp, Exp), [BlockItem]) <a href="src/Codegen.Codegen.html#genBinop" class="link">Source</a> <a href="#v:genBinop" class="selflink">#</a></p><div class="doc"><p>Helper for sequencing across binary operations.</p></div></div><div class="top"><p class="src"><a id="v:genParArgs" class="def">genParArgs</a> :: <a href="../base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; (Exp, Exp) -&gt; [(Exp, Exp)] <a href="src/Codegen.Codegen.html#genParArgs" class="link">Source</a> <a href="#v:genParArgs" class="selflink">#</a></p><div class="doc"><p>Compute priority and depth arguments for a par fork of given width.</p></div></div><div class="top"><p class="src"><a id="v:depthSub" class="def">depthSub</a> :: <a href="../base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; Exp <a href="src/Codegen.Codegen.html#depthSub" class="link">Source</a> <a href="#v:depthSub" class="selflink">#</a></p><div class="doc"><p>How much the depth should be decreased when par forking given width.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.24.2</p></div></body></html>