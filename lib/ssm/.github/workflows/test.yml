name: Tests

on:
  pull_request:
    branches:
      - main
      - dev
    paths:
      - '.github/**'
      - 'src/**'
      - 'include/**'
      - 'examples/**'
      - 'test/**'
  push:
    branches:
      - main
      - dev
    paths:
      - '.github/**'
      - 'src/**'
      - 'include/**'
      - 'doc/**'

jobs:
  run-tests:
    name: "Run test suite"
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:

    - name: Checkout repo
      uses: actions/checkout@v2

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential gcc valgrind

    # Performed as separate step to more easily detect library build error
    - name: Build library
      run: |
        make lib

    - name: Run tests
      run: |
        ./runtests.sh
